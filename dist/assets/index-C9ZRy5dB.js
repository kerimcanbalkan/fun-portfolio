var e,t,i,r,n,s,o,a,l,h,u,d,c,f,p,g,m,w,y,v,A,x,b,V,E,M,S,R,I,k,P,B,D,T,F,C,O,U,N,L=Object.defineProperty,q=(e,t,i)=>((e,t,i)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const G={welcome:'Welcome!\nI’m Kerimcan Balkan. This is my interactive portfolio - explore, move around, and learn more about me!\nIn a hurry? Check out the <a href="#">boring version</a> instead.',computer:'This is my Computer!\nI spend a lot of time coding in JavaScript and TypeScript for both frontend and backend projects. Lately, I’ve been diving into Golang and I’m loving it! I’m mostly self-taught and truly passionate about coding. If you’re curious to see my work, check out my GitHub account: <a href="https://www.github.com/kerimcanbalkan" target="_blank">My Github</a> ',tv:'That\'s my TV.When I’m not coding or stargazing, I’m watching epic anime like Naruto and One Piece. I also watch a lot of YouTube—tech, repair, and even history stuff. My sister says these are the "boring" videos, but hey, I think they’re pretty cool. Someone’s gotta know how to fix things and learn from the past!',sofa:"Yep, this is where I kick back and relax. And, if I’m being honest, it’s also where I sometimes get lost in endless doom scrolling. Hey, we all need a break sometimes, right?",cv:'Oops, I left my Resume on top of the dresser!\nIf you’re interested in checking it out, just click here: <a href="https://github.com/kerimcanbalkan/resume/blob/main/resume.pdf" target="_blank">My Resume</a>.',projects:'Info about this portfolio : It\'s made with the Kaboom.js library which is a library for making games in JavaScript.\n  Text is rendered with HTML/CSS. So the textbox you\'re currently reading is not rendered within canvas. Learn more about how to use\n  Kaboom.js by watching some of my tutorials <a href="https://youtube.com/@jslegenddev" target="_blank">here</a>.',library:"Welcome to my treasure trove of history, Russian novels, and tech wonders. I love diving into these topics in Turkish, English, and Albanian. For me, every book is an adventure and every page a new discovery!",degree:"This is my Astronomy and Space Science Degree!\nYep, I studied the stars! But don't worry, I’m just as skilled at coding here on Earth. Full-stack developer by day, space enthusiast by night. My degree proves I can navigate both the cosmos and the code!",cook:"This is my Kitchen!\nCooking has become a recent hobby of mine. I’m just starting to learn the ropes, so don’t expect any Michelin-star dishes yet! But hey, every great chef starts somewhere, right? ",music:"This is my Pickup Player!\nI’m a music lover and guitar player, always jamming to everything from Chet Baker’s smooth jazz to the energetic riffs of RHCP. Whether it’s Turkish rock or rap, my playlist has it all. "};var j=Object.defineProperty,K=(e,t)=>j(e,"name",{value:t,configurable:!0}),H=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var i=t.length,r=new Uint8Array(3*(i-("="==t[i-1])-("="==t[i-2]))/4|0),n=0,s=0;n<i;){var o=e[t.charCodeAt(n++)],a=e[t.charCodeAt(n++)],l=e[t.charCodeAt(n++)],h=e[t.charCodeAt(n++)];r[s++]=o<<2|a>>4,r[s++]=a<<4|l>>2,r[s++]=l<<6|h}return r}})(),Y=(e=class{constructor(e,t,i){q(this,"r",255),q(this,"g",255),q(this,"b",255),this.r=J(e,0,255),this.g=J(t,0,255),this.b=J(i,0,255)}static fromArray(t){return new e(t[0],t[1],t[2])}static fromHex(t){if("number"==typeof t)return new e(t>>16&255,t>>8&255,255&t);if("string"==typeof t){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!i)throw new Error("Invalid hex color format");return new e(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16))}throw new Error("Invalid hex color format")}static fromHSL(t,i,r){if(0==i)return new e(255*r,255*r,255*r);let n=K(((e,t,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e)),"hue2rgb"),s=r<.5?r*(1+i):r+i-r*i,o=2*r-s,a=n(o,s,t+1/3),l=n(o,s,t),h=n(o,s,t-1/3);return new e(Math.round(255*a),Math.round(255*l),Math.round(255*h))}clone(){return new e(this.r,this.g,this.b)}lighten(t){return new e(this.r+t,this.g+t,this.b+t)}darken(e){return this.lighten(-e)}invert(){return new e(255-this.r,255-this.g,255-this.b)}mult(t){return new e(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,i){return new e(Z(this.r,t.r,i),Z(this.g,t.g,i),Z(this.b,t.b,i))}toHSL(){let e=this.r/255,t=this.g/255,i=this.b/255,r=Math.max(e,t,i),n=Math.min(e,t,i),s=(r+n)/2,o=s,a=s;if(r==n)s=o=0;else{let l=r-n;switch(o=a>.5?l/(2-r-n):l/(r+n),r){case e:s=(t-i)/l+(t<i?6:0);break;case t:s=(i-e)/l+2;break;case i:s=(e-t)/l+4}s/=6}return[s,o,a]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}},K(e,"Color"),q(e,"RED",new e(255,0,0)),q(e,"GREEN",new e(0,255,0)),q(e,"BLUE",new e(0,0,255)),q(e,"YELLOW",new e(255,255,0)),q(e,"MAGENTA",new e(255,0,255)),q(e,"CYAN",new e(0,255,255)),q(e,"WHITE",new e(255,255,255)),q(e,"BLACK",new e(0,0,0)),e);function z(...e){if(0===e.length)return new Y(255,255,255);if(1===e.length){if(e[0]instanceof Y)return e[0].clone();if("string"==typeof e[0])return Y.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return Y.fromArray(e[0])}else if(2===e.length){if(e[0]instanceof Y)return e[0].clone()}else if(3===e.length||4===e.length)return new Y(e[0],e[1],e[2]);throw new Error("Invalid color arguments")}K(z,"rgb");var Q=K(((e,t,i)=>Y.fromHSL(e,t,i)),"hsl2rgb");function W(e){return e*Math.PI/180}function X(e){return 180*e/Math.PI}function J(e,t,i){return t>i?J(e,i,t):Math.min(Math.max(e,t),i)}function Z(e,t,i){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*i;if(e instanceof ee&&t instanceof ee)return e.lerp(t,i);if(e instanceof Y&&t instanceof Y)return e.lerp(t,i);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function _(e,t,i,r,n){return r+(e-t)/(i-t)*(n-r)}function $(e,t,i,r,n){return J(_(e,t,i,r,n),r,n)}K(W,"deg2rad"),K(X,"rad2deg"),K(J,"clamp"),K(Z,"lerp"),K(_,"map"),K($,"mapc");var ee=(K(t=class{constructor(e=0,t=e){q(this,"x",0),q(this,"y",0),this.x=e,this.y=t}static fromAngle(e){let i=W(e);return new t(Math.cos(i),Math.sin(i))}static fromArray(e){return new t(e[0],e[1])}clone(){return new t(this.x,this.y)}add(...e){let i=te(...e);return new t(this.x+i.x,this.y+i.y)}sub(...e){let i=te(...e);return new t(this.x-i.x,this.y-i.y)}scale(...e){let i=te(...e);return new t(this.x*i.x,this.y*i.y)}dist(...e){let t=te(...e);return this.sub(t).len()}sdist(...e){let t=te(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return 0===e?new t(0):this.scale(1/e)}normal(){return new t(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=te(...e);return X(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=te(...e);return X(Math.atan2(this.cross(t),this.dot(t)))}lerp(e,i){return new t(Z(this.x,e.x,i),Z(this.y,e.y,i))}slerp(e,t){let i=this.dot(e),r=this.cross(e),n=Math.atan2(r,i);return this.scale(Math.sin((1-t)*n)).add(e.scale(Math.sin(t*n))).scale(1/r)}isZero(){return 0===this.x&&0===this.y}toFixed(e){return new t(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new et(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}},"Vec2"),q(t,"LEFT",new t(-1,0)),q(t,"RIGHT",new t(1,0)),q(t,"UP",new t(0,-1)),q(t,"DOWN",new t(0,1)),t);function te(...e){if(1===e.length){if(e[0]instanceof ee)return new ee(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new ee(...e[0])}return new ee(...e)}K(te,"vec2");var ie=(K(i=class{constructor(e,t,i,r){q(this,"x",0),q(this,"y",0),q(this,"w",1),q(this,"h",1),this.x=e,this.y=t,this.w=i,this.h=r}scale(e){return new i(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new ee(this.x,this.y)}clone(){return new i(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},"Quad"),i);function re(e,t,i,r){return new ie(e,t,i,r)}K(re,"quad");var ne=(K(r=class{constructor(e,t,i,r){q(this,"a"),q(this,"b"),q(this,"c"),q(this,"d"),this.a=e,this.b=t,this.c=i,this.d=r}mul(e){return new r(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return te(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new r(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new r(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,t=this.det;return[e+Math.sqrt(e*e-t),e-Math.sqrt(e*e-t)]}eigenvectors(e,t){return 0!=this.c?[[e-this.d,this.c],[t-this.d,this.c]]:0!=this.b?[[this.b,e-this.a],[this.b,t-this.a]]:Math.abs(this.transform(te(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let t=Math.cos(e),i=Math.sin(e);return new r(t,i,-i,t)}static scale(e,t){return new r(e,0,0,t)}},"Mat2"),r),se=(K(n=class{constructor(e,t,i,r,n,s,o,a,l){q(this,"m11"),q(this,"m12"),q(this,"m13"),q(this,"m21"),q(this,"m22"),q(this,"m23"),q(this,"m31"),q(this,"m32"),q(this,"m33"),this.m11=e,this.m12=t,this.m13=i,this.m21=r,this.m22=n,this.m23=s,this.m31=o,this.m32=a,this.m33=l}static fromMat2(e){return new n(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new ne(this.m11,this.m12,this.m21,this.m22)}mul(e){return new n(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let t=Math.cos(e),i=Math.sin(e),r=this.m11,n=this.m12;return this.m11=t*this.m11+i*this.m21,this.m12=t*this.m12+i*this.m22,this.m21=t*this.m21-i*r,this.m22=t*this.m22-i*n,this}scale(e,t){return this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}get inverse(){let e=this.det;return new n((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new n(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},"Mat3"),n),oe=(K(s=class{constructor(e){q(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e&&(this.m=e)}static translate(e){return new s([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new s([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=W(-e);let t=Math.cos(e),i=Math.sin(e);return new s([1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1])}static rotateY(e){e=W(-e);let t=Math.cos(e),i=Math.sin(e);return new s([t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1])}static rotateZ(e){e=W(-e);let t=Math.cos(e),i=Math.sin(e);return new s([t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=W(-e);let t=Math.cos(e),i=Math.sin(e),r=this.m[0],n=this.m[1],s=this.m[4],o=this.m[5];return this.m[0]=r*t+n*i,this.m[1]=-r*i+n*t,this.m[4]=s*t+o*i,this.m[5]=-s*i+o*t,this}mult(e){let t=[];for(let i=0;i<4;i++)for(let r=0;r<4;r++)t[4*i+r]=this.m[0+r]*e.m[4*i+0]+this.m[4+r]*e.m[4*i+1]+this.m[8+r]*e.m[4*i+2]+this.m[12+r]*e.m[4*i+3];return new s(t)}multVec2(e){return new ee(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new ee(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new ee(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new ee(e/t,t)}return new ee(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return X(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return X(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new ee(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new ee(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new ee(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],i=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],n=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[4]*this.m[13]-this.m[12]*this.m[5],g=this.m[6]*this.m[11]-this.m[10]*this.m[7],m=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],y=this.m[4]*this.m[11]-this.m[8]*this.m[7],v=this.m[4]*this.m[10]-this.m[8]*this.m[6],A=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*i+this.m[7]*r,e[4]=-(this.m[4]*t-this.m[6]*n+this.m[7]*o),e[8]=this.m[4]*i-this.m[5]*n+this.m[7]*a,e[12]=-(this.m[4]*r-this.m[5]*o+this.m[6]*a),e[1]=-(this.m[1]*t-this.m[2]*i+this.m[3]*r),e[5]=this.m[0]*t-this.m[2]*n+this.m[3]*o,e[9]=-(this.m[0]*i-this.m[1]*n+this.m[3]*a),e[13]=this.m[0]*r-this.m[1]*o+this.m[2]*a,e[2]=this.m[1]*l-this.m[2]*h+this.m[3]*u,e[6]=-(this.m[0]*l-this.m[2]*d+this.m[3]*c),e[10]=this.m[0]*f-this.m[1]*d+this.m[3]*p,e[14]=-(this.m[0]*u-this.m[1]*c+this.m[2]*p),e[3]=-(this.m[1]*g-this.m[2]*m+this.m[3]*w),e[7]=this.m[0]*g-this.m[2]*y+this.m[3]*v,e[11]=-(this.m[0]*m-this.m[1]*y+this.m[3]*A),e[15]=this.m[0]*w-this.m[1]*v+this.m[2]*A;let x=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let s=0;s<4;s++)for(let t=0;t<4;t++)e[4*s+t]*=1/x;return new s(e)}clone(){return new s([...this.m])}toString(){return this.m.toString()}},"Mat4"),s);function ae(e,t,i,r=e=>-Math.cos(e)){return e+(r(i)+1)/2*(t-e)}K(ae,"wave");var le=2147483648,he=(K(o=class{constructor(e){q(this,"seed"),this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%le,this.seed/le}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new ee(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new Y(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof ee)return this.genVec2(te(0,0),e[0]);if(e[0]instanceof Y)return this.genColor(z(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof ee&&e[1]instanceof ee)return this.genVec2(e[0],e[1]);if(e[0]instanceof Y&&e[1]instanceof Y)return this.genColor(e[0],e[1])}throw new Error("More than 2 arguments not supported")}},"RNG"),o),ue=new he(Date.now());function de(e){return null!=e&&(ue.seed=e),ue.seed}function ce(...e){return ue.genAny(...e)}function fe(...e){return Math.floor(ce(...e))}function pe(e){return ce()<=e}function ge(e){for(let t=e.length-1;t>0;t--){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function me(e,t){return e.length<=t?e.slice():ge(e.slice()).slice(0,t)}function we(e){return e[fe(e.length)]}function ye(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function ve(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let i=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===i)return null;let r=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/i,n=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/i;return r<0||r>1||n<0||n>1?null:r}function Ae(e,t){let i=ve(e,t);return i?te(e.p1.x+i*(e.p2.x-e.p1.x),e.p1.y+i*(e.p2.y-e.p1.y)):null}function xe(e,t){let i=t.p2.sub(t.p1),r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;if(0!=i.x){let s=(e.pos.x-t.p1.x)/i.x,o=(e.pos.x+e.width-t.p1.x)/i.x;r=Math.max(r,Math.min(s,o)),n=Math.min(n,Math.max(s,o))}if(0!=i.y){let s=(e.pos.y-t.p1.y)/i.y,o=(e.pos.y+e.height-t.p1.y)/i.y;r=Math.max(r,Math.min(s,o)),n=Math.min(n,Math.max(s,o))}return n>=r&&n>=0&&r<=1}function be(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function Ve(e,t){return te(Math.max(e.pos.x,Math.min(t.center.x,e.pos.x+e.width)),Math.max(e.pos.y,Math.min(t.center.y,e.pos.y+e.height))).sdist(t.center)<=t.radius*t.radius}function Ee(e,t){return Be(t,new nt(e.points()))}function Me(e,t){let i=t.sub(e.p1),r=e.p2.sub(e.p1);if(Math.abs(i.cross(r))>Number.EPSILON)return!1;let n=i.dot(r)/r.dot(r);return n>=0&&n<=1}function Se(e,t){let i=e.p2.sub(e.p1),r=i.dot(i),n=e.p1.sub(t.center),s=2*i.dot(n),o=s*s-4*r*(n.dot(n)-t.radius*t.radius);if(r<=Number.EPSILON||o<0)return!1;if(0==o){let e=-s/(2*r);if(e>=0&&e<=1)return!0}else{let e=(-s+Math.sqrt(o))/(2*r),t=(-s-Math.sqrt(o))/(2*r);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return Ie(t,e.p1)}function Re(e,t){if(De(t,e.p1)||De(t,e.p2))return!0;for(let i=0;i<t.pts.length;i++){let r=t.pts[i],n=t.pts[(i+1)%t.pts.length];if(Ae(e,new $e(r,n)))return!0}return!1}function Ie(e,t){return e.center.sdist(t)<e.radius*e.radius}function ke(e,t){return e.center.sdist(t.center)<(e.radius+t.radius)*(e.radius+t.radius)}function Pe(e,t){let i=t.pts[t.pts.length-1];for(let r of t.pts){if(Se(new $e(i,r),e))return!0;i=r}return!!Ie(e,t.pts[0])||De(t,e.center)}function Be(e,t){for(let i=0;i<e.pts.length;i++)if(Re(new $e(e.pts[i],e.pts[(i+1)%e.pts.length]),t))return!0;return!(!e.pts.some((e=>De(t,e)))&&!t.pts.some((t=>De(e,t))))}function De(e,t){let i=!1,r=e.pts;for(let n=0,s=r.length-1;n<r.length;s=n++)r[n].y>t.y!=r[s].y>t.y&&t.x<(r[s].x-r[n].x)*(t.y-r[n].y)/(r[s].y-r[n].y)+r[n].x&&(i=!i);return i}function Te(e,t){t=t.sub(e.center);let i=W(e.angle),r=Math.cos(i),n=Math.sin(i),s=t.x*r+t.y*n,o=-t.x*n+t.y*r;return s*s/(e.radiusX*e.radiusX)+o*o/(e.radiusY*e.radiusY)<1}function Fe(e,t){let i=t.center.sub(e.center),r=W(e.angle),n=Math.cos(r),s=Math.sin(r),o=i.x*n+i.y*s,a=-i.x*s+i.y*n;return Te(new it(te(),e.radiusX+t.radius,e.radiusY+t.radius,0),te(o,a))}function Ce(e,t){let i=e.toMat2().inverse;return Se(t=new $e(i.transform(t.p1.sub(e.center)),i.transform(t.p2.sub(e.center))),new tt(te(),1))}function Oe(e,t){if(e.radiusX===e.radiusY)return Fe(t,new tt(e.center,e.radiusX));if(t.radiusX===t.radiusY)return Fe(e,new tt(t.center,t.radiusX));let i=new se(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),r=new se(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),n=e.center.x,s=e.center.y,o=t.center.x,a=t.center.y,l=W(e.angle),h=W(t.angle),u=new se(Math.cos(l),-Math.sin(l),n,Math.sin(l),Math.cos(l),s,0,0,1),d=new se(Math.cos(h),-Math.sin(h),o,Math.sin(h),Math.cos(h),a,0,0,1),c=u.inverse,f=d.inverse,p=c.transpose.mul(i).mul(c),g=f.transpose.mul(r).mul(f),m=p.m11,w=p.m12,y=p.m13,v=p.m21,A=p.m22,x=p.m23,b=p.m31,V=p.m32,E=p.m33,M=g.m11,S=g.m12,R=g.m13,I=g.m21,k=g.m22,P=g.m23,B=g.m31,D=g.m32,T=g.m33,F=m*A*E-m*x*V-w*v*E+w*x*b+y*v*V-y*A*b,C=(m*A*T-m*x*D-m*V*P+m*E*k-w*v*T+w*x*B+w*b*P-w*E*I+y*v*D-y*A*B-y*b*k+y*V*I+v*V*R-v*E*S-A*b*R+A*E*M+x*b*S-x*V*M)/F,O=(m*k*T-m*P*D-w*I*T+w*P*B+y*I*D-y*k*B-v*S*T+v*R*D+A*M*T-A*R*B-x*M*D+x*S*B+b*S*P-b*R*k-V*M*P+V*R*I+E*M*k-E*S*I)/F,U=(M*k*T-M*P*D-S*I*T+S*P*B+R*I*D-R*k*B)/F;if(C>=0){return!(-3*O+C**2>0&&3*C*U+O*C**2-4*O**2<0&&-27*U**2+18*U*C*O+C**2*O**2-4*C**3*U-4*O**3>0)}return!(-3*O+C**2>0&&-27*U**2+18*U*C*O+C**2*O**2-4*C**3*U-4*O**3>0)}function Ue(e,t){return Ne(e,new nt(t.points()))}function Ne(e,t){let i=e.toMat2().inverse;return t=new nt(t.pts.map((t=>i.transform(t.sub(e.center))))),Pe(new tt(te(),1),t)}function Le(e,t){return e.x===t.x&&e.y===t.y}function qe(e,t){return t instanceof ee?Le(t,e.pt):t instanceof tt?Ie(t,e.pt):t instanceof $e?Me(t,e.pt):t instanceof et?be(t,e.pt):t instanceof nt?De(t,e.pt):t instanceof it&&Te(t,e.pt)}function Ge(e,t){return t instanceof ee?Me(e,t):t instanceof tt?Se(e,t):t instanceof $e?null!=Ae(e,t):t instanceof et?xe(t,e):t instanceof nt?Re(e,t):t instanceof it&&Ce(t,e)}function je(e,t){return t instanceof ee?Ie(e,t):t instanceof tt?ke(e,t):t instanceof $e?Se(t,e):t instanceof et?Ve(t,e):t instanceof nt?Pe(e,t):t instanceof it&&Fe(t,e)}function Ke(e,t){return t instanceof ee?be(e,t):t instanceof tt?Ve(e,t):t instanceof $e?xe(e,t):t instanceof et?ye(e,t):t instanceof nt?Ee(e,t):t instanceof it&&Ue(t,e)}function He(e,t){return t instanceof ee?De(e,t):t instanceof tt?Pe(t,e):t instanceof $e?Re(t,e):t instanceof et?Ee(t,e):t instanceof nt?Be(t,e):t instanceof it&&Ne(t,e)}function Ye(e,t){return t instanceof ee?Te(e,t):t instanceof tt?Fe(e,t):t instanceof $e?Ce(e,t):t instanceof et?Ue(e,t):t instanceof nt?Ne(e,t):t instanceof it&&Oe(t,e)}function ze(e,t,i){let r=e,n=i.p1,s=t,o=i.p2.sub(n),a=s.cross(o);if(Math.abs(a)<Number.EPSILON)return null;let l=n.sub(r),h=l.cross(o)/a;if(h<=0||h>=1)return null;let u=l.cross(s)/a;if(u<=0||u>=1)return null;let d=o.normal().unit();return t.dot(d)>0&&(d.x*=-1,d.y*=-1),{point:r.add(s.scale(h)),normal:d,fraction:h}}function Qe(e,t,i){let r,n=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;if(0!=e.x){let o=(i.pos.x-e.x)/t.x,a=(i.pos.x+i.width-e.x)/t.x;r=te(-Math.sign(t.x),0),n=Math.max(n,Math.min(o,a)),s=Math.min(s,Math.max(o,a))}if(0!=e.y){let o=(i.pos.y-e.y)/t.y,a=(i.pos.y+i.height-e.y)/t.y;Math.min(o,a)>n&&(r=te(0,-Math.sign(t.y))),n=Math.max(n,Math.min(o,a)),s=Math.min(s,Math.max(o,a))}return s>=n&&n>=0&&n<=1?{point:e.add(t.scale(n)),normal:r,fraction:n}:null}function We(e,t,i){let r=e,n=i.center,s=t,o=s.dot(s),a=r.sub(n),l=2*s.dot(a),h=l*l-4*o*(a.dot(a)-i.radius*i.radius);if(o<=Number.EPSILON||h<0)return null;if(0==h){let e=-l/(2*o);if(e>=0&&e<=1){let t=r.add(s.scale(e));return{point:t,normal:t.sub(n),fraction:e}}}else{let e=(-l+Math.sqrt(h))/(2*o),t=(-l-Math.sqrt(h))/(2*o),i=null;if(e>=0&&e<=1&&(i=e),t>=0&&t<=1&&(i=Math.min(t,i??t)),null!=i){let e=r.add(s.scale(i));return{point:e,normal:e.sub(n).unit(),fraction:i}}}return null}function Xe(e,t,i){let r=i.pts,n=null,s=r[r.length-1];for(let o=0;o<r.length;o++){let i=r[o],a=ze(e,t,new $e(s,i));a&&(!n||n.fraction>a.fraction)&&(n=a),s=i}return n}function Je(e,t,i){let r=i.toMat2(),n=r.inverse,s=We(n.transform(e.sub(i.center)),n.transform(t),new tt(te(),1));if(s){let n=ne.rotation(W(-i.angle)),o=ne.scale(i.radiusX,i.radiusY).transform(s.point),a=r.transform(s.point).add(i.center),l=a.dist(e)/t.len();return{point:a,normal:n.transform(te(i.radiusY**2*o.x,i.radiusX**2*o.y)).unit(),fraction:l}}return s}function Ze(e,t,i,r=64){let n=e,s=t.len(),o=t.scale(1/s),a=0,l=te(Math.floor(e.x),Math.floor(e.y)),h=te(o.x>0?1:-1,o.y>0?1:-1),u=te(Math.abs(1/o.x),Math.abs(1/o.y)),d=te(h.x>0?l.x+1-e.x:e.x-l.x,h.y>0?l.y+1-e.y:e.y-l.y),c=te(u.x<1/0?u.x*d.x:1/0,u.y<1/0?u.y*d.y:1/0),f=-1;for(;a<=r;){let e=i(l);if(!0===e)return{point:n.add(o.scale(a)),normal:te(0===f?-h.x:0,1===f?-h.y:0),fraction:a/s,gridPos:l};if(e)return e;c.x<c.y?(l.x+=h.x,a=c.x,c.x+=u.x,f=0):(l.y+=h.y,a=c.y,c.y+=u.y,f=1)}return null}K(de,"randSeed"),K(ce,"rand"),K(fe,"randi"),K(pe,"chance"),K(ge,"shuffle"),K(me,"chooseMultiple"),K(we,"choose"),K(ye,"testRectRect"),K(ve,"testLineLineT"),K(Ae,"testLineLine"),K(xe,"testRectLine"),K(be,"testRectPoint"),K(Ve,"testRectCircle"),K(Ee,"testRectPolygon"),K(Me,"testLinePoint"),K(Se,"testLineCircle"),K(Re,"testLinePolygon"),K(Ie,"testCirclePoint"),K(ke,"testCircleCircle"),K(Pe,"testCirclePolygon"),K(Be,"testPolygonPolygon"),K(De,"testPolygonPoint"),K(Te,"testEllipsePoint"),K(Fe,"testEllipseCircle"),K(Ce,"testEllipseLine"),K(Oe,"testEllipseEllipse"),K(Ue,"testEllipseRect"),K(Ne,"testEllipsePolygon"),K(Le,"testPointPoint"),K(qe,"testPointShape"),K(Ge,"testLineShape"),K(je,"testCircleShape"),K(Ke,"testRectShape"),K(He,"testPolygonShape"),K(Ye,"testEllipseShape"),K(ze,"raycastLine"),K(Qe,"raycastRect"),K(We,"raycastCircle"),K(Xe,"raycastPolygon"),K(Je,"raycastEllipse"),K(Ze,"raycastGrid");var _e=(K(a=class{constructor(e){q(this,"pt"),this.pt=e.clone()}transform(e){return new a(e.multVec2(this.pt))}bbox(){return new et(this.pt,0,0)}area(){return 0}clone(){return new a(this.pt)}collides(e){return qe(this,e)}contains(e){return this.pt.eq(e)}raycast(e,t){return null}random(){return this.pt.clone()}},"Point"),a),$e=(K(l=class{constructor(e,t){q(this,"p1"),q(this,"p2"),this.p1=e.clone(),this.p2=t.clone()}transform(e){return new l(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return et.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new l(this.p1,this.p2)}collides(e){return Ge(this,e)}contains(e){return this.collides(e)}raycast(e,t){return ze(e,t,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(ce(1)))}},"Line"),l),et=(K(h=class{constructor(e,t,i){q(this,"pos"),q(this,"width"),q(this,"height"),this.pos=e.clone(),this.width=t,this.height=i}static fromPoints(e,t){return new h(e.clone(),t.x-e.x,t.y-e.y)}center(){return new ee(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new nt(this.points().map((t=>e.multVec2(t))))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new h(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,i=this.pos.add(this.width,this.height),r=Math.max(t.x-e.x,0,e.x-i.x),n=Math.max(t.y-e.y,0,e.y-i.y);return r*r+n*n}collides(e){return Ke(this,e)}contains(e){return this.collides(e)}raycast(e,t){return Qe(e,t,this)}random(){return this.pos.add(ce(this.width),ce(this.height))}},"Rect"),h),tt=(K(u=class{constructor(e,t){q(this,"center"),q(this,"radius"),this.center=e.clone(),this.radius=t}transform(e){return new it(this.center,this.radius,this.radius).transform(e)}bbox(){return et.fromPoints(this.center.sub(te(this.radius)),this.center.add(te(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new u(this.center,this.radius)}collides(e){return je(this,e)}contains(e){return this.collides(e)}raycast(e,t){return We(e,t,this)}random(){return this.center.add(ee.fromAngle(ce(360)).scale(ce(this.radius)))}},"Circle"),u),it=(K(d=class{constructor(e,t,i,r=0){q(this,"center"),q(this,"radiusX"),q(this,"radiusY"),q(this,"angle"),this.center=e.clone(),this.radiusX=t,this.radiusY=i,this.angle=r}static fromMat2(e){let t=e.inverse,i=t.transpose.mul(t),[r,n]=i.eigenvalues,[s,o]=i.eigenvectors(r,n),[a,l]=[1/Math.sqrt(r),1/Math.sqrt(n)];return a>l?new d(te(),a,l,X(Math.atan2(-s[1],s[0]))):new d(te(),l,a,X(Math.atan2(-o[1],o[0])))}toMat2(){let e=W(this.angle),t=Math.cos(e),i=Math.sin(e);return new ne(t*this.radiusX,-i*this.radiusY,i*this.radiusX,t*this.radiusY)}transform(e){if(0==this.angle&&0==e.getRotation())return new d(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let t=this.toMat2(),i=e.getRotation(),r=e.getScale();t=se.fromMat2(t).scale(r.x,r.y).rotate(i).toMat2();let n=d.fromMat2(t);return n.center=e.multVec2(this.center),n}}bbox(){if(0==this.angle)return et.fromPoints(this.center.sub(te(this.radiusX,this.radiusY)),this.center.add(te(this.radiusX,this.radiusY)));{let e=W(this.angle),t=Math.cos(e),i=Math.sin(e),r=this.radiusX*t,n=this.radiusX*i,s=this.radiusY*i,o=this.radiusY*t,a=Math.sqrt(r*r+s*s),l=Math.sqrt(n*n+o*o);return et.fromPoints(this.center.sub(te(a,l)),this.center.add(te(a,l)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new d(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return Ye(this,e)}contains(e){e=e.sub(this.center);let t=W(this.angle),i=Math.cos(t),r=Math.sin(t),n=e.x*i+e.y*r,s=-e.x*r+e.y*i;return n*n/(this.radiusX*this.radiusX)+s*s/(this.radiusY*this.radiusY)<1}raycast(e,t){return Je(e,t,this)}random(){return this.center}},"Ellipse"),d);function rt(e,t,i,r){let n=t.sub(e),s=r.sub(i),o=n.cross(s);return o<1e-5&&o>-1e-5||(o=i.sub(e).cross(s)/o,o<0||o>1)?null:e.add(n.scale(o))}K(rt,"segmentLineIntersection");var nt=(K(c=class{constructor(e){if(q(this,"pts"),e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new c(this.pts.map((t=>e.multVec2(t))))}bbox(){let e=te(Number.MAX_VALUE),t=te(-Number.MAX_VALUE);for(let i of this.pts)e.x=Math.min(e.x,i.x),t.x=Math.max(t.x,i.x),e.y=Math.min(e.y,i.y),t.y=Math.max(t.y,i.y);return et.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let i=0;i<t;i++){let r=this.pts[i],n=this.pts[(i+1)%t];e+=r.x*n.y*.5,e-=n.x*r.y*.5}return Math.abs(e)}clone(){return new c(this.pts.map((e=>e.clone())))}collides(e){return He(this,e)}contains(e){return this.collides(e)}raycast(e,t){return Xe(e,t,this)}random(){return te()}cut(e,t){new $e(e,t);let i=[],r=[],n=t.sub(e),s=this.pts[this.pts.length-1],o=s.sub(e),a=n.cross(o)>0;return this.pts.forEach((l=>{o=l.sub(e);let h=n.cross(o)>0;if(a!=h){let n=rt(s,l,e,t);i.push(n),r.push(n),a=h}(h?i:r).push(l),s=l})),[i.length?new c(i):null,r.length?new c(r):null]}},"Polygon"),c);function st(e,t,i,r){let n=r*r,s=1-r,o=s*s;return e.scale(o).add(t.scale(2*s*r)).add(i.scale(n))}function ot(e,t,i,r){let n=1-r;return t.sub(e).scale(2*n).add(i.sub(t).scale(2*r))}function at(e,t,i,r){return i.sub(t.scale(2)).add(e).scale(2)}function lt(e,t,i,r,n){let s=n*n,o=s*n,a=1-n,l=a*a,h=l*a;return e.scale(h).add(t.scale(3*l*n)).add(i.scale(3*a*s)).add(r.scale(o))}function ht(e,t,i,r,n){let s=n*n,o=1-n,a=o*o;return t.sub(e).scale(3*a).add(i.sub(t).scale(6*o*n)).add(r.sub(i).scale(3*s))}function ut(e,t,i,r,n){let s=1-n;return i.sub(t.scale(2)).add(e).scale(6*s).add(r.sub(i.scale(2)).add(t).scale(6*n))}function dt(e,t,i,r,n){let s=((2-n)*n-1)*n*.5,o=.5*((3*n-5)*n*n+2),a=((-3*n+4)*n+1)*n*.5,l=(n-1)*n*n*.5;return e.scale(s).add(t.scale(o)).add(i.scale(a)).add(r.scale(l))}function ct(e,t,i,r,n){let s=.5*((-3*n+4)*n-1),o=(9*n-10)*n*.5,a=.5*((-9*n+8)*n+1),l=(3*n-2)*n*.5;return e.scale(s).add(t.scale(o)).add(i.scale(a)).add(r.scale(l))}function ft(e){let t=pt(e),i=t(1);return r=>{let n=t(r*i,!0);return e(n)}}function pt(e,t=10,i=10){let r=[0],n=[0],s=1/(t-1)/i,o=0,a=e(0),l=0;for(let h=1;h<t;h++){for(let t=0;t<i;t++){l+=s;let t=e(l),i=t.dist(a);o+=i,a=t}r[h]=o,n[h]=l}return n[t-1]=1,(e,i=!1)=>{if(i){let t=e;if(t<=0)return 0;if(t>=o)return 1;let i=0;for(;r[i+1]<t;)i++;let s=n[i],a=n[i+1],l=r[i];return s+(a-s)*((t-l)/(r[i+1]-l))}{if(e<=0)return 0;if(e>=1)return r[t-1];let i=0;for(;n[i+1]<e;)i++;let s=n[i],o=n[i+1],a=r[i];return a+(r[i+1]-a)*((e-s)/(o-s))}}}function gt(e,t,i,r){let n=2*e+t-2*r+i,s=-3*e+3*r-2*t-i,o=t,a=e;return e=>{let t=e*e;return n*(t*e)+s*t+o*e+a}}function mt(e,t,i,r,n,s=gt){let o=s(t.x,(1-n)*(i.x-e.x),(1-n)*(r.x-t.x),i.x),a=s(t.y,(1-n)*(i.y-e.y),(1-n)*(r.y-t.y),i.y);return e=>new ee(o(e),a(e))}function wt(e,t,i,r,n=gt){return mt(e,t,i,r,.5,n)}function yt(e,t,i,r,n=gt){return wt(r.add(e.sub(t).scale(6)),e,r,e.add(r.sub(i).scale(6)),n)}function vt(e,t,i,r,n,s,o,a=gt){let l=a(t.x,.5*(1-n)*(1+o)*(1+s)*(t.x-e.x)+.5*(1-n)*(1-o)*(1-s)*(i.x-t.x),.5*(1-n)*(1+o)*(1-s)*(i.x-t.x)+.5*(1-n)*(1-o)*(1+s)*(r.x-i.x),i.x),h=a(t.y,.5*(1-n)*(1+o)*(1+s)*(t.y-e.y)+.5*(1-n)*(1-o)*(1-s)*(i.y-t.y),.5*(1-n)*(1+o)*(1-s)*(i.y-t.y)+.5*(1-n)*(1-o)*(1+s)*(r.y-i.y),i.y);return e=>new ee(l(e),h(e))}function At(e,t,i,r){let n=2*e+t-2*r+i,s=-3*e+3*r-2*t+i,o=t;return e=>3*n*(e*e)+2*s*e+o}function xt(e){return 0<=e&&e<=1}function bt(e,t){return Math.abs(e-t)<=Number.EPSILON}function Vt(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function Et(e,t,i,r){let n=3*e-6*t+3*i,s=-3*e+3*t,o=e,a=3*t-e-3*i+r;if(bt(a,0)){if(bt(n,0))return bt(s,0)?[]:[-o/s].filter(xt);let e=Math.sqrt(s*s-4*n*o),t=2*n;return[(e-s)/t,(-s-e)/t].filter(xt)}n/=a,s/=a,o/=a;let l=(3*s-n*n)/3,h=l/3,u=(2*n*n*n-9*n*s+27*o)/27,d=u/2,c=d*d+h*h*h;if(c<0){let e=-l/3,t=e*e*e,i=Math.sqrt(t),r=-u/(2*i),s=r<-1?-1:r>1?1:r,o=Math.acos(s),a=2*Vt(i);return[a*Math.cos(o/3)-n/3,a*Math.cos((o+2*Math.PI)/3)-n/3,a*Math.cos((o+4*Math.PI)/3)-n/3].filter(xt)}if(0===c){let e=d<0?Vt(-d):-Vt(d);return[2*e-n/3,-e-n/3].filter(xt)}let f=Math.sqrt(c);return[Vt(f-d)-Vt(f+d)-n/3].filter(xt)}function Mt(e,t,i,r,n){let s=Et(e.x-n,t.x-n,i.x-n,r.x-n);return s.length>0?lt(e,t,i,r,s[0]).y:NaN}function St(e){if(!e||0==e.length)throw new Error("Need at least one point for easingLinear.");let t=e.length;return i=>{if(i<=0||1==e.length||i<=e[0].x)return e[0].y;for(let r=0;r<t;r++)if(e[r].x>=i)return _(i,e[r-1].x,e[r].x,e[r-1].y,e[r].y);return e[e.length-1].y}}function Rt(e,t){return i=>Mt(te(0,0),e,t,te(1,1),i)}function It(e,t="jump-end"){let i=1/e,r=1/(e+("jump-end"==t||"jump-both"==t?1:0)),n="jump-start"==t||"jump-both"==t?r:0;return e=>{let t=Math.floor(e/i);return n+t*r}}function kt(e,t){let i=Number.MAX_VALUE,r={normal:te(0),distance:0};for(let n of[e,t])for(let s=0;s<n.pts.length;s++){let o=n.pts[s],a=n.pts[(s+1)%n.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let i=e.pts[t].dot(a);l=Math.min(l,i),h=Math.max(h,i)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let i=t.pts[e].dot(a);u=Math.min(u,i),d=Math.max(d,i)}let c=Math.min(h,d)-Math.max(l,u);if(c<0)return null;if(c<Math.abs(i)){let e=d-l,t=u-h;i=Math.abs(e)<Math.abs(t)?e:t,r.normal=a,r.distance=i}}return r}function Pt(e,t,i){return(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x)>=0}function Bt(e){let t=0,i=e[e.length-1];for(let r=0;r<e.length;r++)t+=(e[r].x-i.x)*(e[r].y+i.y),i=e[r];return t<0}function Dt(e,t,i,r){let n=r.x-i.x,s=r.y-i.y;return(n*(e.y-i.y)-s*(e.x-i.x))*(n*(t.y-i.y)-s*(t.x-i.x))>=0}function Tt(e,t,i,r){return Dt(e,t,i,r)&&Dt(e,i,t,r)&&Dt(e,r,t,i)}function Ft(e,t,i,r){for(let n of e)if(n!==t&&n!==i&&n!==r&&Tt(n,t,i,r))return!0;return!1}function Ct(e,t,i,r){return Pt(e,t,i)&&!Ft(r,e,t,i)}function Ot(e){if(e.length<3)return[];if(3==e.length)return[e];let t=[],i=[],r=0;for(let d=0;d<e.length;d++){let n=e[r],s=e[d];s.x<n.x||s.x==n.x&&(s.y,n.y),t[d]=d+1,i[d]=d-1}t[t.length-1]=0,i[0]=i.length-1,Bt(e)||([t,i]=[i,t]);let n=[];for(let d=0;d<e.length;++d)Pt(e[i[d]],e[d],e[t[d]])||n.push(e[d]);let s,o,a=[],l=e.length,h=1,u=0;for(;l>3;){s=t[h],o=i[h];let r=e[o],d=e[h],c=e[s];if(Ct(r,d,c,n))a.push([r,d,c]),t[o]=s,i[s]=o,n.splice(n.indexOf(d),1),--l,u=0;else if(++u>l)return[];h=s}return s=t[h],o=i[h],a.push([e[o],e[h],e[s]]),a}function Ut(e){if(e.length<3)return!1;let t=e.length-2,i=e.length-1,r=0,n=e[i].sub(e[t]),s=e[r].sub(e[i]),o=n.cross(s);for(;r+1<e.length;)if(t=i,i=r,r++,n=e[i].sub(e[t]),s=e[r].sub(e[i]),n.cross(s)*o<0)return!1;return!0}K(st,"evaluateQuadratic"),K(ot,"evaluateQuadraticFirstDerivative"),K(at,"evaluateQuadraticSecondDerivative"),K(lt,"evaluateBezier"),K(ht,"evaluateBezierFirstDerivative"),K(ut,"evaluateBezierSecondDerivative"),K(dt,"evaluateCatmullRom"),K(ct,"evaluateCatmullRomFirstDerivative"),K(ft,"normalizedCurve"),K(pt,"curveLengthApproximation"),K(gt,"hermite"),K(mt,"cardinal"),K(wt,"catmullRom"),K(yt,"bezier"),K(vt,"kochanekBartels"),K(At,"hermiteFirstDerivative"),K(xt,"inZeroOneDomain"),K(bt,"approximately"),K(Vt,"cubeRoot"),K(Et,"getCubicRoots"),K(Mt,"cubicBezierYforX"),K(St,"easingLinear"),K(Rt,"easingCubicBezier"),K(It,"easingSteps"),K(kt,"sat"),K(Pt,"isOrientedCcw"),K(Bt,"isOrientedCcwPolygon"),K(Dt,"onSameSide"),K(Tt,"pointInTriangle"),K(Ft,"someInTriangle"),K(Ct,"isEar"),K(Ot,"triangulate"),K(Ut,"isConvex");var Nt=K((e=>e[0]instanceof Y),"arrayIsColor"),Lt=K((e=>e[0]instanceof ee),"arrayIsVec2"),qt=K((e=>"number"==typeof e[0]),"arrayIsNumber");function Gt(e){return(null==e?void 0:e.prototype)&&void 0!==Object.getOwnPropertyDescriptor(e.prototype,"constructor")}K(Gt,"isClass");var jt=(K(f=class{constructor(e=(e,t)=>e<t){q(this,"_items"),q(this,"_compareFn"),this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},"BinaryHeap"),f);function Kt(e){let t=window.atob(e),i=t.length,r=new Uint8Array(i);for(let n=0;n<i;n++)r[n]=t.charCodeAt(n);return r.buffer}function Ht(e){return Kt(e.split(",")[1])}function Yt(e,t){let i=document.createElement("a");i.href=t,i.download=e,i.click()}function zt(e,t){Yt(e,"data:text/plain;charset=utf-8,"+t)}function Qt(e,t){zt(e,JSON.stringify(t))}function Wt(e,t){let i=URL.createObjectURL(t);Yt(e,i),URL.revokeObjectURL(i)}K(Kt,"base64ToArrayBuffer"),K(Ht,"dataURLToArrayBuffer"),K(Yt,"download"),K(zt,"downloadText"),K(Qt,"downloadJSON"),K(Wt,"downloadBlob");var Xt=K((e=>e.match(/^data:\w+\/\w+;base64,.+/)),"isDataURL"),Jt=K((e=>e.split(".").slice(0,-1).join(".")),"getFileName");function Zt(e,t){if(e===t)return!0;let i=typeof e,r=typeof t;if(i!==r)return!1;if("object"===i&&"object"===r&&null!==e&&null!==t){if(Array.isArray(e)!==Array.isArray(t))return!1;let i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let n of i){if(!Zt(e[n],t[n]))return!1}return!0}return!1}K(Zt,"deepEq");var _t=(p=class extends Map{constructor(){super(...arguments),q(this,"lastID",0)}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},K(p,"Registry"),p),$t=(g=class{constructor(e){q(this,"paused",!1),q(this,"cancel"),this.cancel=e}static join(e){let t=new g((()=>e.forEach((e=>e.cancel()))));return Object.defineProperty(t,"paused",{get:K((()=>e[0].paused),"get"),set:K((t=>e.forEach((e=>e.paused=t))),"set")}),t.paused=!1,t}},K(g,"KEventController"),g),ei=(K(m=class{constructor(){q(this,"handlers",new _t)}add(e){let t=this.handlers.pushd(((...t)=>{i.paused||e(...t)})),i=new $t(t);return i}addOnce(e){let t=this.add(((...i)=>{t.cancel(),e(...i)}));return t}next(){return new Promise((e=>this.addOnce(e)))}trigger(...e){this.handlers.forEach((t=>t(...e)))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},"KEvent"),m),ti=(K(w=class{constructor(){q(this,"handlers",{}),q(this,"registers",{})}on(e,t){return this.handlers[e]||(this.handlers[e]=new ei),this.handlers[e].add(t)}onOnce(e,t){let i=this.on(e,((...e)=>{i.cancel(),t(...e)}));return i}next(e){return new Promise((t=>{this.onOnce(e,((...e)=>t(e[0])))}))}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var t;return(null==(t=this.handlers[e])?void 0:t.numListeners())??0}},"KEventHandler"),w),ii=K((e=>e instanceof Error?e.message:String(e)),"getErrorMessage");function ri(e,t){return Number(e.toFixed(t))}function ni(e,t){return(...i)=>{let r=i.length;return r===e.length?e(...i):r===t.length?t(...i):void 0}}K(ri,"toFixed"),K(ni,"overload2");var si=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function oi(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");let t=[],i=0,r=0;for(;i<e.length;)r+=ai(i+r,e),gi(e[i+r])&&r++,ci(e[i+r])&&r++,fi(e[i+r])&&r++,mi(e[i+r])?r++:(t.push(e.substring(i,i+r)),i+=r,r=0);return t}function ai(e,t){let i=t[e];if(!li(i)||e===t.length-1)return 1;let r=i+t[e+1],n=t.substring(e+2,e+5);return hi(r)&&hi(n)?4:ui(r)&&pi(n)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:di(n)?4:2}function li(e){return e&&yi(e[0].charCodeAt(0),55296,56319)}function hi(e){return yi(wi(e),127462,127487)}function ui(e){return yi(wi(e),127988,127988)}function di(e){return yi(wi(e),127995,127999)}function ci(e){return"string"==typeof e&&yi(e.charCodeAt(0),65024,65039)}function fi(e){return"string"==typeof e&&yi(e.charCodeAt(0),8400,8447)}function pi(e){let t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&yi(t,917504,917631)}function gi(e){return"string"==typeof e&&si.includes(e.charCodeAt(0))}function mi(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function wi(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function yi(e,t,i){return e>=t&&e<=i}K(oi,"runes"),K(ai,"nextUnits"),K(li,"isFirstOfSurrogatePair"),K(hi,"isRegionalIndicator"),K(ui,"isSubdivisionFlag"),K(di,"isFitzpatrickModifier"),K(ci,"isVariationSelector"),K(fi,"isDiacriticalMark"),K(pi,"isSupplementarySpecialpurposePlane"),K(gi,"isGrapheme"),K(mi,"isZeroWidthJoiner"),K(wi,"codePointFromSurrogatePair"),K(yi,"betweenInclusive");var vi,Ai=K(((e,t)=>Array.isArray(e)?null==e?void 0:e.includes(t):e===t),"isEqOrIncludes"),xi=K(((e,t)=>Array.isArray(t)?t.some((t=>e.has(t))):e.has(t)),"setHasOrIncludes"),bi=K(((e,t,i)=>{var r;e.has(t)?null==(r=e.get(t))||r.push(i):e.set(t,[i])}),"mapAddOrPush"),Vi=(()=>{let e=0;return()=>e++})(),Ei={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Mi=K((()=>vi.lastInputDevice),"getLastInputDeviceType"),Si=K((()=>{let e=vi.buttons;for(let t in e){let i=e[t].keyboard&&[e[t].keyboard].flat(),r=e[t].gamepad&&[e[t].gamepad].flat(),n=e[t].mouse&&[e[t].mouse].flat();i&&i.forEach((e=>{bi(vi.buttonsByKey,e,t)})),r&&r.forEach((e=>{bi(vi.buttonsByGamepad,e,t)})),n&&n.forEach((e=>{bi(vi.buttonsByMouse,e,t)}))}}),"parseButtonBindings"),Ri=(K(y=class{constructor(){q(this,"pressed",new Set([])),q(this,"pressedRepeat",new Set([])),q(this,"released",new Set([])),q(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},"ButtonState"),y),Ii=(K(v=class{constructor(){q(this,"buttonState",new Ri),q(this,"stickState",new Map)}},"GamepadState"),v),ki=(K(A=class{constructor(){q(this,"dts",[]),q(this,"timer",0),q(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((e,t)=>e+t))/this.dts.length)),this.dts=[])}},"FPSCounter"),A),Pi=K((e=>{let t=e.buttons??{};return{canvas:e.canvas,buttons:t,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,loopID:null,stopped:!1,dt:0,fixedDt:.02,restDt:0,time:0,realTime:0,fpsCounter:new ki,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new ee(0),mouseDeltaPos:new ee(0),keyState:new Ri,mouseState:new Ri,mergedGamepadState:new Ii,gamepadStates:new Map,lastInputDevice:null,buttonState:new Ri,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new ti}}),"initAppState"),Bi=K((e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t=Pi(e);function i(){return t.dt*t.timeScale}function r(){return t.fixedDt*t.timeScale}function n(){return t.restDt*t.timeScale}function s(){return t.isHidden}function o(){return t.time}function a(){return t.fpsCounter.fps}function l(){return t.numFrames}function h(){return t.canvas.toDataURL()}function u(e){t.canvas.style.cursor=e}function d(){return t.canvas.style.cursor}function c(e){if(e)try{let e=t.canvas.requestPointerLock();e.catch&&e.catch((e=>console.error(e)))}catch(i){console.error(i)}else document.exitPointerLock()}function f(){return!!document.pointerLockElement}function p(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function g(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function m(e=!0){e?p(t.canvas):g()}function w(){return document.fullscreenElement===t.canvas||document.webkitFullscreenElement===t.canvas}function y(){t.stopped=!0;let e=Object.entries(be),i=Object.entries(Ve),r=Object.entries(Ee);for(let[n,s]of e)t.canvas.removeEventListener(n,s);for(let[t,n]of i)document.removeEventListener(t,n);for(let[t,n]of r)window.removeEventListener(t,n);ke.disconnect()}function v(r,n){null!==t.loopID&&cancelAnimationFrame(t.loopID);let s=0,o=0,a=K((l=>{if(t.stopped)return;if("visible"!==document.visibilityState)return void(t.loopID=requestAnimationFrame(a));let h=l/1e3,u=Math.min(h-t.realTime,.25),d=e.maxFPS?1/e.maxFPS:0;if(t.realTime=h,o+=u,o>d){if(!t.skipTime){for(s+=o,t.dt=t.fixedDt,t.restDt=0;s>t.fixedDt;)s-=t.fixedDt,s<t.fixedDt&&(t.restDt=s),r();t.restDt=s,t.dt=o,t.time+=i(),t.fpsCounter.tick(t.dt)}o=0,t.skipTime=!1,t.numFrames++,n(we,ye)}t.loopID=requestAnimationFrame(a)}),"frame");a(0)}function A(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function x(){return t.mousePos.clone()}function b(){return t.mouseDeltaPos.clone()}function V(e="left"){return t.mouseState.pressed.has(e)}function E(e="left"){return t.mouseState.down.has(e)}function M(e="left"){return t.mouseState.released.has(e)}function S(){return t.isMouseMoved}function R(e){return void 0===e?t.keyState.pressed.size>0:xi(t.keyState.pressed,e)}function I(e){return void 0===e?t.keyState.pressedRepeat.size>0:xi(t.keyState.pressedRepeat,e)}function k(e){return void 0===e?t.keyState.down.size>0:xi(t.keyState.down,e)}function P(e){return void 0===e?t.keyState.released.size>0:xi(t.keyState.released,e)}function B(e){return void 0===e?t.mergedGamepadState.buttonState.pressed.size>0:xi(t.mergedGamepadState.buttonState.pressed,e)}function D(e){return void 0===e?t.mergedGamepadState.buttonState.down.size>0:xi(t.mergedGamepadState.buttonState.down,e)}function T(e){return void 0===e?t.mergedGamepadState.buttonState.released.size>0:xi(t.mergedGamepadState.buttonState.released,e)}function F(e){return void 0===e?t.buttonState.pressed.size>0:xi(t.buttonState.pressed,e)}function C(e){return void 0===e?t.buttonState.down.size>0:xi(t.buttonState.down,e)}function O(e){return void 0===e?t.buttonState.released.size>0:xi(t.buttonState.released,e)}function U(e){var i;return null==(i=t.buttons)?void 0:i[e]}function N(e,i){t.buttons[e]={...t.buttons[e],...i}}function L(e){return t.events.on("resize",e)}vi=t,Si(),K(i,"dt"),K(r,"fixedDt"),K(n,"restDt"),K(s,"isHidden"),K(o,"time"),K(a,"fps"),K(l,"numFrames"),K(h,"screenshot"),K(u,"setCursor"),K(d,"getCursor"),K(c,"setCursorLocked"),K(f,"isCursorLocked"),K(p,"enterFullscreen"),K(g,"exitFullscreen"),K(m,"setFullscreen"),K(w,"isFullscreen"),K(y,"quit"),K(v,"run"),K(A,"isTouchscreen"),K(x,"mousePos"),K(b,"mouseDeltaPos"),K(V,"isMousePressed"),K(E,"isMouseDown"),K(M,"isMouseReleased"),K(S,"isMouseMoved"),K(R,"isKeyPressed"),K(I,"isKeyPressedRepeat"),K(k,"isKeyDown"),K(P,"isKeyReleased"),K(B,"isGamepadButtonPressed"),K(D,"isGamepadButtonDown"),K(T,"isGamepadButtonReleased"),K(F,"isButtonPressed"),K(C,"isButtonDown"),K(O,"isButtonReleased"),K(U,"getButton"),K(N,"setButton"),K(L,"onResize");let q=ni((e=>t.events.on("keyDown",e)),((e,i)=>t.events.on("keyDown",(t=>Ai(e,t)&&i(t))))),G=ni((e=>t.events.on("keyPress",(t=>e(t)))),((e,i)=>t.events.on("keyPress",(t=>Ai(e,t)&&i(t))))),j=ni((e=>t.events.on("keyPressRepeat",e)),((e,i)=>t.events.on("keyPressRepeat",(t=>Ai(e,t)&&i(t))))),H=ni((e=>t.events.on("keyRelease",e)),((e,i)=>t.events.on("keyRelease",(t=>Ai(e,t)&&i(t))))),Y=ni((e=>t.events.on("mouseDown",(t=>e(t)))),((e,i)=>t.events.on("mouseDown",(t=>Ai(e,t)&&i(t))))),z=ni((e=>t.events.on("mousePress",(t=>e(t)))),((e,i)=>t.events.on("mousePress",(t=>Ai(e,t)&&i(t))))),Q=ni((e=>t.events.on("mouseRelease",(t=>e(t)))),((e,i)=>t.events.on("mouseRelease",(t=>t===e&&i(t)))));function W(e){return t.events.on("mouseMove",(()=>e(x(),b())))}function X(e){return t.events.on("charInput",e)}function J(e){return t.events.on("touchStart",e)}function Z(e){return t.events.on("touchMove",e)}function $(e){return t.events.on("touchEnd",e)}function ie(e){return t.events.on("scroll",e)}function re(e){return t.events.on("hide",e)}function ne(e){return t.events.on("show",e)}K(W,"onMouseMove"),K(X,"onCharInput"),K(J,"onTouchStart"),K(Z,"onTouchMove"),K($,"onTouchEnd"),K(ie,"onScroll"),K(re,"onHide"),K(ne,"onShow");let se=ni((e=>t.events.on("gamepadButtonPress",((t,i)=>e(t,i)))),((e,i)=>t.events.on("gamepadButtonPress",((t,r)=>Ai(e,t)&&i(t,r))))),oe=ni((e=>t.events.on("gamepadButtonDown",((t,i)=>e(t,i)))),((e,i)=>t.events.on("gamepadButtonDown",((t,r)=>Ai(e,t)&&i(t,r))))),ae=ni((e=>t.events.on("gamepadButtonRelease",((t,i)=>e(t,i)))),((e,i)=>t.events.on("gamepadButtonRelease",((t,r)=>Ai(e,t)&&i(t,r)))));function le(e,i){return t.events.on("gamepadStick",((t,r,n)=>t===e&&i(r,n)))}function he(e){t.events.on("gamepadConnect",e)}function ue(e){t.events.on("gamepadDisconnect",e)}function de(e){return t.mergedGamepadState.stickState.get(e)||new ee(0)}function ce(){return[...t.charInputted]}function fe(){return[...t.gamepads]}K(le,"onGamepadStick"),K(he,"onGamepadConnect"),K(ue,"onGamepadDisconnect"),K(de,"getGamepadStick"),K(ce,"charInputted"),K(fe,"getGamepads");let pe=ni((e=>t.events.on("buttonPress",(t=>e(t)))),((e,i)=>t.events.on("buttonPress",(t=>Ai(e,t)&&i(t))))),ge=ni((e=>t.events.on("buttonDown",(t=>e(t)))),((e,i)=>t.events.on("buttonDown",(t=>Ai(e,t)&&i(t))))),me=ni((e=>t.events.on("buttonRelease",(t=>e(t)))),((e,i)=>t.events.on("buttonRelease",(t=>Ai(e,t)&&i(t)))));function we(){t.events.trigger("input"),t.keyState.down.forEach((e=>t.events.trigger("keyDown",e))),t.mouseState.down.forEach((e=>t.events.trigger("mouseDown",e))),t.buttonState.down.forEach((e=>t.events.trigger("buttonDown",e))),xe()}function ye(){t.keyState.update(),t.mouseState.update(),t.buttonState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach(((e,i)=>{t.mergedGamepadState.stickState.set(i,new ee(0))})),t.charInputted=[],t.isMouseMoved=!1,t.mouseDeltaPos=new ee(0),t.gamepadStates.forEach((e=>{e.buttonState.update(),e.stickState.forEach(((t,i)=>{e.stickState.set(i,new ee(0))}))}))}function ve(e){let i={index:e.index,isPressed:K((i=>{var r;return(null==(r=t.gamepadStates.get(e.index))?void 0:r.buttonState.pressed.has(i))||!1}),"isPressed"),isDown:K((i=>{var r;return(null==(r=t.gamepadStates.get(e.index))?void 0:r.buttonState.down.has(i))||!1}),"isDown"),isReleased:K((i=>{var r;return(null==(r=t.gamepadStates.get(e.index))?void 0:r.buttonState.released.has(i))||!1}),"isReleased"),getStick:K((i=>{var r;return(null==(r=t.gamepadStates.get(e.index))?void 0:r.stickState.get(i))||te()}),"getStick")};return t.gamepads.push(i),t.gamepadStates.set(e.index,{buttonState:new Ri,stickState:new Map([["left",new ee(0)],["right",new ee(0)]])}),i}function Ae(e){t.gamepads=t.gamepads.filter((t=>t.index!==e.index)),t.gamepadStates.delete(e.index)}function xe(){var i,r,n;for(let e of navigator.getGamepads())e&&!t.gamepadStates.has(e.index)&&ve(e);for(let s of t.gamepads){let o=navigator.getGamepads()[s.index];if(!o)continue;let a=(e.gamepads??{})[o.id]??Ei[o.id]??Ei.default,l=t.gamepadStates.get(s.index);if(l){for(let e=0;e<o.buttons.length;e++){let h=a.buttons[e],u=o.buttons[e],d=t.buttonsByGamepad.has(h);u.pressed?(l.buttonState.down.has(h)||(t.lastInputDevice="gamepad",d&&(null==(i=t.buttonsByGamepad.get(h))||i.forEach((e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)}))),t.mergedGamepadState.buttonState.press(h),l.buttonState.press(h),t.events.trigger("gamepadButtonPress",h,s)),d&&(null==(r=t.buttonsByGamepad.get(h))||r.forEach((e=>{t.buttonState.press(e),t.events.trigger("buttonDown",e)}))),t.events.trigger("gamepadButtonDown",h,s)):l.buttonState.down.has(h)&&(d&&(null==(n=t.buttonsByGamepad.get(h))||n.forEach((e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)}))),t.mergedGamepadState.buttonState.release(h),l.buttonState.release(h),t.events.trigger("gamepadButtonRelease",h,s))}for(let e in a.sticks){let i=a.sticks[e];if(!i)continue;let r=new ee(o.axes[i.x],o.axes[i.y]);l.stickState.set(e,r),t.mergedGamepadState.stickState.set(e,r),t.events.trigger("gamepadStick",e,r,s)}}}}K(we,"processInput"),K(ye,"resetInput"),K(ve,"registerGamepad"),K(Ae,"removeGamepad"),K(xe,"processGamepad");let be={},Ve={},Ee={},Me=e.pixelDensity||window.devicePixelRatio||1;be.mousemove=e=>{let i=new ee(e.offsetX,e.offsetY),r=new ee(e.movementX,e.movementY);if(w()){let r=t.canvas.width/Me,n=t.canvas.height/Me,s=window.innerWidth,o=window.innerHeight;if(s/o>r/n){let t=o/n,a=(s-r*t)/2;i.x=_(e.offsetX-a,0,r*t,0,r),i.y=_(e.offsetY,0,n*t,0,n)}else{let t=s/r,a=(o-n*t)/2;i.x=_(e.offsetX,0,r*t,0,r),i.y=_(e.offsetY-a,0,n*t,0,n)}}t.events.onOnce("input",(()=>{t.isMouseMoved=!0,t.mousePos=i,t.mouseDeltaPos=r,t.events.trigger("mouseMove")}))};let Se=["left","middle","right","back","forward"];be.mousedown=e=>{t.events.onOnce("input",(()=>{var i;let r=Se[e.button];r&&(t.lastInputDevice="mouse",t.buttonsByMouse.has(r)&&(null==(i=t.buttonsByMouse.get(r))||i.forEach((e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)}))),t.mouseState.press(r),t.events.trigger("mousePress",r))}))},be.mouseup=e=>{t.events.onOnce("input",(()=>{var i;let r=Se[e.button];r&&(t.buttonsByMouse.has(r)&&(null==(i=t.buttonsByMouse.get(r))||i.forEach((e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)}))),t.mouseState.release(r),t.events.trigger("mouseRelease",r))}))};let Re=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Ie={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};be.keydown=e=>{Re.has(e.key)&&e.preventDefault(),t.events.onOnce("input",(()=>{var i;let r=Ie[e.key]||e.key.toLowerCase();if(void 0===r)throw new Error(`Unknown key: ${e.key}`);1===r.length?(t.events.trigger("charInput",r),t.charInputted.push(r)):"space"===r&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),e.repeat?(t.keyState.pressRepeat(r),t.events.trigger("keyPressRepeat",r)):(t.lastInputDevice="keyboard",t.buttonsByKey.has(r)&&(null==(i=t.buttonsByKey.get(r))||i.forEach((e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)}))),t.keyState.press(r),t.events.trigger("keyPressRepeat",r),t.events.trigger("keyPress",r))}))},be.keyup=e=>{t.events.onOnce("input",(()=>{var i;let r=Ie[e.key]||e.key.toLowerCase();t.buttonsByKey.has(r)&&(null==(i=t.buttonsByKey.get(r))||i.forEach((e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)}))),t.keyState.release(r),t.events.trigger("keyRelease",r)}))},be.touchstart=i=>{i.preventDefault(),t.events.onOnce("input",(()=>{var r;let n=[...i.changedTouches],s=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new ee(n[0].clientX-s.x,n[0].clientY-s.y),t.lastInputDevice="mouse",t.buttonsByMouse.has("left")&&(null==(r=t.buttonsByMouse.get("left"))||r.forEach((e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)}))),t.mouseState.press("left"),t.events.trigger("mousePress","left")),n.forEach((e=>{t.events.trigger("touchStart",new ee(e.clientX-s.x,e.clientY-s.y),e)}))}))},be.touchmove=i=>{i.preventDefault(),t.events.onOnce("input",(()=>{let r=[...i.changedTouches],n=t.canvas.getBoundingClientRect();if(!1!==e.touchToMouse){let e=t.mousePos;t.mousePos=new ee(r[0].clientX-n.x,r[0].clientY-n.y),t.mouseDeltaPos=t.mousePos.sub(e),t.events.trigger("mouseMove")}r.forEach((e=>{t.events.trigger("touchMove",new ee(e.clientX-n.x,e.clientY-n.y),e)}))}))},be.touchend=i=>{t.events.onOnce("input",(()=>{var r;let n=[...i.changedTouches],s=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new ee(n[0].clientX-s.x,n[0].clientY-s.y),t.mouseDeltaPos=new ee(0,0),t.buttonsByMouse.has("left")&&(null==(r=t.buttonsByMouse.get("left"))||r.forEach((e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)}))),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),n.forEach((e=>{t.events.trigger("touchEnd",new ee(e.clientX-s.x,e.clientY-s.y),e)}))}))},be.touchcancel=i=>{t.events.onOnce("input",(()=>{let r=[...i.changedTouches],n=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new ee(r[0].clientX-n.x,r[0].clientY-n.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),r.forEach((e=>{t.events.trigger("touchEnd",new ee(e.clientX-n.x,e.clientY-n.y),e)}))}))},be.wheel=e=>{e.preventDefault(),t.events.onOnce("input",(()=>{t.events.trigger("scroll",new ee(e.deltaX,e.deltaY))}))},be.contextmenu=e=>e.preventDefault(),Ve.visibilitychange=()=>{"visible"===document.visibilityState?(t.skipTime=!0,t.isHidden=!1,t.events.trigger("show")):(t.isHidden=!0,t.events.trigger("hide"))},Ee.gamepadconnected=e=>{let i=ve(e.gamepad);t.events.onOnce("input",(()=>{t.events.trigger("gamepadConnect",i)}))},Ee.gamepaddisconnected=e=>{let i=fe().filter((t=>t.index===e.gamepad.index))[0];Ae(e.gamepad),t.events.onOnce("input",(()=>{t.events.trigger("gamepadDisconnect",i)}))};for(let[K,_]of Object.entries(be))t.canvas.addEventListener(K,_);for(let[K,_]of Object.entries(Ve))document.addEventListener(K,_);for(let[K,_]of Object.entries(Ee))window.addEventListener(K,_);let ke=new ResizeObserver((e=>{for(let i of e)if(i.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",(()=>{t.events.trigger("resize")}))}}));return ke.observe(t.canvas),{dt:i,fixedDt:r,restDt:n,time:o,run:v,canvas:t.canvas,fps:a,numFrames:l,quit:y,isHidden:s,setFullscreen:m,isFullscreen:w,setCursor:u,screenshot:h,getGamepads:fe,getCursor:d,setCursorLocked:c,isCursorLocked:f,isTouchscreen:A,mousePos:x,mouseDeltaPos:b,isKeyDown:k,isKeyPressed:R,isKeyPressedRepeat:I,isKeyReleased:P,isMouseDown:E,isMousePressed:V,isMouseReleased:M,isMouseMoved:S,isGamepadButtonPressed:B,isGamepadButtonDown:D,isGamepadButtonReleased:T,getGamepadStick:de,isButtonPressed:F,isButtonDown:C,isButtonReleased:O,setButton:N,getButton:U,charInputted:ce,onResize:L,onKeyDown:q,onKeyPress:G,onKeyPressRepeat:j,onKeyRelease:H,onMouseDown:Y,onMousePress:z,onMouseRelease:Q,onMouseMove:W,onCharInput:X,onTouchStart:J,onTouchMove:Z,onTouchEnd:$,onScroll:ie,onHide:re,onShow:ne,onGamepadButtonDown:oe,onGamepadButtonPress:se,onGamepadButtonRelease:ae,onGamepadStick:le,onGamepadConnect:he,onGamepadDisconnect:ue,onButtonPress:pe,onButtonDown:ge,onButtonRelease:me,getLastInputDeviceType:Mi,events:t.events}}),"initApp");function Di(){return na.dt()*la.timeScale}function Ti(){return na.fixedDt()*la.timeScale}function Fi(){return na.restDt()*la.timeScale}function Ci(e){switch(e){case"topleft":return new ee(-1,-1);case"top":return new ee(0,-1);case"topright":return new ee(1,-1);case"left":return new ee(-1,0);case"center":return new ee(0,0);case"right":return new ee(1,0);case"botleft":return new ee(-1,1);case"bot":return new ee(0,1);case"botright":return new ee(1,1);default:return e}}function Oi(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Ui(e){return e.createBuffer(1,1,44100)}K(Di,"dt"),K(Ti,"fixedDt"),K(Fi,"restDt"),K(Ci,"anchorPt"),K(Oi,"alignPt"),K(Ui,"createEmptyAudioBuffer");var Ni=2.5949095,Li=2.70158,qi=2*Math.PI/3,Gi=2*Math.PI/4.5,ji={linear:K((e=>e),"linear"),easeInSine:K((e=>1-Math.cos(e*Math.PI/2)),"easeInSine"),easeOutSine:K((e=>Math.sin(e*Math.PI/2)),"easeOutSine"),easeInOutSine:K((e=>-(Math.cos(Math.PI*e)-1)/2),"easeInOutSine"),easeInQuad:K((e=>e*e),"easeInQuad"),easeOutQuad:K((e=>1-(1-e)*(1-e)),"easeOutQuad"),easeInOutQuad:K((e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2),"easeInOutQuad"),easeInCubic:K((e=>e*e*e),"easeInCubic"),easeOutCubic:K((e=>1-Math.pow(1-e,3)),"easeOutCubic"),easeInOutCubic:K((e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2),"easeInOutCubic"),easeInQuart:K((e=>e*e*e*e),"easeInQuart"),easeOutQuart:K((e=>1-Math.pow(1-e,4)),"easeOutQuart"),easeInOutQuart:K((e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2),"easeInOutQuart"),easeInQuint:K((e=>e*e*e*e*e),"easeInQuint"),easeOutQuint:K((e=>1-Math.pow(1-e,5)),"easeOutQuint"),easeInOutQuint:K((e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2),"easeInOutQuint"),easeInExpo:K((e=>0===e?0:Math.pow(2,10*e-10)),"easeInExpo"),easeOutExpo:K((e=>1===e?1:1-Math.pow(2,-10*e)),"easeOutExpo"),easeInOutExpo:K((e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2),"easeInOutExpo"),easeInCirc:K((e=>1-Math.sqrt(1-Math.pow(e,2))),"easeInCirc"),easeOutCirc:K((e=>Math.sqrt(1-Math.pow(e-1,2))),"easeOutCirc"),easeInOutCirc:K((e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2),"easeInOutCirc"),easeInBack:K((e=>Li*e*e*e-1.70158*e*e),"easeInBack"),easeOutBack:K((e=>1+Li*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2)),"easeOutBack"),easeInOutBack:K((e=>e<.5?Math.pow(2*e,2)*(7.189819*e-Ni)/2:(Math.pow(2*e-2,2)*((Ni+1)*(2*e-2)+Ni)+2)/2),"easeInOutBack"),easeInElastic:K((e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*qi)),"easeInElastic"),easeOutElastic:K((e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*qi)+1),"easeOutElastic"),easeInOutElastic:K((e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*Gi)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*Gi)/2+1),"easeInOutElastic"),easeInBounce:K((e=>1-ji.easeOutBounce(1-e)),"easeInBounce"),easeOutBounce:K((e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375),"easeOutBounce"),easeInOutBounce:K((e=>e<.5?(1-ji.easeOutBounce(1-2*e))/2:(1+ji.easeOutBounce(2*e-1))/2),"easeInOutBounce")},Ki=ji;function Hi(e,t,i){let r=[],n=t;for(r.push(n);n!==e;){if(n=i.get(n),null==n)return null;r.push(n)}return r.reverse()}function Yi(e,t,i){var r;let n=new jt(((e,t)=>e.cost<t.cost));n.insert({cost:0,node:t});let s=new Map;s.set(t,t);let o=new Map;for(o.set(t,0);0!==n.length;){let t=null==(r=n.remove())?void 0:r.node;if(t===i)break;let a=e.getNeighbours(t);for(let r of a){let a=(o.get(t)||0)+e.getCost(t,r)+e.getHeuristic(r,i);(!o.has(r)||a<o.get(r))&&(o.set(r,a),n.insert({cost:a,node:r}),s.set(r,t))}}return Hi(t,i,s)}K(Hi,"buildPath"),K(Yi,"aStarSearch");var zi=(K(x=class{constructor(e,t,i){q(this,"a"),q(this,"b"),q(this,"polygon"),this.a=e,this.b=t,this.polygon=new WeakRef(i)}isLeft(e,t){return(this.b.x-this.a.x)*(t-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},"NavEdge"),x),Qi=(K(b=class{constructor(e){q(this,"_edges"),q(this,"_centroid"),q(this,"_id"),this._id=e}get id(){return this._id}set edges(e){this._edges=e;let t=0,i=0,r=0;for(let n of this._edges){n.polygon=new WeakRef(this);let e=n.a.x*n.b.y-n.a.y*n.b.x;t+=(n.a.x+n.b.x)*e,i+=(n.a.y+n.b.y)*e,r+=e}r/=2,this._centroid=te(t/(6*r),i/(6*r))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let t=!1;for(let i of this.edges)i.b.y>e.y!=i.a.y>e.y&&e.x<(i.a.x-i.b.x)*(e.y-i.b.y)/(i.a.y-i.b.y)+i.b.x&&(t=!t);return t}},"NavPolygon"),b),Wi=(K(V=class{constructor(){q(this,"_polygons"),q(this,"_pointCache"),q(this,"_edgeCache"),this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let t=this._pointCache[`${e.x}_${e.y}`];return t||(t=e.clone(),this._pointCache[`${e.x}_${e.y}`]=t,t)}_addEdge(e){let t=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[t]=e,e}_findEdge(e,t){let i=`${e.x}_${e.y}-${t.x}_${t.y}`;return this._edgeCache[i]}_findCommonEdge(e,t){for(let i of e.edges){let e=this._findEdge(i.b,i.a);if(e&&e.polygon.deref().id===t.id)return e}return null}addPolygon(e){let t=new Qi(this._polygons.length),i=e.map(((i,r)=>new zi(i,e[(r+1)%e.length],t)));t.edges=i,this._polygons.push(t);for(let r of t.edges)this._addEdge(r);return t}addRect(e,t){let i=this._addPoint(e),r=this._addPoint(e.add(t.x,0)),n=this._addPoint(e.add(t)),s=this._addPoint(e.add(0,t.y));return this.addPolygon([i,r,n,s])}_getLocation(e){for(let t of this._polygons)if(t.contains(e))return t;return null}getNeighbours(e){let t=[];for(let i of this._polygons[e].edges){let e=this._findEdge(i.b,i.a);if(e){let i=e.polygon.deref();i&&t.push(i.id)}}return t}getCost(e,t){return 1}getHeuristic(e,t){let i=this._polygons[e],r=this._polygons[t],n=i.centroid.x-r.centroid.x,s=i.centroid.y-r.centroid.y;return Math.sqrt(n*n+s*s)}getPath(e,t){return void 0===e||void 0===t?[]:e===t?[e,t]:Yi(this,e,t)}getWaypointPath(e,t,i){let r=(null==i?void 0:i.type)||"centroids",n=this._getLocation(e),s=this._getLocation(t);if(void 0===n||void 0===s)return[];let o=this.getPath(n.id,s.id);if(!o)return[];if("edges"===r){let i=[];for(let e=1;e<o.length;e++){let t=this._polygons[o[e-1]],r=this._polygons[o[e]],n=this._findCommonEdge(t,r);i.push(n.middle.add(r.centroid.sub(n.middle).unit().scale(4)))}return[e,...i,t]}return[e,...o.slice(1,-1).map((e=>this._polygons[e].centroid)),t]}},"NavMesh"),V);function Xi(e){let t=new oe;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function Ji(e){return new ee(e.x/ar()*2-1,-e.y/lr()*2+1)}function Zi(e,t,i,r,n,s=1){r=W(r%360),(n=W(n%360))<=r&&(n+=2*Math.PI);let o=[],a=Math.ceil((n-r)/W(8)*s),l=(n-r)/a,h=te(Math.cos(r),Math.sin(r)),u=te(Math.cos(l),Math.sin(l));for(let d=0;d<=a;d++)o.push(e.add(t*h.x,i*h.y)),h=te(h.x*u.x-h.y*u.y,h.x*u.y+h.y*u.x);return o}function _i(...e){let t=z(...e),i=e[3]??1;ia.bgColor=t,ia.bgAlpha=i,ia.ggl.gl.clearColor(t.r/255,t.g/255,t.b/255,i)}function $i(){var e,t;return(null==(t=null==(e=ia.bgColor)?void 0:e.clone)?void 0:t.call(e))??null}function er(...e){if(void 0===e[0])return;let t=te(...e);0===t.x&&0===t.y||ia.transform.translate(t)}function tr(){ia.transformStack.push(ia.transform.clone())}function ir(e){ia.transform=e.clone()}function rr(...e){if(void 0===e[0])return;let t=te(...e);1===t.x&&1===t.y||ia.transform.scale(t)}function nr(e){e&&ia.transform.rotate(e)}function sr(){ia.transformStack.length>0&&(ia.transform=ia.transformStack.pop())}function or(){ia.renderer.flush()}function ar(){return ia.width}function lr(){return ia.height}function hr(){return(ia.viewport.width+ia.viewport.height)/(ia.width+ia.height)}function ur(e){return new ee(e.x*ia.viewport.width/ia.width,e.y*ia.viewport.height/ia.height)}function dr(e){return new ee((e.x-ia.viewport.x)*ar()/ia.viewport.width,(e.y-ia.viewport.y)*lr()/ia.viewport.height)}function cr(){return dr(na.mousePos())}function fr(){return te(ar()/2,lr()/2)}K(Xi,"calcTransform"),K(Ji,"screen2ndc"),K(Zi,"getArcPts"),K(_i,"setBackground"),K($i,"getBackground"),K(er,"pushTranslate"),K(tr,"pushTransform"),K(ir,"pushMatrix"),K(rr,"pushScale"),K(nr,"pushRotate"),K(sr,"popTransform"),K(or,"flush"),K(ar,"width"),K(lr,"height"),K(hr,"getViewportScale"),K(ur,"contentToView"),K(dr,"windowToContent"),K(cr,"mousePos"),K(fr,"center");var pr=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",gr="topleft",mr="monospace",wr="monospace",yr="linear",vr=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Ar=8192*vr.reduce(((e,t)=>e+t.size),0),xr="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",br="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",Vr="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",Er="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Mr=new Set(["id","require"]),Sr=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),Rr=/^\w+$/,Ir=(K(E=class{constructor(e,t,i){q(this,"textures",[]),q(this,"bigTextures",[]),q(this,"canvas"),q(this,"c2d"),q(this,"x",0),q(this,"y",0),q(this,"curHeight",0),q(this,"gfx"),this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=i,this.textures=[kn.fromImage(e,this.canvas)],this.bigTextures=[];let r=this.canvas.getContext("2d");if(!r)throw new Error("Failed to get 2d context");this.c2d=r}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height){let t=kn.fromImage(this.gfx,e);return this.bigTextures.push(t),[t,new ie(0,0,1,1)]}this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(kn.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],i=new ee(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,i.x,i.y):this.c2d.drawImage(e,i.x,i.y),t.update(this.canvas),[t,new ie(i.x/this.canvas.width,i.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}},"TexPacker"),E);function kr(e){return"string"!=typeof e||Xt(e)?e:sa.urlPrefix+e}K(kr,"fixURL");var Pr=(K(M=class{constructor(e){q(this,"loaded",!1),q(this,"data",null),q(this,"error",null),q(this,"onLoadEvents",new ei),q(this,"onErrorEvents",new ei),q(this,"onFinishEvents",new ei),e.then((e=>{this.loaded=!0,this.data=e,this.onLoadEvents.trigger(e)})).catch((e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)})).finally((()=>{this.onFinishEvents.trigger(),this.loaded=!0}))}static loaded(e){let t=new M(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},"Asset"),M),Br=(K(S=class{constructor(){q(this,"assets",new Map),q(this,"lastUID",0)}add(e,t){let i=e??this.lastUID+++"",r=new Pr(t);return this.assets.set(i,r),r}addLoaded(e,t){let i=e??this.lastUID+++"",r=Pr.loaded(t);return this.assets.set(i,r),r}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach((t=>{t.loaded&&e++})),e/this.assets.size}},"AssetBucket"),S);function Dr(e){return fetch(e).then((t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t}))}function Tr(e){return Dr(e).then((e=>e.json()))}function Fr(e){return Dr(e).then((e=>e.text()))}function Cr(e){return Dr(e).then((e=>e.arrayBuffer()))}function Or(e){return void 0!==e&&(sa.urlPrefix=e),sa.urlPrefix}function Ur(e,t){return sa.custom.add(e,Tr(kr(t)))}function Nr(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise(((i,r)=>{t.onload=()=>i(t),t.onerror=()=>r(new Error(`Failed to load image from "${e}"`))}))}function Lr(){let e=[sa.sprites,sa.sounds,sa.shaders,sa.fonts,sa.bitmapFonts,sa.custom];return e.reduce(((e,t)=>e+t.progress()),0)/e.length}function qr(e){return sa.custom.get(e)??null}function Gr(e){return sa.custom.add(null,e)}K(Dr,"fetchURL"),K(Tr,"fetchJSON"),K(Fr,"fetchText"),K(Cr,"fetchArrayBuffer"),K(Or,"loadRoot"),K(Ur,"loadJSON"),K(Nr,"loadImg"),K(Lr,"loadProgress"),K(qr,"getAsset"),K(Gr,"load");var jr=K((e=>({urlPrefix:"",sprites:new Br,fonts:new Br,bitmapFonts:new Br,sounds:new Br,shaders:new Br,custom:new Br,music:{},packer:new Ir(e,2048,2048),loaded:!1})),"initAssets"),Kr=(K(R=class{constructor(e,t,i={},r=null){q(this,"tex"),q(this,"frames",[new ie(0,0,1,1)]),q(this,"anims",{}),q(this,"slice9",null),this.tex=e,t&&(this.frames=t),this.anims=i,this.slice9=r}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,t={}){return"string"==typeof e?R.fromURL(e,t):Promise.resolve(R.fromImage(e,t))}static fromImage(e,t={}){let[i,r]=sa.packer.add(e),n=t.frames?t.frames.map((e=>new ie(r.x+e.x*r.w,r.y+e.y*r.h,e.w*r.w,e.h*r.h))):Qr(t.sliceX||1,t.sliceY||1,r.x,r.y,r.w,r.h);return new R(i,n,t.anims,t.slice9)}static fromURL(e,t={}){return Nr(e).then((e=>R.fromImage(e,t)))}},"SpriteData"),R);function Hr(e){if("string"==typeof e){let t=Yr(e);if(t)return t;if(Lr()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof Kr)return Pr.loaded(e);if(e instanceof Pr)return e;throw new Error(`Invalid sprite: ${e}`)}function Yr(e){return sa.sprites.get(e)??null}function zr(e,t,i={sliceX:1,sliceY:1,anims:{}}){return t=kr(t),Array.isArray(t)?t.some((e=>"string"==typeof e))?sa.sprites.add(e,Promise.all(t.map((e=>"string"==typeof e?Nr(e):Promise.resolve(e)))).then((e=>Wr(e,i)))):sa.sprites.addLoaded(e,Wr(t,i)):"string"==typeof t?sa.sprites.add(e,Kr.from(t,i)):sa.sprites.addLoaded(e,Kr.fromImage(t,i))}function Qr(e=1,t=1,i=0,r=0,n=1,s=1){let o=[],a=n/e,l=s/t;for(let h=0;h<t;h++)for(let t=0;t<e;t++)o.push(new ie(i+t*a,r+h*l,a,l));return o}function Wr(e,t={}){let i=document.createElement("canvas"),r=e[0].width,n=e[0].height;i.width=r*e.length,i.height=n;let s=i.getContext("2d");if(!s)throw new Error("Failed to create canvas context");e.forEach(((e,t)=>{e instanceof ImageData?s.putImageData(e,t*r,0):s.drawImage(e,t*r,0)}));let o=s.getImageData(0,0,e.length*r,n);return Kr.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function Xr(e="bean"){return zr(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function Jr(e,t,i){t=kr(t),i=kr(i),"string"==typeof t&&!i&&(i=Jt(t)+".json");let r="string"==typeof i?Tr(i):Promise.resolve(i);return sa.sprites.add(e,r.then((e=>{let i=e.meta.size,r=e.frames.map((e=>new ie(e.frame.x/i.w,e.frame.y/i.h,e.frame.w/i.w,e.frame.h/i.h))),n={};for(let t of e.meta.frameTags)t.from===t.to?n[t.name]=t.from:n[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return Kr.from(t,{frames:r,anims:n})})))}K(Hr,"resolveSprite"),K(Yr,"getSprite"),K(zr,"loadSprite"),K(Qr,"slice"),K(Wr,"createSpriteSheet"),K(Xr,"loadBean"),K(Jr,"loadAseprite");var Zr=(K(I=class{constructor(e,t={}){if(q(this,"fontface"),q(this,"filter",yr),q(this,"outline",null),q(this,"size",64),this.fontface=e,this.filter=t.filter??yr,this.size=t.size??64,this.size>256)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:z(0,0,0)},"number"==typeof t.outline?this.outline.width=t.outline:"object"==typeof t.outline&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}},"FontData"),I);function _r(e){if(!e)return _r(ta.font??mr);if("string"==typeof e){let t=rn(e),i=$r(e);if(t)return t.data??t;if(i)return i.data??i;if(document.fonts.check(`64px ${e}`))return e;if(Lr()<1)return null;throw new Error(`Font not found: ${e}`)}return e instanceof Pr&&e.data?e.data:e}function $r(e){return sa.fonts.get(e)??null}function en(e,t,i={}){let r=kr(t),n=new FontFace(e,"string"==typeof t?`url(${r})`:r);return document.fonts.add(n),sa.fonts.add(e,n.load().catch((e=>{throw new Error(`Failed to load font from "${r}": ${e}`)})).then((e=>new Zr(e,i))))}function tn(e,t,i,r){let n=e.width/t,s={},o=r.split("").entries();for(let[a,l]of o)s[l]=new ie(a%n*t,Math.floor(a/n)*i,t,i);return{tex:e,map:s,size:i}}function rn(e){return sa.bitmapFonts.get(e)??null}function nn(e,t,i,r,n={}){let s=kr(t);return sa.bitmapFonts.add(e,Nr(s).then((e=>tn(kn.fromImage(ia.ggl,e,n),i,r,n.chars??pr))))}function sn(e,t){return t=kr(t),sa.sprites.add(e,new Promise((async e=>{let i="string"==typeof t?await Tr(t):t,r=await Promise.all(i.frames.map(Nr)),n=document.createElement("canvas");n.width=i.width,n.height=i.height*i.frames.length;let s=n.getContext("2d");if(!s)throw new Error("Failed to create canvas context");r.forEach(((e,t)=>{s.drawImage(e,0,t*i.height)})),e(await zr(null,n,{sliceY:i.frames.length,anims:i.anims}))})))}K(_r,"resolveFont"),K($r,"getFont"),K(en,"loadFont"),K(tn,"makeFont"),K(rn,"getBitmapFont"),K(nn,"loadBitmapFont"),K(sn,"loadPedit");var on=(K(k=class{constructor(e,t,i,r){q(this,"ctx"),q(this,"glProgram"),this.ctx=e,e.onDestroy((()=>this.free()));let n=e.gl,s=n.createShader(n.VERTEX_SHADER),o=n.createShader(n.FRAGMENT_SHADER);if(!s||!o)throw new Error("Failed to create shader");n.shaderSource(s,t),n.shaderSource(o,i),n.compileShader(s),n.compileShader(o);let a=n.createProgram();if(this.glProgram=a,n.attachShader(a,s),n.attachShader(a,o),r.forEach(((e,t)=>n.bindAttribLocation(a,t,e))),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS)){let e=n.getShaderInfoLog(s);if(e)throw new Error("VERTEX SHADER "+e);let t=n.getShaderInfoLog(o);if(t)throw new Error("FRAGMENT SHADER "+t)}n.deleteShader(s),n.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let i in e){let r=e[i],n=t.getUniformLocation(this.glProgram,i);if("number"==typeof r)t.uniform1f(n,r);else if(r instanceof oe)t.uniformMatrix4fv(n,!1,new Float32Array(r.m));else if(r instanceof Y)t.uniform3f(n,r.r,r.g,r.b);else if(r instanceof ee)t.uniform2f(n,r.x,r.y);else{if(!Array.isArray(r))throw new Error("Unsupported uniform data type");r[0],qt(r)?t.uniform1fv(n,r):Lt(r)?t.uniform2fv(n,r.map((e=>[e.x,e.y])).flat()):Nt(r)&&t.uniform3fv(n,r.map((e=>[e.r,e.g,e.b])).flat())}}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},"Shader"),k);function an(e,t=Vr,i=Er){let r=xr.replace("{{user}}",t??Vr),n=br.replace("{{user}}",i??Er);try{return new on(e,r,n,vr.map((e=>e.name)))}catch(s){let e=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,t=ii(s).match(e);if(!(null==t?void 0:t.groups))throw s;let i=Number(t.groups.line)-14,r=t.groups.msg.trim(),n=t.groups.type.toLowerCase();throw new Error(`${n} shader line ${i}: ${r}`)}}function ln(e){if(!e)return ia.defShader;if("string"==typeof e){let t=hn(e);if(t)return t.data??t;if(Lr()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof Pr&&e.data?e.data:e}function hn(e){return sa.shaders.get(e)??null}function un(e,t,i){return sa.shaders.addLoaded(e,an(ia.ggl,t,i))}function dn(e,t,i){t=kr(t),i=kr(i);let r=K((e=>e?Fr(e):Promise.resolve(null)),"resolveUrl"),n=Promise.all([r(t),r(i)]).then((([e,t])=>an(ia.ggl,e,t)));return sa.shaders.add(e,n)}K(an,"makeShader"),K(ln,"resolveShader"),K(hn,"getShader"),K(un,"loadShader"),K(dn,"loadShaderURL");var cn=(K(P=class{constructor(e){q(this,"buf"),this.buf=e}static fromArrayBuffer(e){return new Promise(((t,i)=>ha.ctx.decodeAudioData(e,t,i))).then((e=>new P(e)))}static fromURL(e){return Xt(e)?P.fromArrayBuffer(Ht(e)):Cr(e).then((e=>P.fromArrayBuffer(e)))}},"SoundData"),P);function fn(e){if("string"==typeof e){let t=pn(e);if(t)return t;if(Lr()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof cn)return Pr.loaded(e);if(e instanceof Pr)return e;throw new Error(`Invalid sound: ${e}`)}function pn(e){return sa.sounds.get(e)??null}function gn(e,t){return t=kr(t),sa.sounds.add(e,"string"==typeof t?cn.fromURL(t):cn.fromArrayBuffer(t))}function mn(e,t){let i=kr(t);return new Audio(i).preload="auto",sa.music[e]=i}function wn(e,t){return e=kr(e),Gr("string"==typeof t?new Promise(((i,r)=>{Tr(t).then((t=>{wn(e,t).then(i).catch(r)}))})):Kr.from(e).then((e=>{let i={};for(let r in t){let n=t[r],s=e.frames[0],o=2048*s.w,a=2048*s.h,l=n.frames?n.frames.map((e=>new ie(s.x+(n.x+e.x)/o*s.w,s.y+(n.y+e.y)/a*s.h,e.w/o*s.w,e.h/a*s.h))):Qr(n.sliceX||1,n.sliceY||1,s.x+n.x/o*s.w,s.y+n.y/a*s.h,n.width/o*s.w,n.height/a*s.h),h=new Kr(e.tex,l,n.anims);sa.sprites.addLoaded(r,h),i[r]=h}return i})))}function yn(e,t,i=!1,r,n,s={}){let o=r??ia.defTex,a=ln(n??ia.defShader);if(!a||a instanceof Pr)return;let l=ia.fixed||i?ia.transform:ra.cam.transform.mult(ia.transform),h=[];for(let u of e){let e=Ji(l.multVec2(u.pos));h.push(e.x,e.y,u.uv.x,u.uv.y,u.color.r/255,u.color.g/255,u.color.b/255,u.opacity)}ia.renderer.push(ia.ggl.gl.TRIANGLES,h,t,a,o,s)}function vn(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(tr(),er(e.pos),rr(e.scale),nr(e.angle),er(e.offset),!1!==e.fill){let i,r=e.color??Y.WHITE,n=e.pts.map(((t,i)=>({pos:new ee(t.x,t.y),uv:e.uv?e.uv[i]:new ee(0,0),color:e.colors&&e.colors[i]?e.colors[i].mult(r):r,opacity:e.opacity??1})));i=e.triangulate?Ot(e.pts).map((t=>t.map((t=>e.pts.indexOf(t))))).flat():[...Array(t-2).keys()].map((e=>[0,e+1,e+2])).flat(),yn(n,e.indices??i,e.fixed,e.uv?e.tex:ia.defTex,e.shader,e.uniform??void 0)}e.outline&&Sn({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity??e.outline.opacity}),sr()}}function An(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,i=e.end??360,r=Ci(e.anchor??"center").scale(new ee(-e.radiusX,-e.radiusY)),n=Zi(r,e.radiusX,e.radiusY,t,i,e.resolution);n.unshift(r);let s=Object.assign({},e,{pts:n,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(n.length-1).fill(e.gradient[1])]}:{}});if(i-t>=360&&e.outline)return!1!==e.fill&&vn(Object.assign({},s,{outline:null})),void vn(Object.assign({},s,{pts:n.slice(1),fill:!1}));vn(s)}function xn(e){if("number"!=typeof e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&An(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function bn(e){let{p1:t,p2:i}=e;if(!t||!i)throw new Error('drawLine() requires properties "p1" and "p2".');let r=e.width||1,n=i.sub(t).unit().normal().scale(.5*r);yn([t.sub(n),t.add(n),i.add(n),i.sub(n)].map((t=>({pos:new ee(t.x,t.y),uv:new ee(0),color:e.color??Y.WHITE,opacity:e.opacity??1}))),[0,1,3,1,2,3],e.fixed,ia.defTex,e.shader,e.uniform??void 0)}function Vn(e){let t,i=e.pts,r=[],n=.5*(e.width||1),s=i[0]===i[i.length-1]||i[0].eq(i[i.length-1]),o=e.pos||te(0,0);t=s?i[0].sub(i[i.length-2]):i[1].sub(i[0]);let a,l=t.len(),h=t.normal().scale(-n/l),u=i[0];if(!s)switch(e.cap){case"square":{let e=t.scale(-n/l);r.push(u.add(e).add(h)),r.push(u.add(e).sub(h));break}case"round":{let e=Math.max(n,10),t=Math.PI/e,i=h.scale(-1),s=Math.cos(t),o=Math.sin(t);for(let n=0;n<e;n++)r.push(u),r.push(u.sub(i)),i=te(i.x*s-i.y*o,i.x*o+i.y*s)}}for(let p=1;p<i.length;p++){if(u===i[p]||u.eq(i[p]))continue;a=u,u=i[p];let e=u.sub(a),s=e.len(),o=e.normal().scale(-n/s),d=t.cross(e);if(Math.abs(d)/(l*s)<.05){r.push(a.add(h)),r.push(a.sub(h)),t.dot(e)<0&&(r.push(a.sub(h)),r.push(a.add(h))),t=e,l=s,h=o;continue}let c=o.sub(h).cross(e)/d,f=h.add(t.scale(c));d>0?(r.push(a.add(f)),r.push(a.sub(h)),r.push(a.add(f)),r.push(a.sub(o))):(r.push(a.add(h)),r.push(a.sub(f)),r.push(a.add(o)),r.push(a.sub(f))),t=e,l=s,h=o}if(!s)switch(r.push(u.add(h)),r.push(u.sub(h)),e.cap){case"square":{let e=t.scale(n/l);r.push(u.add(e).add(h)),r.push(u.add(e).sub(h));break}case"round":{let e=Math.max(n,10),t=Math.PI/e,i=h.scale(1),s=Math.cos(t),o=Math.sin(t);for(let n=0;n<e;n++)i=te(i.x*s-i.y*o,i.x*o+i.y*s),r.push(u),r.push(u.sub(i))}}if(r.length<4)return;let d=r.map((t=>({pos:o.add(t),uv:te(),color:e.color||Y.WHITE,opacity:e.opacity??1}))),c=[],f=0;for(let p=0;p<r.length-2;p+=2)c[f++]=p+1,c[f++]=p,c[f++]=p+2,c[f++]=p+2,c[f++]=p+3,c[f++]=p+1;s&&(c[f++]=r.length-1,c[f++]=r.length-2,c[f++]=0,c[f++]=0,c[f++]=1,c[f++]=r.length-1),yn(d,c,e.fixed,ia.defTex,e.shader,e.uniform??void 0)}function En(e){let t,i=e.pts,r=[],n=.5*(e.width||1),s=i[0]===i[i.length-1]||i[0].eq(i[i.length-1]),o=e.pos||te(0,0);t=s?i[0].sub(i[i.length-2]):i[1].sub(i[0]);let a,l=t.len(),h=t.normal().scale(-n/l),u=i[0];if(!s)switch(e.cap){case"square":{let e=t.scale(-n/l);r.push(u.add(e).add(h)),r.push(u.add(e).sub(h));break}case"round":{let e=Math.max(n,10),t=Math.PI/e,i=h.scale(-1),s=Math.cos(t),o=Math.sin(t);for(let n=0;n<e;n++)r.push(u),r.push(u.sub(i)),i=te(i.x*s-i.y*o,i.x*o+i.y*s)}}for(let p=1;p<i.length;p++){if(u===i[p]||u.eq(i[p]))continue;a=u,u=i[p];let e=u.sub(a),s=e.len(),o=e.normal().scale(-n/s),d=t.cross(e);if(Math.abs(d)/(l*s)<.05){r.push(a.add(h)),r.push(a.sub(h)),t.dot(e)<0&&(r.push(a.sub(h)),r.push(a.add(h))),t=e,l=s,h=o;continue}let c=o.sub(h).cross(e)/d,f=h.add(t.scale(c));if(d>0){let e=a.add(f),t=Math.max(n,10),i=W(h.angleBetween(o)/t),s=h,l=Math.cos(i),u=Math.sin(i);for(let n=0;n<t;n++)r.push(e),r.push(a.sub(s)),s=te(s.x*l-s.y*u,s.x*u+s.y*l)}else{let e=a.sub(f),t=Math.max(n,10),i=W(h.angleBetween(o)/t),s=h,l=Math.cos(i),u=Math.sin(i);for(let n=0;n<t;n++)r.push(a.add(s)),r.push(e),s=te(s.x*l-s.y*u,s.x*u+s.y*l)}t=e,l=s,h=o}if(!s)switch(r.push(u.add(h)),r.push(u.sub(h)),e.cap){case"square":{let e=t.scale(n/l);r.push(u.add(e).add(h)),r.push(u.add(e).sub(h));break}case"round":{let e=Math.max(n,10),t=Math.PI/e,i=h.scale(1),s=Math.cos(t),o=Math.sin(t);for(let n=0;n<e;n++)i=te(i.x*s-i.y*o,i.x*o+i.y*s),r.push(u),r.push(u.sub(i))}}if(r.length<4)return;let d=r.map((t=>({pos:o.add(t),uv:te(),color:e.color||Y.WHITE,opacity:e.opacity??1}))),c=[],f=0;for(let p=0;p<r.length-2;p+=2)c[f++]=p+1,c[f++]=p,c[f++]=p+2,c[f++]=p+2,c[f++]=p+3,c[f++]=p+1;s&&(c[f++]=r.length-1,c[f++]=r.length-2,c[f++]=0,c[f++]=0,c[f++]=1,c[f++]=r.length-1),yn(d,c,e.fixed,ia.defTex,e.shader,e.uniform??void 0)}function Mn(e){let t,i=e.pts,r=[],n=.5*(e.width||1),s=i[0]===i[i.length-1]||i[0].eq(i[i.length-1]),o=e.pos||te(0,0);t=s?i[0].sub(i[i.length-2]):i[1].sub(i[0]);let a,l=t.len(),h=t.normal().scale(-n/l),u=i[0];if(!s)switch(e.cap){case"square":{let e=t.scale(-n/l);r.push(u.add(e).add(h)),r.push(u.add(e).sub(h));break}case"round":{let e=Math.max(n,10),t=Math.PI/e,i=h.scale(-1),s=Math.cos(t),o=Math.sin(t);for(let n=0;n<e;n++)r.push(u),r.push(u.sub(i)),i=te(i.x*s-i.y*o,i.x*o+i.y*s)}}for(let p=1;p<i.length;p++){if(u===i[p]||u.eq(i[p]))continue;a=u,u=i[p];let e=u.sub(a),s=e.len(),o=e.normal().scale(-n/s),d=t.cross(e);if(Math.abs(d)/(l*s)<.05){r.push(a.add(h)),r.push(a.sub(h)),t.dot(e)<0&&(r.push(a.sub(h)),r.push(a.add(h))),t=e,l=s,h=o;continue}let c=o.sub(h).cross(e)/d,f=h.add(t.scale(c));r.push(a.add(f)),r.push(a.sub(f)),t=e,l=s,h=o}if(!s)switch(r.push(u.add(h)),r.push(u.sub(h)),e.cap){case"square":{let e=t.scale(n/l);r.push(u.add(e).add(h)),r.push(u.add(e).sub(h));break}case"round":{let e=Math.max(n,10),t=Math.PI/e,i=h.scale(1),s=Math.cos(t),o=Math.sin(t);for(let n=0;n<e;n++)i=te(i.x*s-i.y*o,i.x*o+i.y*s),r.push(u),r.push(u.sub(i))}}if(r.length<4)return;let d=r.map((t=>({pos:o.add(t),uv:te(),color:e.color||Y.WHITE,opacity:e.opacity??1}))),c=[],f=0;for(let p=0;p<r.length-2;p+=2)c[f++]=p+1,c[f++]=p,c[f++]=p+2,c[f++]=p+2,c[f++]=p+3,c[f++]=p+1;s&&(c[f++]=r.length-1,c[f++]=r.length-2,c[f++]=0,c[f++]=0,c[f++]=1,c[f++]=r.length-1),yn(d,c,e.fixed,ia.defTex,e.shader,e.uniform??void 0)}function Sn(e){let t=e.pts,i=e.width??1;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2)){if(t.length>2)switch(e.join){case"bevel":return Vn(e);case"round":return En(e);case"miter":return Mn(e)}if(e.radius&&t.length>=3){bn(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let i=1;i<t.length-2;i++){let r=t[i],n=t[i+1];bn(Object.assign({},e,{p1:r,p2:n}))}bn(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let r=0;r<t.length-1;r++)bn(Object.assign({},e,{p1:t[r],p2:t[r+1]})),"none"!==e.join&&xn(Object.assign({},e,{pos:t[r],radius:i/2}))}}function Rn(e,t){let i=t.segments??16,r=[];for(let n=0;n<=i;n++)r.push(e(n/i));Sn({pts:r,width:t.width||1,pos:t.pos,color:t.color,opacity:t.opacity})}function In(e){Rn((t=>lt(e.pt1,e.pt2,e.pt3,e.pt4,t)),e)}K(fn,"resolveSound"),K(pn,"getSound"),K(gn,"loadSound"),K(mn,"loadMusic"),K(wn,"loadSpriteAtlas"),K(yn,"drawRaw"),K(vn,"drawPolygon"),K(An,"drawEllipse"),K(xn,"drawCircle"),K(bn,"drawLine"),K(Vn,"_drawLinesBevel"),K(En,"_drawLinesRound"),K(Mn,"_drawLinesMiter"),K(Sn,"drawLines"),K(Rn,"drawCurve"),K(In,"drawBezier");var kn=(K(B=class{constructor(e,t,i,r={}){q(this,"ctx"),q(this,"src",null),q(this,"glTex"),q(this,"width"),q(this,"height"),this.ctx=e;let n=e.gl,s=e.gl.createTexture();if(!s)throw new Error("Failed to create texture");this.glTex=s,e.onDestroy((()=>this.free())),this.width=t,this.height=i;let o={linear:n.LINEAR,nearest:n.NEAREST}[r.filter??e.opts.texFilter??"nearest"],a={repeat:n.REPEAT,clampToEdge:n.CLAMP_TO_EDGE}[r.wrap??"clampToEdge"];this.bind(),t&&i&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,i,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,a),this.unbind()}static fromImage(e,t,i={}){let r=new B(e,t.width,t.height,i);return r.update(t),r.src=t,r}update(e,t=0,i=0){let r=this.ctx.gl;this.bind(),r.texSubImage2D(r.TEXTURE_2D,0,t,i,r.RGBA,r.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},"Texture"),B),Pn=(K(D=class{constructor(e,t,i,r={}){q(this,"ctx"),q(this,"tex"),q(this,"glFramebuffer"),q(this,"glRenderbuffer"),this.ctx=e;let n=e.gl;e.onDestroy((()=>this.free())),this.tex=new kn(e,t,i,r);let s=n.createFramebuffer(),o=n.createRenderbuffer();if(!s||!o)throw new Error("Failed to create framebuffer");this.glFramebuffer=s,this.glRenderbuffer=o,this.bind(),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.tex.glTex,0),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let i=4*this.width,r=new Uint8Array(i);for(let n=0;n<(this.height/2|0);n++){let e=n*i,s=(this.height-n-1)*i;r.set(t.subarray(e,e+i)),t.copyWithin(e,s,s+i),t.set(r,s)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=this.width,e.height=this.height,!t)throw new Error("Failed to get 2d context");return t.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},"FrameBuffer"),D),Bn=(K(T=class{constructor(e,t,i,r){q(this,"ctx"),q(this,"glVBuf"),q(this,"glIBuf"),q(this,"vqueue",[]),q(this,"iqueue",[]),q(this,"stride"),q(this,"maxVertices"),q(this,"maxIndices"),q(this,"vertexFormat"),q(this,"numDraws",0),q(this,"curPrimitive",null),q(this,"curTex",null),q(this,"curShader",null),q(this,"curUniform",{});let n=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce(((e,t)=>e+t.size),0),this.maxVertices=i,this.maxIndices=r;let s=n.createBuffer();if(!s)throw new Error("Failed to create vertex buffer");this.glVBuf=s,e.pushArrayBuffer(this.glVBuf),n.bufferData(n.ARRAY_BUFFER,4*i,n.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=n.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),n.bufferData(n.ELEMENT_ARRAY_BUFFER,4*r,n.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,i,r,n=null,s={}){(e!==this.curPrimitive||n!==this.curTex||r!==this.curShader||!Zt(this.curUniform,s)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+i.length>this.maxIndices)&&this.flush();let o=this.vqueue.length/this.stride;for(let a of t)this.vqueue.push(a);for(let a of i)this.iqueue.push(a+o);this.curPrimitive=e,this.curShader=r,this.curTex=n,this.curUniform=s}flush(){var e,t;if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let i=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),i.bufferSubData(i.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),null==(e=this.curTex)||e.bind(),i.drawElements(this.curPrimitive,this.iqueue.length,i.UNSIGNED_SHORT,0),null==(t=this.curTex)||t.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},"BatchRenderer"),T);function Dn(e){let t=[],i=K((i=>{t.push(i),e(i)}),"push"),r=K((()=>{t.pop(),e(n()??null)}),"pop"),n=K((()=>t[t.length-1]),"cur");return[i,r,n]}function Tn(e,t={}){let i=[];function r(e){i.push(e)}function n(){i.forEach((e=>e()));let t=e.getExtension("WEBGL_lose_context");t&&t.loseContext()}K(r,"onDestroy"),K(n,"destroy");let s=null;function o(t){if(Zt(t,s))return;s=t;let i=t.reduce(((e,t)=>e+t.size),0);t.reduce(((t,r,n)=>(e.vertexAttribPointer(n,r.size,e.FLOAT,!1,4*i,t),e.enableVertexAttribArray(n),t+4*r.size)),0)}K(o,"setVertexFormat");let[a,l]=Dn((t=>e.bindTexture(e.TEXTURE_2D,t))),[h,u]=Dn((t=>e.bindBuffer(e.ARRAY_BUFFER,t))),[d,c]=Dn((t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t))),[f,p]=Dn((t=>e.bindFramebuffer(e.FRAMEBUFFER,t))),[g,m]=Dn((t=>e.bindRenderbuffer(e.RENDERBUFFER,t))),[w,y]=Dn((t=>{if(!t)return;let{x:i,y:r,w:n,h:s}=t;e.viewport(i,r,n,s)})),[v,A]=Dn((t=>e.useProgram(t)));return w({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:r,destroy:n,pushTexture2D:a,popTexture2D:l,pushArrayBuffer:h,popArrayBuffer:u,pushElementArrayBuffer:d,popElementArrayBuffer:c,pushFramebuffer:f,popFramebuffer:p,pushRenderbuffer:g,popRenderbuffer:m,pushViewport:w,popViewport:y,pushProgram:v,popProgram:A,setVertexFormat:o}}K(Dn,"genStack"),K(Tn,"initGfx");var Fn={};function Cn(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(te(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&1===e.ch.length&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}function On(e){let t={},i="",r=[],n=0,s=0;for(let o=0;o<e.length;o++)if(o!==n+1&&(s+=o-n),n=o,"\\"!==e[o]||"["!==e[o+1]){if((0===o||"\\"!==e[o-1])&&"["===e[o]){let t=o;o++;let i="/"===e[o],n="";for(i&&o++;o<e.length&&"]"!==e[o];)n+=e[o++];if(!(!Rr.test(n)||o>=e.length||"]"!==e[o]||i&&(0===r.length||r[r.length-1][0]!==n))){i?r.pop():r.push([n,t]);continue}o=t}i+=e[o],r.length>0&&(t[o-s]=r.map((([e])=>e)))}if(r.length>0){for(;r.length>0;){let[t,i]=r.pop();e=e.substring(0,i)+"\\"+e.substring(i)}return On(e)}return{charStyleMap:t,text:i}}function Un(e){var t,i,r;if(void 0===e.text)throw new Error('formatText() requires property "text".');let n=_r(e.font);if(""===e.text||n instanceof Pr||!n)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:s,text:o}=On(e.text+""),a=oi(o);if(n instanceof Zr||"string"==typeof n){let e=n instanceof Zr?n.fontface.family:n,r=n instanceof Zr?{outline:n.outline,filter:n.filter}:{outline:null,filter:yr},s=Fn[e]??{font:{tex:new kn(ia.ggl,2048,2048,{filter:r.filter}),map:{},size:64},cursor:new ee(0),outline:r.outline};Fn[e]||(Fn[e]=s),n=s.font;for(let o of a)if(!s.font.map[o]){let r=aa;if(!r)throw new Error("fontCacheC2d is not defined.");if(!oa)throw new Error("fontCacheCanvas is not defined.");r.clearRect(0,0,oa.width,oa.height),r.font=`${n.size}px ${e}`,r.textBaseline="top",r.textAlign="left",r.fillStyle="#ffffff";let a=r.measureText(o),l=Math.ceil(a.width);if(!l)continue;let h=a.fontBoundingBoxAscent+a.fontBoundingBoxDescent;s.outline&&s.outline.width&&s.outline.color&&(r.lineJoin="round",r.lineWidth=2*s.outline.width,r.strokeStyle=s.outline.color.toHex(),r.strokeText(o,s.outline.width,s.outline.width),l+=2*s.outline.width,h+=3*s.outline.width),r.fillText(o,(null==(t=s.outline)?void 0:t.width)??0,(null==(i=s.outline)?void 0:i.width)??0);let u=r.getImageData(0,0,l,h);if(s.cursor.x+l>2048&&(s.cursor.x=0,s.cursor.y+=h,s.cursor.y>2048))throw new Error("Font atlas exceeds character limit");n.tex.update(u,s.cursor.x,s.cursor.y),n.map[o]=new ie(s.cursor.x,s.cursor.y,l,h),s.cursor.x+=l}}let l=e.size||n.size,h=te(e.scale??1).scale(l/n.size),u=e.lineSpacing??0,d=e.letterSpacing??0,c=0,f=0,p=0,g=[],m=[],w=0,y=null,v=0;for(;w<a.length;){let t=a[w];if("\n"===t)p+=l+u,g.push({width:c-d,chars:m}),y=null,v=0,c=0,m=[];else{let i=n.map[t];if(i){let r=i.w*h.x;e.width&&c+r>e.width&&(p+=l+u,null!=y&&(w-=m.length-y,t=a[w],i=n.map[t],r=i.w*h.x,m=m.slice(0,y-1),c=v),y=null,v=0,g.push({width:c-d,chars:m}),c=0,m=[]),m.push({tex:n.tex,width:i.w,height:i.h,quad:new ie(i.x/n.tex.width,i.y/n.tex.height,i.w/n.tex.width,i.h/n.tex.height),ch:t,pos:new ee(c,p),opacity:e.opacity??1,color:e.color??Y.WHITE,scale:te(h),angle:0})," "===t&&(y=m.length,v=c),c+=r,f=Math.max(f,c),c+=d}}w++}g.push({width:c-d,chars:m}),p+=l,e.width&&(f=e.width);let A=[];for(let x=0;x<g.length;x++){let t=(f-g[x].width)*Oi(e.align??"left");for(let i of g[x].chars){let o=n.map[i.ch],a=A.length+x;if(i.pos=i.pos.add(t,0).add(o.w*h.x*.5,o.h*h.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(a,i.ch):e.transform;t&&Cn(i,t)}if(s[a]){let t=s[a];for(let n of t){let t=null==(r=e.styles)?void 0:r[n],s="function"==typeof t?t(a,i.ch):t;s&&Cn(i,s)}}A.push(i)}}return{width:f,height:p,chars:A,opt:e}}function Nn(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,i=e.height,r=Ci(e.anchor||gr).scale(new ee(t,i).scale(-.5)),n=e.quad||new ie(0,0,1,1),s=e.color||z(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,l=e.tex?.1/e.tex.height:0,h=n.x+a,u=n.y+l,d=n.w-2*a,c=n.h-2*l;tr(),er(e.pos),nr(e.angle),rr(e.scale),er(r),yn([{pos:new ee(-t/2,i/2),uv:new ee(e.flipX?h+d:h,e.flipY?u:u+c),color:s,opacity:o},{pos:new ee(-t/2,-i/2),uv:new ee(e.flipX?h+d:h,e.flipY?u+c:u),color:s,opacity:o},{pos:new ee(t/2,-i/2),uv:new ee(e.flipX?h:h+d,e.flipY?u+c:u),color:s,opacity:o},{pos:new ee(t/2,i/2),uv:new ee(e.flipX?h:h+d,e.flipY?u:u+c),color:s,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform??void 0),sr()}function Ln(e){tr(),er(e.opt.pos),nr(e.opt.angle),er(Ci(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach((t=>{Nn({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})})),sr()}function qn(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,i=e.height,r=Ci(e.anchor||gr).add(1,1).scale(new ee(t,i).scale(-.5)),n=[new ee(0,0),new ee(t,0),new ee(t,i),new ee(0,i)];if(e.radius){let r=Math.min(t,i)/2,s=Array.isArray(e.radius)?e.radius.map((e=>Math.min(r,e))):new Array(4).fill(Math.min(r,e.radius));n=[new ee(s[0],0),...s[1]?Zi(new ee(t-s[1],s[1]),s[1],s[1],270,360):[te(t,0)],...s[2]?Zi(new ee(t-s[2],i-s[2]),s[2],s[2],0,90):[te(t,i)],...s[3]?Zi(new ee(s[3],i-s[3]),s[3],s[3],90,180):[te(0,i)],...s[0]?Zi(new ee(s[0],s[0]),s[0],s[0],180,270):[]]}vn(Object.assign({},e,{offset:r,pts:n,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function Gn(e){or();let t=ia.width,i=ia.height;ia.width=ia.viewport.width,ia.height=ia.viewport.height,e(),or(),ia.width=t,ia.height=i}function jn(e,t){Gn((()=>{let i=te(8);tr(),er(e);let r=Un({text:t,font:wr,size:16,pos:i,color:z(255,255,255),fixed:!0}),n=r.width+2*i.x,s=r.height+2*i.x;e.x+n>=ar()&&er(te(-n,0)),e.y+s>=lr()&&er(te(0,-s)),qn({width:n,height:s,color:z(0,0,0),radius:4,opacity:.8,fixed:!0}),Ln(r),sr()}))}function Kn(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return vn(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function Hn(){if(la.inspect){let e=null;for(let t of ra.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(ra.root.drawInspect(),e){let t=[],i=e.inspect();for(let e in i)i[e]?t.push(`${i[e]}`):t.push(`${e}`);jn(ur(cr()),t.join("\n"))}jn(te(8),`FPS: ${la.fps()}`)}la.paused&&Gn((()=>{tr(),er(ar(),0),er(-8,8);qn({width:32,height:32,anchor:"topright",color:z(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)qn({width:4,height:19.2,anchor:"center",pos:te(-32/3*e,16),color:z(255,255,255),radius:2,fixed:!0});sr()})),1!==la.timeScale&&Gn((()=>{tr(),er(ar(),lr()),er(-8,-8);let e=Un({text:la.timeScale.toFixed(1),font:wr,size:16,color:z(255,255,255),pos:te(-8),anchor:"botright",fixed:!0});qn({width:e.width+16+32,height:e.height+16,anchor:"botright",color:z(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let i=la.timeScale<1;Kn({p1:te(-e.width-8*(i?2:3.5),-8),p2:te(-e.width-8*(i?2:3.5),-8-e.height),p3:te(-e.width-8*(i?3.5:2),-8-e.height/2),pos:te(8*-t*1+(i?-4:0),0),color:z(255,255,255),fixed:!0})}Ln(e),sr()})),la.curRecording&&Gn((()=>{tr(),er(0,lr()),er(24,-24),xn({radius:12,color:z(255,0,0),opacity:ae(0,1,4*na.time()),fixed:!0}),sr()})),la.showLog&&ra.logs.length>0&&Gn((()=>{var e;tr(),er(0,lr()),er(8,-8);let t=[];for(let r of ra.logs){let i="",n=r.msg instanceof Error?"error":"info";i+=`[time]${r.time.toFixed(2)}[/time]`,i+=" ",i+=`[${n}]${(null==(e=r.msg)?void 0:e.toString)?r.msg.toString():r.msg}[/${n}]`,t.push(i)}ra.logs=ra.logs.filter((e=>na.time()-e.time<(ta.logTime||4)));let i=Un({text:t.join("\n"),font:wr,pos:te(8,-8),anchor:"botleft",size:16,width:.6*ar(),lineSpacing:4,fixed:!0,styles:{time:{color:z(127,127,127)},info:{color:z(255,255,255)},error:{color:z(255,0,127)}}});qn({width:i.width+16,height:i.height+16,anchor:"botleft",color:z(0,0,0),radius:4,opacity:.8,fixed:!0}),Ln(i),sr()}))}function Yn(){let e=ra.cam,t=ee.fromAngle(ce(0,360)).scale(e.shake);e.shake=Z(e.shake,0,5*Di()),e.transform=(new oe).translate(fr()).scale(e.scale).rotate(e.angle).translate((e.pos??fr()).scale(-1).add(t)),ra.root.draw(),or()}function zn(){let e=Lr();ra.events.numListeners("loading")>0?ra.events.trigger("loading",e):Gn((()=>{let t=ar()/2,i=te(ar()/2,lr()/2).sub(te(t/2,12));qn({pos:te(0),width:ar(),height:lr(),color:z(0,0,0)}),qn({pos:i,width:t,height:24,fill:!1,outline:{width:4}}),qn({pos:i,width:t*e,height:24})}))}function Qn(e,t,i){let r=ia.ggl.gl;or(),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.stencilFunc(r.NEVER,1,255),r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE),t(),or(),r.stencilFunc(i,1,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),e(),or(),r.disable(r.STENCIL_TEST)}function Wn(e,t){Qn(e,t,ia.ggl.gl.EQUAL)}function Xn(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new ie(0,0,1,1),i=e.tex.width*t.w,r=e.tex.height*t.h,n=new ee(1);if(e.tiled){let n=Ci(e.anchor||gr).add(new ee(1,1)).scale(.5).scale(e.width||i,e.height||r),s=(e.width||i)/i,o=(e.height||r)/r,a=Math.floor(s),l=Math.floor(o),h=s-a,u=o-l,d=(a+h?1:0)*(l+u?1:0),c=new Array(6*d),f=new Array(4*d),p=0,g=K(((t,i,r,s,o)=>{c[6*p+0]=4*p+0,c[6*p+1]=4*p+1,c[6*p+2]=4*p+3,c[6*p+3]=4*p+1,c[6*p+4]=4*p+2,c[6*p+5]=4*p+3,f[4*p+0]={pos:new ee(t-n.x,i-n.y),uv:new ee(o.x,o.y),color:e.color||Y.WHITE,opacity:e.opacity||1},f[4*p+1]={pos:new ee(t+r-n.x,i-n.y),uv:new ee(o.x+o.w,o.y),color:e.color||Y.WHITE,opacity:e.opacity||1},f[4*p+2]={pos:new ee(t+r-n.x,i+s-n.y),uv:new ee(o.x+o.w,o.y+o.h),color:e.color||Y.WHITE,opacity:e.opacity||1},f[4*p+3]={pos:new ee(t-n.x,i+s-n.y),uv:new ee(o.x,o.y+o.h),color:e.color||Y.WHITE,opacity:e.opacity||1},p++}),"addQuad");for(let e=0;e<l;e++){for(let n=0;n<a;n++)g(n*i,e*r,i,r,t);h&&g(a*i,e*r,i*h,r,new ie(t.x,t.y,t.w*h,t.h))}if(u){for(let e=0;e<a;e++)g(e*i,l*r,i,r*u,new ie(t.x,t.y,t.w,t.h*u));h&&g(a*i,l*r,i*h,r*u,new ie(t.x,t.y,t.w*h,t.h*u))}yn(f,c,e.fixed,e.tex,e.shader,e.uniform??void 0)}else e.width&&e.height?(n.x=e.width/i,n.y=e.height/r):e.width?(n.x=e.width/i,n.y=n.x):e.height&&(n.y=e.height/r,n.x=n.y),Nn(Object.assign({},e,{scale:n.scale(e.scale||new ee(1)),tex:e.tex,quad:t,width:i,height:r}))}function Jn(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=Hr(e.sprite);if(!t||!t.data)return;let i=t.data.frames[e.frame??0];if(!i)throw new Error(`Frame not found: ${e.frame??0}`);Xn(Object.assign({},e,{tex:t.data.tex,quad:i.scale(e.quad??new ie(0,0,1,1))}))}function Zn(e,t){Qn(e,t,ia.ggl.gl.NOTEQUAL)}function _n(e){Ln(Un(e))}K(Cn,"applyCharTransform"),K(On,"compileStyledText"),K(Un,"formatText"),K(Nn,"drawUVQuad"),K(Ln,"drawFormattedText"),K(qn,"drawRect"),K(Gn,"drawUnscaled"),K(jn,"drawInspectText"),K(Kn,"drawTriangle"),K(Hn,"drawDebug"),K(Yn,"drawFrame"),K(zn,"drawLoadScreen"),K(Qn,"drawStenciled"),K(Wn,"drawMasked"),K(Xn,"drawTexture"),K(Jn,"drawSprite"),K(Zn,"drawSubtracted"),K(_n,"drawText");var $n=K(((e,t)=>{let i=an(t,Vr,Er),r=window.devicePixelRatio||window.devicePixelRatio,n=e.scale??1,{gl:s}=t,o=kn.fromImage(t,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),a=e.width&&e.height?new Pn(t,e.width*r*n,e.height*r*n):new Pn(t,s.drawingBufferWidth,s.drawingBufferHeight),l=null,h=1;e.background&&("string"==typeof e.background?l=z(e.background):(l=z(...e.background),h=e.background[3]??1),s.clearColor(l.r/255,l.g/255,l.b/255,h??1)),s.enable(s.BLEND),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);let u=new Bn(t,vr,Ar,12288),d=kn.fromImage(t,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:t,defShader:i,defTex:o,frameBuffer:a,postShader:null,postShaderUniform:null,renderer:u,transform:new oe,transformStack:[],bgTex:d,bgColor:l,bgAlpha:h,width:e.width??s.drawingBufferWidth/r/n,height:e.height??s.drawingBufferHeight/r/n,viewport:{x:0,y:0,width:s.drawingBufferWidth,height:s.drawingBufferHeight},fixed:!1}}),"initAppGfx");function es(){let e=ua,t=ia.ggl.gl.drawingBufferWidth/e,i=ia.ggl.gl.drawingBufferHeight/e;if(ta.letterbox){if(!ta.width||!ta.height)throw new Error("Letterboxing requires width and height defined.");let e=t/i,r=ta.width/ta.height;if(e>r){let e=i*r,n=(t-e)/2;ia.viewport={x:n,y:0,width:e,height:i}}else{let e=t/r,n=(i-e)/2;ia.viewport={x:0,y:n,width:t,height:e}}}else{if(ta.stretch&&(!ta.width||!ta.height))throw new Error("Stretching requires width and height defined.");ia.viewport={x:0,y:0,width:t,height:i}}}function ts(e){return!!e.fixed||!!e.parent&&ts(e.parent)}function is(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function rs(e,t={}){return{id:"circle",radius:e,draw(){xn(Object.assign(is(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new et(new ee(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}function ns(...e){return{id:"color",color:z(...e),inspect(){return`color: ${this.color.toString()}`}}}function ss(e){return{add(){this.canvas=e}}}function os(e=1){let t,i=0,r=!1;return{require:["opacity"],add(){t=this.opacity,this.opacity=0},update(){r||(i+=Di(),this.opacity=_(i,0,e,0,t),i>=e&&(this.opacity=t,r=!0))}}}function as(e="intersect"){return{id:"mask",mask:e}}function ls(e){return{id:"opacity",opacity:e??1,fadeIn(e=1,t=ea.easings.linear){return ra.root.tween(0,this.opacity,e,(e=>this.opacity=e),t)},fadeOut(e=1,t=ea.easings.linear){return ra.root.tween(this.opacity,0,e,(e=>this.opacity=e),t)},inspect(){return`opacity: ${ri(this.opacity,1)}`}}}function hs(e=1,t=z(0,0,0),i=1,r="miter",n=10,s="butt"){return{id:"outline",outline:{width:e,color:t,opacity:i,join:r,miterLimit:n,cap:s},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}K(es,"updateViewport"),K(ts,"isFixed"),K(is,"getRenderProps"),K(rs,"circle"),K(ns,"color"),K(ss,"drawon"),K(os,"fadeIn"),K(as,"mask"),K(ls,"opacity"),K(hs,"outline");var us=(K(F=class{constructor(){q(this,"pos",te(0)),q(this,"vel",te(0)),q(this,"acc",te(0)),q(this,"angle",0),q(this,"angularVelocity",0),q(this,"damping",0),q(this,"t"),q(this,"lt",null),q(this,"gc"),this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}},"Particle"),F);function ds(e,t){let i=t.lifetime,r=[],n=e.colors||[Y.WHITE],s=e.opacities||[1],o=e.quads||[new ie(0,0,1,1)],a=e.scales||[1],l=e.lifeTime,h=t.direction,u=t.spread,d=e.speed||[0,0],c=e.angle||[0,0],f=e.angularVelocity||[0,0],p=e.acceleration||[te(0),te(0)],g=e.damping||[0,0],m=[],w=new Array(e.max),y=0,v=0;for(let b=0;b<e.max;b++){m[6*b+0]=4*b+0,m[6*b+1]=4*b+1,m[6*b+2]=4*b+3,m[6*b+3]=4*b+1,m[6*b+4]=4*b+2,m[6*b+5]=4*b+3;for(let e=0;e<4;e++)w[4*b+e]={pos:new ee(0,0),uv:new ee(0,0),color:z(255,255,255),opacity:1};r[b]=new us}let A=new ei;function x(t=0){for(;t<e.max;){if(r[t].gc)return t;t++}return null}return K(x,"nextFree"),{id:"particles",emit(e){let i=0;for(let n=0;n<e;n++){if(i=x(i),null==i)return;let e=ce(h-u,h+u),n=ee.fromAngle(e).scale(ce(d[0],d[1])),s=ce(c[0],c[1]),o=ce(f[0],f[1]),a=te(ce(p[0].x,p[1].x),ce(p[0].y,p[1].y)),m=ce(g[0],g[1]),w=l?ce(l[0],l[1]):null,y=t.shape?t.shape.random():te(),v=r[i];v.lt=w,v.pos=y,v.vel=n,v.acc=a,v.angle=s,v.angularVelocity=o,v.damping=m,v.angularVelocity=o,v.gc=!1}y+=e},update(){if(void 0!==i&&i<=0)return;let n=Di();for(let e of r)if(!e.gc){if(e.t+=n,e.lt&&e.t>=e.lt){e.gc=!0,y--;continue}e.vel=e.vel.add(e.acc.scale(n)).scale(1-e.damping*n),e.pos=e.pos.add(e.vel.scale(n)),e.angle+=e.angularVelocity*n}for(void 0!==i&&(i-=n,i<=0&&A.trigger()),v+=n;y<e.max&&t.rate&&v>t.rate;)this.emit(1),y++,v-=t.rate},draw(){if(!(void 0!==i&&i<=0)){for(let t=0;t<r.length;t++){let i=r[t];if(i.gc)continue;let l=i.progress,h=Math.floor(i.progress*n.length),u=h<n.length-1?Z(n[h],n[h+1],_(l,h/n.length,(h+1)/n.length,0,1)):n[h],d=Math.floor(i.progress*s.length),c=d<s.length-1?Z(s[d],s[d+1],_(l,d/s.length,(d+1)/s.length,0,1)):s[d],f=Math.floor(i.progress*o.length),p=o[f],g=Math.floor(i.progress*a.length),m=a[g],y=Math.cos(i.angle*Math.PI/180),v=Math.sin(i.angle*Math.PI/180),A=(e.texture?e.texture.width:10)*p.w/2,x=(e.texture?e.texture.height:10)*p.h/2,b=4*t,V=w[b];V.pos.x=i.pos.x+-A*m*y- -x*m*v,V.pos.y=i.pos.y+-A*m*v+-x*m*y,V.uv.x=p.x,V.uv.y=p.y,V.color.r=u.r,V.color.g=u.g,V.color.b=u.b,V.opacity=c,V=w[b+1],V.pos.x=i.pos.x+A*m*y- -x*m*v,V.pos.y=i.pos.y+A*m*v+-x*m*y,V.uv.x=p.x+p.w,V.uv.y=p.y,V.color.r=u.r,V.color.g=u.g,V.color.b=u.b,V.opacity=c,V=w[b+2],V.pos.x=i.pos.x+A*m*y-x*m*v,V.pos.y=i.pos.y+A*m*v+x*m*y,V.uv.x=p.x+p.w,V.uv.y=p.y+p.h,V.color.r=u.r,V.color.g=u.g,V.color.b=u.b,V.opacity=c,V=w[b+3],V.pos.x=i.pos.x+-A*m*y-x*m*v,V.pos.y=i.pos.y+-A*m*v+x*m*y,V.uv.x=p.x,V.uv.y=p.y+p.h,V.color.r=u.r,V.color.g=u.g,V.color.b=u.b,V.opacity=c}yn(w,m,this.fixed,e.texture,this.shader,this.uniform)}},onEnd:e=>A.add(e),inspect:()=>`count: ${y}/${e.max}`}}function cs(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,uv:t.uv,tex:t.tex,radius:t.radius,draw(){vn(Object.assign(is(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:t.fill,triangulate:t.triangulate}))},renderArea(){return new nt(this.pts)},inspect(){return`polygon: ${this.pts.map((e=>`[${e.x},${e.y}]`)).join(",")}`}}}function fs(e,t,i){let r;return ra.root.get("area").forEach((n=>{if(i&&i.some((e=>n.is(e))))return;let s=n.worldArea().raycast(e,t);s&&(r?s.fraction<r.fraction&&(r=s,r.object=n):(r=s,r.object=n))})),r}function ps(e,t,i={}){return{id:"rect",width:e,height:t,radius:i.radius||0,draw(){qn(Object.assign(is(this),{width:this.width,height:this.height,radius:this.radius,fill:i.fill}))},renderArea(){return new et(te(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}function gs(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t},inspect:()=>`shader: ${e}`}}function ms(...e){return e.length>0&&(ra.cam.pos=te(...e)),ra.cam.pos?ra.cam.pos.clone():fr()}function ws(...e){return e.length>0&&(ra.cam.scale=te(...e)),ra.cam.scale.clone()}function ys(e){return void 0!==e&&(ra.cam.angle=e),ra.cam.angle}function vs(e=z(255,255,255),t=1){let i=ra.root.add([ps(ar(),lr()),ns(e),ls(1),{id:"fixed",fixed:!0}]),r=i.fadeOut(t);return r.onEnd((()=>no(i))),r}function As(){return ra.cam.transform.clone()}function xs(e=12){ra.cam.shake+=e}function bs(e){return ra.cam.transform.multVec2(e)}function Vs(e){return ra.cam.transform.invert().multVec2(e)}function Es(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let i=ra.root.add([Jo(t.pos??te(0))]),r=e.length,n=0,s=null,o=null,a=null,l=null,h=K((e=>e.x+e.y*n),"tile2Hash"),u=K((e=>te(Math.floor(e%n),Math.floor(e/n))),"hash2Tile"),d=K((()=>{s=[];for(let e of i.children)c(e)}),"createSpatialMap"),c=K((e=>{let t=h(e.tilePos);s[t]?s[t].push(e):s[t]=[e]}),"insertIntoSpatialMap"),f=K((e=>{let t=h(e.tilePos);if(s[t]){let i=s[t].indexOf(e);i>=0&&s[t].splice(i,1)}}),"removeFromSpatialMap"),p=K((()=>{let e=!1;for(let t of i.children){let r=i.pos2Tile(t.pos);(t.tilePos.x!=r.x||t.tilePos.y!=r.y)&&(e=!0,f(t),t.tilePos.x=r.x,t.tilePos.y=r.y,c(t))}e&&i.trigger("spatialMapChanged")}),"updateSpatialMap"),g=K((()=>{let e=i.getSpatialMap(),t=i.numRows()*i.numColumns();o?o.length=t:o=new Array(t),o.fill(1,0,t);for(let i=0;i<e.length;i++){let t=e[i];if(t){let e=0;for(let i of t){if(i.isObstacle){e=1/0;break}e+=i.cost}o[i]=e||1}}}),"createCostMap"),m=K((()=>{let e=i.getSpatialMap(),t=i.numRows()*i.numColumns();a?a.length=t:a=new Array(t),a.fill(15,0,t);for(let i=0;i<e.length;i++){let t=e[i];if(t){let e=t.length,r=15;for(let i=0;i<e;i++)r|=t[i].edgeMask;a[i]=r}}}),"createEdgeMap"),w=K((()=>{let e=i.numRows()*i.numColumns(),t=K(((e,t)=>{let i=[];for(i.push(e);i.length>0;){let e=i.pop();A(e).forEach((e=>{l[e]<0&&(l[e]=t,i.push(e))}))}}),"traverse");l?l.length=e:l=new Array(e),l.fill(-1,0,e);let r=0;for(let i=0;i<o.length;i++)l[i]>=0||t(i,r),r++}),"createConnectivityMap"),y=K(((e,t)=>o[t]),"getCost"),v=K(((e,t)=>{let i=u(e),r=u(t);return i.dist(r)}),"getHeuristic"),A=K(((e,t)=>{let i=[],s=Math.floor(e%n),l=s>0&&1&a[e]&&o[e-1]!==1/0,h=e>=n&&2&a[e]&&o[e-n]!==1/0,u=s<n-1&&4&a[e]&&o[e+1]!==1/0,d=e<n*r-n-1&&8&a[e]&&o[e+n]!==1/0;return t?(l&&(h&&i.push(e-n-1),i.push(e-1),d&&i.push(e+n-1)),h&&i.push(e-n),u&&(h&&i.push(e-n+1),i.push(e+1),d&&i.push(e+n+1)),d&&i.push(e+n)):(l&&i.push(e-1),h&&i.push(e-n),u&&i.push(e+1),d&&i.push(e+n)),i}),"getNeighbours"),x={id:"level",tileWidth:()=>t.tileWidth,tileHeight:()=>t.tileHeight,spawn(e,...r){let n=te(...r),o=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(t.tiles[e]){if("function"!=typeof t.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return t.tiles[e](n)}if(t.wildcardTile)return t.wildcardTile(e,n)})();if(!o)return null;let a=!1,l=!1;for(let t of o)"tile"===t.id&&(l=!0),"pos"===t.id&&(a=!0);a||o.push(Jo()),l||o.push(yo());let h=i.add(o);return a&&(h.tilePosOffset=h.pos.clone()),h.tilePos=n,s&&(c(h),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),h},numColumns:()=>n,numRows:()=>r,levelWidth(){return n*this.tileWidth()},levelHeight(){return r*this.tileHeight()},tile2Pos(...e){return te(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=te(...e);return te(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(s||d(),s),onSpatialMapChanged(e){return this.on("spatialMapChanged",e)},onNavigationMapInvalid(e){return this.on("navigationMapInvalid",e)},getAt(e){s||d();let t=h(e);return s[t]||[]},raycast(e,t){let i=Ze(e.scale(1/this.tileWidth(),1/this.tileHeight()),t,(i=>{let r=this.getAt(i);if(r.some((e=>e.isObstacle)))return!0;let n=null;for(let s of r)if(s.is("area")){let i=s.worldArea().raycast(e,t);i&&(n?i.fraction<n.fraction&&(n=i,n.object=s):(n=i,n.object=s))}return n||!1}),64);return i&&(i.point=i.point.scale(this.tileWidth(),this.tileHeight())),i},update(){s&&p()},invalidateNavigationMap(){o=null,a=null,l=null},onNavigationMapChanged(e){return this.on("navigationMapChanged",e)},getTilePath(e,t,i={}){var s;if(o||g(),a||m(),l||w(),e.x<0||e.x>=n||e.y<0||e.y>=r||t.x<0||t.x>=n||t.y<0||t.y>=r)return null;let d=h(e),c=h(t);if(o[c]===1/0)return null;if(d===c)return[];if(-1!=l[d]&&l[d]!==l[c])return null;let f=new jt(((e,t)=>e.cost<t.cost));f.insert({cost:0,node:d});let p=new Map;p.set(d,d);let x=new Map;for(x.set(d,0);0!==f.length;){let e=null==(s=f.remove())?void 0:s.node;if(e===c)break;let t=A(e,i.allowDiagonals);for(let i of t){let t=(x.get(e)||0)+y(e,i)+v(i,c);(!x.has(i)||t<x.get(i))&&(x.set(i,t),f.insert({cost:t,node:i}),p.set(i,e))}}let b=[],V=c,E=u(V);for(b.push(E);V!==d;){let e=p.get(V);if(!e)throw new Error("Bug in pathfinding algorithm");V=e;let t=u(V);b.push(t)}return b.reverse()},getPath(e,t,i={}){let r=this.tileWidth(),n=this.tileHeight(),s=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),i);return s?[e,...s.slice(1,-1).map((e=>e.scale(r,n).add(r/2,n/2))),t]:null}};return i.use(x),i.onNavigationMapInvalid((()=>{i.invalidateNavigationMap(),i.trigger("navigationMapChanged")})),e.forEach(((e,t)=>{let r=e.split("");n=Math.max(r.length,n),r.forEach(((e,r)=>{i.spawn(e,te(r,t))}))})),i}function Ms(e,t,i){return ra.objEvents.registers[e]||(ra.objEvents.registers[e]=new _t),ra.objEvents.on(e,((e,...r)=>{e.is(t)&&i(e,...r)}))}K(ds,"particles"),K(cs,"polygon"),K(fs,"raycast"),K(ps,"rect"),K(gs,"shader"),K(ms,"camPos"),K(ws,"camScale"),K(ys,"camRot"),K(vs,"camFlash"),K(As,"camTransform"),K(xs,"shake"),K(bs,"toScreen"),K(Vs,"toWorld"),K(Es,"addLevel"),K(Ms,"on");var Ss=ni((e=>{let t=ra.root.add([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:K((()=>t.destroy()),"cancel")}}),((e,t)=>Ms("fixedUpdate",e,t))),Rs=ni((e=>{let t=ra.root.add([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:K((()=>t.destroy()),"cancel")}}),((e,t)=>Ms("update",e,t))),Is=ni((e=>{let t=ra.root.add([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:K((()=>t.destroy()),"cancel")}}),((e,t)=>Ms("draw",e,t))),ks=ni((e=>ra.events.on("add",e)),((e,t)=>Ms("add",e,t))),Ps=ni((e=>ra.events.on("destroy",e)),((e,t)=>Ms("destroy",e,t)));function Bs(e,t,i){return Ms("collide",e,((e,r,n)=>r.is(t)&&i(e,r,n)))}function Ds(e,t,i){return Ms("collideUpdate",e,((e,r,n)=>r.is(t)&&i(e,r,n)))}function Ts(e,t,i){return Ms("collideEnd",e,((e,r,n)=>r.is(t)&&i(e,r,n)))}function Fs(e,t){ra.root.get(e,{recursive:!0}).forEach(t),ks(e,t)}K(Bs,"onCollide"),K(Ds,"onCollideUpdate"),K(Ts,"onCollideEnd"),K(Fs,"forAllCurrentAndFuture");var Cs=ni((e=>na.onMousePress(e)),((e,t)=>{let i=[];return Fs(e,(e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");i.push(e.onClick((()=>t(e))))})),$t.join(i)}));function Os(e,t){let i=[];return Fs(e,(e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");i.push(e.onHover((()=>t(e))))})),$t.join(i)}function Us(e,t){let i=[];return Fs(e,(e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");i.push(e.onHoverUpdate((()=>t(e))))})),$t.join(i)}function Ns(e,t){let i=[];return Fs(e,(e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");i.push(e.onHoverEnd((()=>t(e))))})),$t.join(i)}function Ls(e){ra.events.on("loading",e)}function qs(e){na.onResize(e)}function Gs(e){ra.events.on("error",e)}function js(e){sa.loaded?e():ra.events.on("load",e)}function Ks(e=[]){let t=new Map,i=[],r={},n=new ti,s=[],o=null,a=!1,l={id:Vi(),hidden:!1,transform:new oe,children:[],parent:null,set paused(e){if(e!==a){a=e;for(let t of s)t.paused=e}},get paused(){return a},get tags(){let e=[];for(let[i,r]of t.entries())1==Object.keys(r).length&&e.push(i);return e},add(e){let t=Array.isArray(e)?Ks(e):e;if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t.parent=this,t.transform=Xi(t),this.children.push(t),t.trigger("add",t),ra.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);if(-1!==t){e.parent=null,this.children.splice(t,1);let i=K((e=>{e.trigger("destroy"),ra.events.trigger("destroy",e),e.children.forEach((e=>i(e)))}),"trigger");i(e)}},removeAll(e){if(e)this.get(e).forEach((e=>this.remove(e)));else for(let t of[...this.children])this.remove(t)},fixedUpdate(){this.paused||(this.children.forEach((e=>e.fixedUpdate())),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach((e=>e.update())),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(or(),this.canvas.bind());let e=ia.fixed;this.fixed&&(ia.fixed=!0),tr(),er(this.pos),rr(this.scale),nr(this.angle);let t=this.children.sort(((e,t)=>(e.layerIndex??ra.defaultLayerIndex)-(t.layerIndex??ra.defaultLayerIndex)||(e.z??0)-(t.z??0)));if(this.mask){let e={intersect:ea.drawMasked,subtract:ea.drawSubtracted}[this.mask];if(!e)throw new Error(`Invalid mask func: "${this.mask}"`);e((()=>{t.forEach((e=>e.draw()))}),(()=>{this.trigger("draw")}))}else this.trigger("draw"),t.forEach((e=>e.draw()));sr(),ia.fixed=e,this.canvas&&(or(),this.canvas.unbind())},drawInspect(){this.hidden||(tr(),er(this.pos),rr(this.scale),nr(this.angle),this.children.forEach((e=>e.drawInspect())),this.trigger("drawInspect"),sr())},use(e){if(!e)return;if(Gt(e)&&(e=new e(this)),"function"==typeof e)return this.use(e(this));if("string"==typeof e)return this.use({id:e});let n=[];e.id?(this.unuse(e.id),r[e.id]=[],n=r[e.id],t.set(e.id,e)):i.push(e);for(let t in e){if(Mr.has(t))continue;let i=Object.getOwnPropertyDescriptor(e,t);if(i)if("function"==typeof i.value&&(e[t]=e[t].bind(this)),i.set&&Object.defineProperty(e,t,{set:i.set.bind(this)}),i.get&&Object.defineProperty(e,t,{get:i.get.bind(this)}),Sr.has(t)){let i="add"===t?()=>{var i;o=K((e=>n.push(e)),"onCurCompCleanup"),null==(i=e[t])||i.call(e),o=null}:e[t];n.push(this.on(t,i).cancel)}else{if(void 0!==this[t])throw new Error(`Duplicate component property: "${t}"`);Object.defineProperty(this,t,{get:K((()=>e[t]),"get"),set:K((i=>e[t]=i),"set"),configurable:!0,enumerable:!0}),n.push((()=>delete this[t]))}}let s=K((()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)}),"checkDeps");e.destroy&&n.push(e.destroy.bind(this)),this.exists()?(s(),e.add&&(o=K((e=>n.push(e)),"onCurCompCleanup"),e.add.call(this),o=null)):e.require&&n.push(this.on("add",s).cancel)},unuse(e){if(t.has(e)){for(let i of t.values())if(i.require&&i.require.includes(e))throw new Error(`Can't unuse. Component "${i.id}" requires component "${e}"`);t.delete(e)}r[e]&&(r[e].forEach((e=>e())),delete r[e])},c:e=>t.get(e)??null,get(e,t={}){let i=t.recursive?this.children.flatMap(K((function e(t){return[t,...t.children.flatMap(e)]}),"recurse")):this.children;if(i=i.filter((t=>!e||t.is(e))),t.liveUpdate){let r=K((e=>t.recursive?this.isAncestorOf(e):e.parent===this),"isChild"),n=[];n.push(ea.onAdd((t=>{r(t)&&t.is(e)&&i.push(t)}))),n.push(ea.onDestroy((t=>{if(r(t)&&t.is(e)){let e=i.findIndex((e=>e.id===t.id));-1!==e&&i.splice(e,1)}}))),this.onDestroy((()=>{for(let e of n)e.cancel()}))}return i},query(e){let t=e.hierarchy||"children",i=e.include,r=e.exclude,n=[];switch(t){case"children":n=this.children;break;case"siblings":n=this.parent?this.parent.children.filter((e=>e!==this)):[];break;case"ancestors":let e=this.parent;for(;e;)n.push(e),e=e.parent;break;case"descendants":n=this.children.flatMap(K((function e(t){return[t,...t.children.flatMap(e)]}),"recurse"))}if(i&&(n="and"!==(e.includeOp||"and")&&Array.isArray(e.include)?n.filter((t=>e.include.some((e=>t.is(e))))):n.filter((e=>e.is(i)))),r&&(n="and"!==(e.includeOp||"and")&&Array.isArray(e.include)?n.filter((t=>!e.exclude.some((e=>t.is(e))))):n.filter((e=>!e.is(r)))),!0===e.visible&&(n=n.filter((e=>e.visible))),e.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let t=e.distanceOp||"near",i=e.distance*e.distance;n="near"===t?n.filter((e=>e.pos&&this.pos.sdist(e.pos)<=i)):n.filter((e=>e.pos&&this.pos.sdist(e.pos)>i))}return e.name&&(n=n.filter((t=>t.name===e.name))),n},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return ra.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let i=n.on(e,t.bind(this));return o&&o((()=>i.cancel())),i},trigger(e,...t){n.trigger(e,...t),ra.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){var e;let r={};for(let[i,n]of t)r[i]=(null==(e=n.inspect)?void 0:e.call(n))??null;for(let[t,n]of i.entries())if(n.inspect)r[t]=n.inspect();else for(let[e,i]of Object.entries(n))"function"!=typeof i&&(r[e]=`${e}: ${i}`);return r},onAdd(e){return this.on("add",e)},onFixedUpdate(e){return this.on("fixedUpdate",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){n.clear()}},h=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let u of h)l[u]=(...e)=>{var t;let i=null==(t=na[u])?void 0:t.call(na,...e);return s.push(i),l.onDestroy((()=>i.cancel())),i};for(let u of e)l.use(u);return l}K(Os,"onHover"),K(Us,"onHoverUpdate"),K(Ns,"onHoverEnd"),K(Ls,"onLoading"),K(qs,"onResize"),K(Gs,"onError"),K(js,"onLoad"),K(Ks,"make");var Hs=K((()=>({events:new ti,objEvents:new ti,root:Ks([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new ee(1),angle:0,shake:0,transform:new oe}})),"initGame");function Ys(e){ra.gravity=e?(ra.gravity||te(0,1)).unit().scale(e):null}function zs(){return ra.gravity?ra.gravity.len():0}function Qs(e){ra.gravity=e.unit().scale(ra.gravity?ra.gravity.len():1)}function Ws(){return ra.gravity?ra.gravity.unit():te(0,1)}K(Ys,"setGravity"),K(zs,"getGravity"),K(Qs,"setGravityDirection"),K(Ws,"getGravityDirection");var Xs=H("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Js=K((()=>(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let i=new cn(Ui(e));return e.decodeAudioData(Xs.buffer.slice(0)).then((e=>{i.buf=e})).catch((e=>{console.error("Failed to load burp: ",e)})),{ctx:e,masterNode:t,burpSnd:i}})()),"initAudio");function Zs(e,t={}){let i=new ei,r=new Audio(e);function n(){la.paused||na.isHidden()&&!ta.backgroundAudio||ha.ctx.resume()}function s(){n(),r.play()}return ha.ctx.createMediaElementSource(r).connect(ha.masterNode),K(n,"resumeAudioCtx"),K(s,"play"),t.paused||s(),r.onended=()=>i.trigger(),{play(){s()},seek(e){r.currentTime=e},stop(){r.pause(),this.seek(0)},set loop(e){r.loop=e},get loop(){return r.loop},set paused(e){e?r.pause():s()},get paused(){return r.paused},time:()=>r.currentTime,duration:()=>r.duration,set volume(e){r.volume=J(e,0,1)},get volume(){return r.volume},set speed(e){r.playbackRate=Math.max(e,0)},get speed(){return r.playbackRate},set detune(e){},get detune(){return 0},onEnd:e=>i.add(e),then(e){return this.onEnd(e)}}}function _s(e,t={}){if("string"==typeof e&&sa.music[e])return Zs(sa.music[e],t);let i=ha.ctx,r=t.paused??!1,n=i.createBufferSource(),s=new ei,o=i.createGain(),a=i.createStereoPanner(),l=t.seek??0,h=0,u=0,d=!1;n.loop=!!t.loop,n.detune.value=t.detune??0,n.playbackRate.value=t.speed??1,n.connect(a),n.onended=()=>{var e;p()>=((null==(e=n.buffer)?void 0:e.duration)??Number.POSITIVE_INFINITY)&&s.trigger()},a.pan.value=t.pan??0,a.connect(o),o.connect(ha.masterNode),o.gain.value=t.volume??1;let c=K((e=>{n.buffer=e.buf,r||(h=i.currentTime,n.start(0,l),d=!0)}),"start"),f=fn(e);f instanceof Pr&&f.onLoad(c);let p=K((()=>{if(!n.buffer)return 0;let e=r?u-h:i.currentTime-h,t=n.buffer.duration;return n.loop?e%t:Math.min(e,t)}),"getTime"),g=K((e=>{let t=i.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(o),t}),"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(r!==e)if(r=e,e)d&&(n.stop(),d=!1),u=i.currentTime;else{n=g(n);let e=u-h;n.start(0,e),d=!0,h=i.currentTime-e,u=0}},get paused(){return r},play(e=0){this.seek(e),this.paused=!1},seek(e){var t;(null==(t=n.buffer)?void 0:t.duration)&&(e>n.buffer.duration||(r?(n=g(n),h=u-e):(n.stop(),n=g(n),h=i.currentTime-e,n.start(0,e),d=!0,u=0)))},set speed(e){n.playbackRate.value=e},get speed(){return n.playbackRate.value},set detune(e){n.detune.value=e},get detune(){return n.detune.value},set volume(e){o.gain.value=Math.max(e,0)},get volume(){return o.gain.value},set pan(e){a.pan.value=e},get pan(){return a.pan.value},set loop(e){n.loop=e},get loop(){return n.loop},duration(){var e;return(null==(e=n.buffer)?void 0:e.duration)??0},time(){return p()%this.duration()},onEnd:e=>s.add(e),then(e){return this.onEnd(e)}}}function $s(e){return _s(ha.burpSnd,e)}function eo(e){return void 0!==e&&(ha.masterNode.gain.value=e),ha.masterNode.gain.value}function to(){na.onHide((()=>{ta.backgroundAudio||ha.ctx.suspend()})),na.onShow((()=>{!ta.backgroundAudio&&!la.paused&&ha.ctx.resume()})),na.onResize((()=>{if(na.isFullscreen())return;let e=ta.width&&ta.height;e&&!ta.stretch&&!ta.letterbox||(da.width=da.offsetWidth*ua,da.height=da.offsetHeight*ua,es(),e||(ia.frameBuffer.free(),ia.frameBuffer=new Pn(ia.ggl,ia.ggl.gl.drawingBufferWidth,ia.ggl.gl.drawingBufferHeight),ia.width=ia.ggl.gl.drawingBufferWidth/ua/ca,ia.height=ia.ggl.gl.drawingBufferHeight/ua/ca))})),!1!==ta.debug&&(na.onKeyPress(ta.debugKey??"f1",(()=>la.inspect=!la.inspect)),na.onKeyPress("f2",(()=>la.clearLog())),na.onKeyPress("f8",(()=>la.paused=!la.paused)),na.onKeyPress("f7",(()=>{la.timeScale=ri(J(la.timeScale-.2,0,2),1)})),na.onKeyPress("f9",(()=>{la.timeScale=ri(J(la.timeScale+.2,0,2),1)})),na.onKeyPress("f10",(()=>la.stepFrame()))),ta.burp&&na.onKeyPress("b",(()=>$s()))}function io(e,t={}){let i=ra.root.add([Jo(e),Bo()]),r=5*(t.speed||1),n=t.scale||1;i.add([uo(pa),_o(0),Ho("center"),So(r,n),...t.comps??[]]);let s=i.add([uo(fa),_o(0),Ho("center"),To(),...t.comps??[]]);return s.wait(.4/r,(()=>s.use(So(r,n)))),s.onDestroy((()=>i.destroy())),i}K(Zs,"playMusic"),K(_s,"play"),K($s,"burp"),K(eo,"volume"),K(to,"initEvents"),K(io,"addKaboom");var ro=K((function(e,t){if(ra.layers)throw Error("Layers can only be assigned once.");let i=e.indexOf(t);if(-1==i)throw Error("The default layer name should be present in the layers list.");ra.layers=e,ra.defaultLayerIndex=i}),"layers");function no(e){e.destroy()}function so(){return ra.root}function oo(e,t){ra.scenes[e]=t}function ao(e,...t){if(!ra.scenes[e])throw new Error(`Scene not found: ${e}`);ra.events.onOnce("frameEnd",(()=>{ra.events.trigger("sceneLeave",e),na.events.clear(),ra.events.clear(),ra.objEvents.clear(),[...ra.root.children].forEach((t=>{(!t.stay||t.scenesToStay&&!t.scenesToStay.includes(e))&&ra.root.remove(t)})),ra.root.clearEvents(),to(),ra.cam={pos:null,scale:te(1),angle:0,shake:0,transform:new oe},ra.scenes[e](...t)})),ra.currentScene=e}function lo(e){return ra.events.on("sceneLeave",e)}function ho(){return ra.currentScene}function uo(e,t={}){let i=null,r=null,n=null,s=new ei;if(!e)throw new Error("Please pass the resource name or data to sprite()");let o=K(((e,t,i,r)=>{let n=te(1,1);return i&&r?(n.x=i/(e.width*t.w),n.y=r/(e.height*t.h)):i?(n.x=i/(e.width*t.w),n.y=n.x):r&&(n.y=r/(e.height*t.h),n.x=n.y),n}),"calcTexScale"),a=K(((e,r)=>{if(!r)return;let n=r.frames[0].clone();t.quad&&(n=n.scale(t.quad));let a=o(r.tex,n,t.width,t.height);e.width=r.tex.width*n.w*a.x,e.height=r.tex.height*n.h*a.y,t.anim&&e.play(t.anim),i=r,s.trigger(i)}),"setSpriteData");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new ie(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,get sprite(){return e.toString()},set sprite(e){let t=Hr(e);t&&t.onLoad((e=>a(this,e)))},draw(){if(!i)return;let e=i.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(i.slice9){let{left:r,right:n,top:s,bottom:o}=i.slice9,a=i.tex.width*e.w,l=i.tex.height*e.h,h=this.width-r-n,u=this.height-s-o,d=r/a,c=n/a,f=1-d-c,p=s/l,g=o/l,m=1-p-g,w=[re(0,0,d,p),re(d,0,f,p),re(d+f,0,c,p),re(0,p,d,m),re(d,p,f,m),re(d+f,p,c,m),re(0,p+m,d,g),re(d,p+m,f,g),re(d+f,p+m,c,g),re(0,0,r,s),re(r,0,h,s),re(r+h,0,n,s),re(0,s,r,u),re(r,s,h,u),re(r+h,s,n,u),re(0,s+u,r,o),re(r,s+u,h,o),re(r+h,s+u,n,o)];for(let y=0;y<9;y++){let r=w[y],n=w[y+9];Xn(Object.assign(is(this),{pos:n.pos(),tex:i.tex,quad:e.scale(r),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:n.w,height:n.h}))}}else Xn(Object.assign(is(this),{tex:i.tex,quad:e.scale(this.quad??new ie(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let t=Hr(e);t?t.onLoad((e=>a(this,e))):js((()=>a(this,Hr(e).data)))},update(){if(!i||!r||null===n)return;let e=i.anims[r.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");r.timer+=Di()*this.animSpeed,r.timer>=1/r.speed&&(r.timer=0,this.frame+=n,(this.frame<Math.min(e.from,e.to)||this.frame>Math.max(e.from,e.to))&&(r.loop?r.pingpong?(this.frame-=n,n*=-1,this.frame+=n):this.frame=e.from:r.pingpong?n===Math.sign(e.to-e.from)?(this.frame=e.to,n*=-1,this.frame+=n):(this.frame=e.from,r.onEnd(),this.stop()):(this.frame=e.to,r.onEnd(),this.stop())))}else this.frame=e},play(e,t={}){if(!i)return void s.add((()=>this.play(e,t)));let o=i.anims[e];if(void 0===o)throw new Error(`Anim not found: ${e}`);r&&this.stop(),r="number"==typeof o?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:K((()=>{}),"onEnd")}:{name:e,timer:0,loop:t.loop??o.loop??!1,pingpong:t.pingpong??o.pingpong??!1,speed:t.speed??o.speed??10,onEnd:t.onEnd??(()=>{})},n="number"==typeof o?null:o.from<o.to?1:-1,this.frame="number"==typeof o?o:o.from,this.trigger("animStart",e)},stop(){if(!r)return;let e=r.name;r=null,this.trigger("animEnd",e)},numFrames:()=>(null==i?void 0:i.frames.length)??0,getCurAnim:()=>r,curAnim:()=>null==r?void 0:r.name,getAnim:e=>(null==i?void 0:i.anims[e])??null,hasAnim(e){return!!this.getAnim(e)},onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new et(te(0),this.width,this.height)},inspect:()=>"string"==typeof e?`sprite: "${e}"`:null}}function co(e,t={}){function i(e){var i,r;let n=Un(Object.assign(is(e),{text:e.text+"",size:e.textSize,font:e.font,width:t.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return t.width||(e.width=n.width/((null==(i=e.scale)?void 0:i.x)||1)),e.height=n.height/((null==(r=e.scale)?void 0:r.y)||1),n}K(i,"update");let r={id:"text",set text(t){e=t,i(this)},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,add(){js((()=>i(this)))},draw(){Ln(i(this))},renderArea(){return new et(te(0),this.width,this.height)}};return i(r),r}function fo(e,t){return{id:"rect",width:e,height:t,draw(){Nn(Object.assign(is(this),{width:this.width,height:this.height}))},renderArea(){return new et(te(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}function po(e={}){let t=null,i=null,r=null,n=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>i&&r?i[r]:null,getPath:()=>i?i.slice():null,getTarget:()=>t,isNavigationFinished:()=>!i||null===r,isTargetReachable:()=>null!==i,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,i=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=i?0:null,i&&null!==r?(n||(n=this.getLevel().onNavigationMapChanged((()=>{t&&i&&null!==r&&(i=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),i?(r=0,this.trigger("navigationNext",this,i[r])):(r=null,this.trigger("navigationEnded",this)))})),this.onDestroy((()=>null==n?void 0:n.cancel()))),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,i[r])):this.trigger("navigationEnded",this)},update(){if(t&&i&&null!==r){if(this.pos.sdist(i[r])<2){if(r===i.length-1)return this.pos=t.clone(),r=null,this.trigger("navigationEnded",this),void this.trigger("targetReached",this);r++,this.trigger("navigationNext",this,i[r])}this.moveTo(i[r],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigationStarted",e)},onNavigationNext(e){return this.on("navigationNext",e)},onNavigationEnded(e){return this.on("navigationEnded",e)},onTargetReached(e){return this.on("targetReached",e)},inspect:()=>"agent: "+JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(i)})}}function go(e){let t=e.graph;return{id:"navigator",require:["pos"],navigateTo(t){var i;return null==(i=this.graph)?void 0:i.getWaypointPath(this.pos,t,e.navigationOpt)},get graph(){if(t)return t;let e=this.parent;for(;e;){if(e.is("navigatormap"))return e.graph;e=e.parent}},set graph(e){t=e}}}function mo(e={}){let t=e.waypoints,i=e.speed||100,r=e.endBehavior||"stop",n=0,s=null!=t;return{id:"patrol",require:["pos"],get patrolSpeed(){return i},set patrolSpeed(e){i=e},get waypoints(){return t},set waypoints(e){t=e,n=0,s=!1},get nextLocation(){return t?t[n]:void 0},update(){let e=this.nextLocation;if(t&&e&&!s&&(this.moveTo(e,i),this.pos.sdist(e)<9))switch(r){case"loop":n=(n+1)%t.length;break;case"ping-pong":n+=1,n==t.length&&(t.reverse(),n=0);break;case"stop":n=Math.min(n+1,t.length-1),n==t.length-1&&(s=!0,this.trigger("patrolFinished"))}},onPatrolFinished(e){return this.on("patrolFinished",e)}}}function wo(e,t={}){let i="function"==typeof e?e:()=>ra.root.query(e),r=t.checkFrequency||1,n="number"==typeof t.direction?ee.fromAngle(t.direction):t.direction,s=0;return{id:"sentry",require:["pos"],direction:"number"==typeof t.direction?ee.fromAngle(t.direction):t.direction,spotted:[],set directionAngle(e){this.direction=void 0!==e?ee.fromAngle(e):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:t.fieldOfView||200,isWithinFieldOfView(e,i,r){let s=("number"==typeof i?ee.fromAngle(i):i)||n,o=r||t.fieldOfView;if(!s||!o||o>=360)return!0;let a=o/2;return e.pos&&s.angleBetween(e.pos.sub(this.pos))<=a},hasLineOfSight(e){let i=fs(this.pos,e.pos.sub(this.pos),t.raycastExclude);return null!=i&&i.object===e},update(){if(s+=Di(),s>r){s-=r;let e=i();if(e.length&&n&&this.fieldOfView&&this.fieldOfView<360){let t=this.fieldOfView/2;e=e.filter((e=>e.pos&&n.angleBetween(e.pos.sub(this.pos))<=t))}e.length&&t.lineOfSight&&(e=e.filter((e=>e.pos&&this.hasLineOfSight(e)))),e.length>0&&(this.spotted=e,this.trigger("objectSpotted",e))}},onObjectsSpotted(e){return this.on("objectSpotted",e)}}}function yo(e={}){let t=te(0),i=e.isObstacle??!1,r=e.cost??0,n=e.edges??[],s=K((()=>{let e={left:1,top:2,right:4,bottom:8};return n.map((t=>e[t]||0)).reduce(((e,t)=>e|t),0)}),"getEdgeMask"),o=s();return{id:"tile",tilePosOffset:e.offset??te(0),set tilePos(e){let i=this.getLevel();t=e.clone(),this.pos=te(this.tilePos.x*i.tileWidth(),this.tilePos.y*i.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(e){i!==e&&(i=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return i},set cost(e){r!==e&&(r=e,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(e){n=e,o=s(),this.getLevel().invalidateNavigationMap()},get edges(){return n},get edgeMask(){return o},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(te(-1,0))},moveRight(){this.tilePos=this.tilePos.add(te(1,0))},moveUp(){this.tilePos=this.tilePos.add(te(0,-1))},moveDown(){this.tilePos=this.tilePos.add(te(0,1))}}}K(no,"destroy"),K(so,"getTreeRoot"),K(oo,"scene"),K(ao,"go"),K(lo,"onSceneLeave"),K(ho,"getSceneName"),K(uo,"sprite"),K(co,"text"),K(fo,"uvquad"),K(po,"agent"),K(go,"navigation"),K(mo,"patrol"),K(wo,"sentry"),K(yo,"tile");var vo=(K(C=class{constructor(e,t,i){q(this,"name"),q(this,"duration"),q(this,"loops"),q(this,"direction"),q(this,"easing"),q(this,"interpolation"),q(this,"isFinished"),q(this,"timing"),q(this,"easings"),q(this,"relative"),this.name=e,this.duration=t.duration,this.loops=t.loops||0,this.direction=t.direction||"forward",this.easing=t.easing||Ki.linear,this.interpolation=t.interpolation||"linear",this.isFinished=!1,this.timing=t.timing,this.easings=t.easings,this.relative=i}update(e,t){return!0}getLowerKeyIndexAndRelativeTime(e,t,i){let r=t-1,n=e/this.duration;if(0!==this.loops&&n>=this.loops)return[r,0];let s=Math.trunc(n);if(n-=s,("reverse"==this.direction||"ping-pong"==this.direction&&1&s)&&(n=1-n),i){let e=0;for(;void 0!==i[e+1]&&i[e+1]<n;)e++;return e>=r?[r,0]:[e,(n-i[e])/(i[e+1]-i[e])]}{let e=Math.floor((t-1)*n);return[e,(n-e/r)*r]}}setValue(e,t,i){if(this.relative)switch(t){case"pos":e.pos=e.base.pos.add(i);break;case"angle":e.angle=e.base.angle+i;break;case"scale":e.scale=e.base.scale.scale(i);break;case"opacity":e.opacity=e.base.opacity*i;break;default:e[t]=i}else e[t]=i}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),"forward"!==this.direction&&(e.direction=this.direction),this.easing!=Ki.linear&&(e.easing=this.easing.name),"linear"!==this.interpolation&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map((e=>this.easing.name))),e}},"AnimateChannel"),C);function Ao(e,t){return t.add(t.sub(e))}K(Ao,"reflect");var xo=(K(O=class extends vo{constructor(e,t,i,r){super(e,i,r),q(this,"keys"),this.keys=t}update(e,t){let[i,r]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(0==r||"none"===this.interpolation)this.setValue(e,this.name,this.keys[i]);else{let t=this.easings?this.easings[i]:this.easing;this.setValue(e,this.name,Z(this.keys[i],this.keys[i+1],t(r)))}return 1==r}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},"AnimateChannelNumber"),O),bo=(K(U=class extends vo{constructor(e,t,i,r,n){var s;if(super(e,i,r),q(this,"keys"),q(this,"curves"),q(this,"dcurves"),this.keys=t,"spline"===this.interpolation){this.curves=[],n&&(this.dcurves=[]);for(let e=0;e<this.keys.length-1;e++){let t=this.keys[e],i=e+1,r=this.keys[i],o=e>0?this.keys[e-1]:Ao(r,t),a=i<this.keys.length-1?this.keys[i+1]:Ao(t,r);this.curves.push(wt(o,t,r,a)),n&&(null==(s=this.dcurves)||s.push(wt(o,t,r,a,At)))}}}update(e,t){let[i,r]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(0==r||"none"===this.interpolation)this.setValue(e,this.name,this.keys[i]);else{let t=this.easings?this.easings[i]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[i].lerp(this.keys[i+1],t(r)));break;case"slerp":this.setValue(e,this.name,this.keys[i].slerp(this.keys[i+1],t(r)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[i](t(r))),this.dcurves&&this.setValue(e,"angle",this.dcurves[i](t(r)).angle());break}}}return 1==r}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map((e=>[e.x,e.y]))})}},"AnimateChannelVec2"),U),Vo=(K(N=class extends vo{constructor(e,t,i,r){super(e,i,r),q(this,"keys"),this.keys=t}update(e,t){let[i,r]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(0==r||"none"==this.interpolation)this.setValue(e,this.name,this.keys[i]);else{let t=this.easings?this.easings[i]:this.easing;this.setValue(e,this.name,this.keys[i].lerp(this.keys[i+1],t(r)))}return 1==r}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},"AnimateChannelColor"),N);function Eo(e={}){let t=[],i=0,r=!1;return{id:"animate",require:e.followMotion?["rotate"]:void 0,base:{pos:te(0,0),angle:0,scale:te(1,1),opacity:1},add(){e.relative&&(this.is("pos")&&(this.base.pos=this.pos.clone()),this.is("rotate")&&(this.base.angle=this.angle),this.is("scale")&&(this.base.scale=this.scale),this.is("opacity")&&(this.base.opacity=this.opacity))},update(){let e,n=!0;i+=Di();for(let r of t)e=r.update(this,i),e&&!r.isFinished&&(r.isFinished=!0,this.trigger("animateChannelFinished",r.name)),n&&(n=e);n&&!r&&(r=!0,this.trigger("animateFinished"))},animate(i,n,s){r=!1,this.unanimate(i),"number"==typeof n[0]?t.push(new xo(i,n,s,e.relative||!1)):n[0]instanceof ee?t.push(new bo(i,n,s,e.relative||!1,"pos"===i&&(e.followMotion||!1))):n[0]instanceof Y&&t.push(new Vo(i,n,s,e.relative||!1))},unanimate(e){let i=t.findIndex((t=>t.name===e));i>=0&&t.splice(i,1)},unanimateAll(){t.splice(0,t.length)},onAnimateFinished(e){return this.on("animateFinished",e)},onAnimateChannelFinished(e){return this.on("animateChannelFinished",e)},serializeAnimationChannels:()=>t.reduce(((e,t)=>(e[t.name]=t.serialize(),e)),{}),serializeAnimationOptions(){let t={};return e.followMotion&&(t.followMotion=!0),e.relative&&(t.relative=!0),t}}}function Mo(e,t){let i={name:e.name};return e.is("animate")&&(i.channels=e.serializeAnimationChannels(),Object.assign(i,e.serializeAnimationOptions())),e.children.length>0&&(i.children=e.children.filter((e=>e.is("named"))).map((e=>Mo(e,e.name)))),i}function So(e=2,t=1){let i=0;return{require:["scale"],update(){let r=Math.sin(i*e)*t;r<0&&this.destroy(),this.scale=te(r),i+=Di()}}}function Ro(e,t){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){let i=e;this.setHP(e+t),this.trigger("heal",e-i)},hp:()=>e,maxHP:()=>t??null,setMaxHP(e){t=e},setHP(i){(e=t?Math.min(t,i):i)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`health: ${e}`}}function Io(e,t={}){if(null==e)throw new Error("lifespan() requires time");let i=t.fade??0;return{id:"lifespan",require:["opacity"],async add(){await ra.root.wait(e),this.opacity=this.opacity??1,i>0&&await ra.root.tween(this.opacity,0,i,(e=>this.opacity=e),Ki.linear),this.destroy()}}}function ko(e){return{id:"named",name:e}}function Po(e,t,i){if(!e)throw new Error("state() requires an initial state");let r={};function n(e){r[e]||(r[e]={enter:new ei,end:new ei,update:new ei,draw:new ei})}function s(e,t,i){return n(t),r[t][e].add(i)}function o(e,t,...i){n(t),r[t][e].trigger(...i)}K(n,"initStateEvents"),K(s,"on"),K(o,"trigger");let a=!1;return{id:"state",state:e,enterState(e,...r){if(a=!0,t&&!t.includes(e))throw new Error(`State not found: ${e}`);let n=this.state;if(i){if(!(null==i?void 0:i[n]))return;let t="string"==typeof i[n]?[i[n]]:i[n];if(!t.includes(e))throw new Error(`Cannot transition state from "${n}" to "${e}". Available transitions: ${t.map((e=>`"${e}"`)).join(", ")}`)}o("end",n,...r),this.state=e,o("enter",e,...r),o("enter",`${n} -> ${e}`,...r)},onStateTransition:(e,t,i)=>s("enter",`${e} -> ${t}`,i),onStateEnter:(e,t)=>s("enter",e,t),onStateUpdate:(e,t)=>s("update",e,t),onStateDraw:(e,t)=>s("draw",e,t),onStateEnd:(e,t)=>s("end",e,t),update(){a||(o("enter",e),a=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return`state: ${this.state}`}}}function Bo(e){return{id:"stay",stay:!0,scenesToStay:e}}function Do(e=!0,t){let i,r;return{id:"textInput",hasFocus:e,require:["text"],add(){i=ea.onCharInput((e=>{this.hasFocus&&(!t||this.text.length<t)&&(ea.isKeyDown("shift")?this.text+=e.toUpperCase():this.text+=e)})),r=ea.onKeyPress("backspace",(()=>{this.hasFocus&&(this.text=this.text.slice(0,-1))}))},destroy(){i.cancel(),r.cancel()}}}function To(){return{id:"timer",wait(e,t){let i=[];t&&i.push(t);let r=0,n=this.onUpdate((()=>{r+=ea.dt(),r>=e&&(i.forEach((e=>e())),n.cancel())}));return{get paused(){return n.paused},set paused(e){n.paused=e},cancel:n.cancel,onEnd(e){i.push(e)},then(e){return this.onEnd(e),this}}},loop(e,t){let i=null,r=K((()=>{i=this.wait(e,r),t()}),"newAction");return i=this.wait(0,r),{get paused(){return(null==i?void 0:i.paused)??!1},set paused(e){i&&(i.paused=e)},cancel:K((()=>null==i?void 0:i.cancel()),"cancel")}},tween(e,t,i,r,n=Ki.linear){let s=0,o=[],a=this.onUpdate((()=>{s+=ea.dt();let l=Math.min(s/i,1);r(Z(e,t,n(l))),1===l&&(a.cancel(),r(t),o.forEach((e=>e())))}));return{get paused(){return a.paused},set paused(e){a.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){a.cancel()},finish(){a.cancel(),r(t),o.forEach((e=>e()))}}}}}K(Eo,"animate"),K(Mo,"serializeAnimation"),K(So,"boom"),K(Ro,"health"),K(Io,"lifespan"),K(ko,"named"),K(Po,"state"),K(Bo,"stay"),K(Do,"textInput"),K(To,"timer");var Fo=0;function Co(){return Fo>0}function Oo(e={}){let t={},i=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){Fo++,this.area.cursor&&this.onHover((()=>na.setCursor(this.area.cursor))),this.onCollideUpdate(((e,r)=>{if(!e.id)throw new Error("area() requires the object to have an id");t[e.id]||this.trigger("collide",e,r),r&&(t[e.id]=r,i.add(e.id))}))},destroy(){Fo--},fixedUpdate(){for(let e in t)i.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);i.clear()},drawInspect(){let e=this.localArea();ea.pushTransform(),ea.pushTranslate(this.area.offset);let t={outline:{width:4/hr(),color:z(0,0,255)},anchor:this.anchor,fill:!1,fixed:ts(this)};e instanceof ea.Rect?ea.drawRect({...t,pos:e.pos,width:e.width*this.area.scale.x,height:e.height*this.area.scale.y}):e instanceof ea.Polygon?ea.drawPolygon({...t,pts:e.pts,scale:this.area.scale}):e instanceof ea.Circle&&ea.drawCircle({...t,pos:e.center,radius:e.radius}),ea.popTransform()},area:{shape:e.shape??null,scale:e.scale?te(e.scale):te(1),offset:e.offset??te(0),cursor:e.cursor??null},isClicked(){return na.isMousePressed()&&this.isHovering()},isHovering(){let e=ts(this)?ea.mousePos():ea.toWorld(ea.mousePos());return this.hasPoint(e)},checkCollision(e){if(!e.id)throw new Error("checkCollision() requires the object to have an id");return t[e.id]??null},getCollisions:()=>Object.values(t),isColliding(e){if(!e.id)throw new Error("isColliding() requires the object to have an id");return!!t[e.id]},isOverlapping(e){if(!e.id)throw new Error("isOverlapping() requires the object to have an id");let i=t[e.id];return i&&i.hasOverlap()},onClick(e,t="left"){let i=na.onMousePress(t,(()=>{this.isHovering()&&e()}));return this.onDestroy((()=>i.cancel())),i},onHover(e){let t=!1;return this.onUpdate((()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())}))},onHoverUpdate(e){return this.onUpdate((()=>{this.isHovering()&&e()}))},onHoverEnd(e){let t=!1;return this.onUpdate((()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()}))},onCollide(e,t){if("function"==typeof e&&void 0===t)return this.on("collide",e);if("string"==typeof e)return this.onCollide(((i,r)=>{i.is(e)&&(null==t||t(i,r))}));throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(e,t){if("function"==typeof e&&void 0===t)return this.on("collideUpdate",e);if("string"==typeof e)return this.on("collideUpdate",((i,r)=>i.is(e)&&(null==t?void 0:t(i,r))));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(e,t){if("function"==typeof e&&void 0===t)return this.on("collideEnd",e);if("string"==typeof e)return this.on("collideEnd",(i=>i.is(e)&&(null==t?void 0:t(i))));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(e){return De(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof ea.Polygon||e instanceof ea.Rect))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(te(this.area.scale??1)).translate(this.area.offset);if(e instanceof ea.Rect){let i=Ci(this.anchor||gr).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(i)}return e.transform(t)},screenArea(){let e=this.worldArea();return ts(this)?e:e.transform(ra.cam.transform)},inspect(){var e,t,i,r,n,s,o;return(null==(e=this.area.scale)?void 0:e.x)==(null==(t=this.area.scale)?void 0:t.y)?`area: ${null==(r=null==(i=this.area.scale)?void 0:i.x)?void 0:r.toFixed(1)}x`:`area: (${null==(s=null==(n=this.area.scale)?void 0:n.x)?void 0:s.toFixed(1)}x, ${null==(o=this.area.scale.y)?void 0:o.toFixed(1)}y)`}}}function Uo(e={}){let t,i=null,r=null,n=!1,s=te(0),o=null,a=null;return{id:"body",require:["pos"],vel:te(0),drag:e.drag??0,jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(o=this.pos.clone(),a=this.pos.clone(),t=this.pos.clone(),0===this.mass)throw new Error("Can't set body mass to 0");this.is("area")&&(this.onCollideUpdate(((e,t)=>{if(!t||!e.is("body")||t.resolved)return;this.trigger("beforePhysicsResolve",t);let i=t.reverse();if(e.trigger("beforePhysicsResolve",i),!(t.resolved||i.resolved||this.isStatic&&e.isStatic)){if(this.isStatic||e.isStatic){let i=!this.isStatic&&e.isStatic?t:t.reverse();i.source.pos=i.source.pos.add(i.displacement),i.source.transform=Xi(i.source)}else{let i=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/i)),e.pos=e.pos.add(t.displacement.scale(-this.mass/i)),this.transform=Xi(this),e.transform=Xi(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}})),this.onPhysicsResolve((e=>{if(ra.gravity)if(e.isBottom()&&this.isFalling()){this.vel=this.vel.reject(ra.gravity.unit());let t=i;i=e.target,t!=i&&(r=e.target.pos),n?n=!1:t||(this.trigger("ground",i),e.target.trigger("land",this))}else e.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(ra.gravity.unit()),this.trigger("headbutt",e.target),e.target.trigger("headbutted",this))})))},update(){i&&this.isColliding(i)&&i.exists()&&i.is("body")&&(r&&!i.pos.eq(r)&&!1!==e.stickToPlatform&&this.moveBy(i.pos.sub(r)),r=i.pos);let n=ea.restDt();n&&(this.pos.x==t.x&&(this.pos.x=ea.lerp(o.x,a.x,n/ea.fixedDt()),t.x=this.pos.x),this.pos.y==t.y&&(this.pos.y=ea.lerp(o.y,a.y,n/ea.fixedDt()),t.y=this.pos.y))},fixedUpdate(){if(o&&(this.pos.x==t.x&&(this.pos.x=o.x),this.pos.y==t.y&&(this.pos.y=o.y),o=null),ra.gravity&&!this.isStatic){n&&(i=null,r=null,this.trigger("fallOff"),n=!1),i&&(!this.isColliding(i)||!i.exists()||!i.is("body"))&&(n=!0);let t=this.vel.clone();this.vel=this.vel.add(ra.gravity.scale(this.gravityScale*ea.dt()));let s=e.maxVelocity??65536;this.vel.slen()>s*s&&(this.vel=this.vel.unit().scale(s)),t.dot(ra.gravity)<0&&this.vel.dot(ra.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=s.x*ea.dt(),this.vel.y+=s.y*ea.dt(),this.vel.x*=1-this.drag*ea.dt(),this.vel.y*=1-this.drag*ea.dt(),this.move(this.vel),ea.restDt()){o=this.pos.clone();let e=this.vel.add(s.scale(ea.dt()));a=this.pos.add(e.scale(ea.dt())),t=this.pos.clone()}s.x=0,s.y=0},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>i,isGrounded:()=>null!==i,isFalling(){return this.vel.dot(ea.getGravityDirection())>0},isJumping(){return this.vel.dot(ea.getGravityDirection())<0},applyImpulse(e){this.vel=this.vel.add(e)},addForce(e){s.x+=e.x/this.mass,s.y+=e.y/this.mass},jump(e){i=null,r=null,this.vel=ea.getGravityDirection().scale(-e||-this.jumpForce)},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)},onLand(e){return this.on("land",e)},onHeadbutted(e){return this.on("headbutted",e)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}function No(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround((()=>{t=this.numJumps}))},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`jumpsLeft: ${t}`}}function Lo(e){return{id:"surfaceEffector",require:["area"],speed:e.speed,speedVariation:e.speedVariation??0,forceScale:e.speedVariation??.9,add(){this.onCollideUpdate("body",((e,t)=>{var i;let r=null==t?void 0:t.normal.normal(),n=e.vel.project(r),s=null==(i=null==r?void 0:r.scale(this.speed))?void 0:i.sub(n);e.addForce(null==s?void 0:s.scale(e.mass*this.forceScale))}))}}}function qo(e){return{id:"areaEffector",require:["area"],useGlobalAngle:e.useGlobalAngle||!1,forceAngle:e.forceAngle,forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",((e,t)=>{let i=ee.fromAngle(this.forceAngle).scale(this.forceMagnitude);e.addForce(i),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))}))}}}function Go(e){return{id:"pointEffector",require:["area","pos"],forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,distanceScale:e.distanceScale??1,forceMode:e.forceMode||"inverseLinear",linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",((e,t)=>{let i=this.pos.sub(e.pos),r=i.len(),n=r*this.distanceScale/10,s="constant"===this.forceMode?1:"inverseLinear"===this.forceMode?1/n:1/n**2,o=i.scale(this.forceMagnitude*s/r);e.addForce(o),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))}))}}}function jo(e){return{id:"constantForce",require:["body"],force:e.force,update(){this.force&&this.addForce(this.force)}}}function Ko(e){return{id:"buoyancyEffector",require:["area"],surfaceLevel:e.surfaceLevel,density:e.density??1,linearDrag:e.linearDrag??1,angularDrag:e.angularDrag??.2,flowAngle:e.flowAngle??0,flowMagnitude:e.flowMagnitude??0,flowVariation:e.flowVariation??0,add(){this.onCollideUpdate("body",((e,t)=>{let i=e,r=i.worldArea(),[n,s]=r.cut(te(-100,this.surfaceLevel),te(100,this.surfaceLevel));n&&(this.applyBuoyancy(i,n),this.applyDrag(i,n)),this.flowMagnitude&&i.addForce(ee.fromAngle(this.flowAngle).scale(this.flowMagnitude))}))},applyBuoyancy(e,t){let i=this.density*t.area(),r=te(0,1).scale(-i);e.addForce(r)},applyDrag(e,t){let i=e.vel,r=this.density*this.linearDrag,n=i.scale(-r);e.addForce(n)}}}function Ho(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}function Yo(){return{id:"fixed",fixed:!0}}function zo(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??te(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Qo(e){var t;let i=null==(t=ra.layers)?void 0:t.indexOf(e);return{id:"layer",get layerIndex(){return i??null},get layer(){var e;return i?(null==(e=ra.layers)?void 0:e[i])??null:null},set layer(e){var t;if(i=null==(t=ra.layers)?void 0:t.indexOf(e),-1==i)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}function Wo(e,t){let i="number"==typeof e?ee.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(i.scale(t))}}}function Xo(e={}){let t=e.distance??200,i=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=this.screenPos();if(!e)return!1;let i=new et(te(0),ea.width(),ea.height());return!ea.testRectPoint(i,e)&&i.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(i||(this.trigger("exitView"),i=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(i&&(this.trigger("enterView"),i=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function Jo(...e){return{id:"pos",pos:te(...e),moveBy(...e){this.pos=this.pos.add(te(...e))},move(...e){this.moveBy(te(...e).scale(ea.dt()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(te(e[0],e[1]),e[2]);let t=e[0],i=e[1];if(void 0===i)return void(this.pos=te(t));let r=t.sub(this.pos);r.len()<=i*ea.dt()?this.pos=te(t):this.move(r.unit().scale(i))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(e){return this.parent?this.parent.transform.multVec2(this.pos.add(e)):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.invert().multVec2(e).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let e=this.worldPos();return e?ts(this)?e:ea.toScreen(e):null}},toScreen(e){let t=this.toWorld(e);return ts(this)?t:ea.toScreen(t)},fromScreen(e){return ts(this)?this.fromWorld(e):this.fromWorld(ea.toWorld(e))},toOther(e,t){return e.fromWorld(this.toWorld(t))},fromOther(e,t){return e.toOther(this,t)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){ea.drawCircle({color:ea.rgb(255,0,0),radius:4/hr()})}}}function Zo(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}function _o(...e){if(0===e.length)return _o(1);let t=te(...e);return{id:"scale",set scale(e){if(!(e instanceof ee))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");t=te(e)},get scale(){return t},scaleTo(...e){t=te(...e)},scaleBy(...e){t=t.scale(te(...e))},inspect:()=>t.x==t.y?`scale: ${t.x.toFixed(1)}x`:`scale: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`}}function $o(e){return{id:"z",z:e,inspect(){return`z: ${this.z}`}}}K(Co,"usesArea"),K(Oo,"area"),K(Uo,"body"),K(No,"doubleJump"),K(Lo,"surfaceEffector"),K(qo,"areaEffector"),K(Go,"pointEffector"),K(jo,"constantForce"),K(Ko,"buoyancyEffector"),K(Ho,"anchor"),K(Yo,"fixed"),K(zo,"follow"),K(Qo,"layer"),K(Wo,"move"),K(Xo,"offscreen"),K(Jo,"pos"),K(Zo,"rotate"),K(_o,"scale"),K($o,"z");var ea,ta,ia,ra,na,sa,oa,aa,la,ha,ua,da,ca,fa,pa;const ga=K(((e={})=>{ta=e;let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%"),da=e.canvas??t.appendChild(document.createElement("canvas")),ca=e.scale??1;let i=e.width&&e.height&&!e.stretch&&!e.letterbox;i?(da.width=e.width*ca,da.height=e.height*ca):(da.width=da.parentElement.offsetWidth,da.height=da.parentElement.offsetHeight);let r=["outline: none","cursor: default"];if(i){let e=da.width,t=da.height;r.push(`width: ${e}px`),r.push(`height: ${t}px`)}else r.push("width: 100%"),r.push("height: 100%");e.crisp&&(r.push("image-rendering: pixelated"),r.push("image-rendering: crisp-edges")),da.style.cssText=r.join(";"),ua=e.pixelDensity||window.devicePixelRatio,da.width*=ua,da.height*=ua,da.tabIndex=0,(oa=document.createElement("canvas")).width=256,oa.height=256,aa=oa.getContext("2d",{willReadFrequently:!0}),na=Bi({canvas:da,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS,buttons:e.buttons});let n=[],s=na.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!s)throw new Error("WebGL not supported");let o=s,a=Tn(o,{texFilter:e.texFilter});function l(e,t){let i=new Pn(a,e,t);return{clear:K((()=>i.clear()),"clear"),free:K((()=>i.free()),"free"),toDataURL:K((()=>i.toDataURL()),"toDataURL"),toImageData:K((()=>i.toImageData()),"toImageData"),width:i.width,height:i.height,draw:K((e=>{or(),i.bind(),e(),or(),i.unbind()}),"draw")}}function h(){o.clear(o.COLOR_BUFFER_BIT),ia.frameBuffer.bind(),o.clear(o.COLOR_BUFFER_BIT),ia.bgColor||Gn((()=>{Nn({width:ar(),height:lr(),quad:new ie(0,0,ar()/64,lr()/64),tex:ia.bgTex,fixed:!0})})),ia.renderer.numDraws=0,ia.fixed=!1,ia.transformStack.length=0,ia.transform=new oe}function u(e,t){ia.postShader=e,ia.postShaderUniform=t??null}function d(){or(),ia.lastDrawCalls=ia.renderer.numDraws,ia.frameBuffer.unbind(),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight);let e=ia.width,t=ia.height;ia.width=o.drawingBufferWidth/ua,ia.height=o.drawingBufferHeight/ua,Xn({flipY:!0,tex:ia.frameBuffer.tex,pos:new ee(ia.viewport.x,ia.viewport.y),width:ia.viewport.width,height:ia.viewport.height,shader:ia.postShader,uniform:"function"==typeof ia.postShaderUniform?ia.postShaderUniform():ia.postShaderUniform,fixed:!0}),or(),ia.width=e,ia.height=t}ia=$n(e,a),ha=Js(),sa=jr(a),(ra=Hs()).root.use(To()),K(l,"makeCanvas"),K(h,"frameStart"),K(u,"usePostEffect"),K(d,"frameEnd");let c=!1;function f(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(p(e,t),t):null}}function p(e,t){window.localStorage[e]=JSON.stringify(t)}function g(t,...i){let r,n=t(ea);r="function"==typeof n?n(...i)(ea):n;for(let s in r)ea[s]=r[s],!1!==e.global&&(window[s]=r[s]);return ea}function m(e){let t=na.canvas.captureStream(e),i=ha.ctx.createMediaStreamDestination();ha.masterNode.connect(i);let r=new MediaRecorder(t),n=[];return r.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},r.onerror=()=>{ha.masterNode.disconnect(i),t.getTracks().forEach((e=>e.stop()))},r.start(),{resume(){r.resume()},pause(){r.pause()},stop:()=>(r.stop(),ha.masterNode.disconnect(i),t.getTracks().forEach((e=>e.stop())),new Promise((e=>{r.onstop=()=>{e(new Blob(n,{type:"video/mp4"}))}}))),download(e="kaboom.mp4"){this.stop().then((t=>Wt(e,t)))}}}function w(){return document.activeElement===na.canvas}la={inspect:!1,timeScale:1,showLog:!0,fps:K((()=>na.fps()),"fps"),numFrames:K((()=>na.numFrames()),"numFrames"),stepFrame:R,drawCalls:K((()=>ia.lastDrawCalls),"drawCalls"),clearLog:K((()=>ra.logs=[]),"clearLog"),log:K((t=>{let i=e.logMax??8;ra.logs.unshift({msg:t,time:na.time()}),ra.logs.length>i&&(ra.logs=ra.logs.slice(0,i))}),"log"),error:K((e=>la.log(new Error(e.toString?e.toString():e))),"error"),curRecording:null,numObjects:K((()=>x("*",{recursive:!0}).length),"numObjects"),get paused(){return c},set paused(e){c=e,e?ha.ctx.suspend():ha.ctx.resume()}},K(f,"getData"),K(p,"setData"),K(g,"plug"),K(m,"record"),K(w,"isFocused");let y=ra.root.add.bind(ra.root),v=ra.root.readd.bind(ra.root),A=ra.root.removeAll.bind(ra.root),x=ra.root.get.bind(ra.root),b=ra.root.wait.bind(ra.root),V=ra.root.loop.bind(ra.root),E=ra.root.query.bind(ra.root),M=ra.root.tween.bind(ra.root);function S(){ra.root.fixedUpdate()}function R(){ra.root.update()}fa=zr(null,"data:image/png;base64,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"),pa=zr(null,"data:image/png;base64,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"),K(S,"fixedUpdateFrame"),K(R,"updateFrame");const I=class e{constructor(e,t,i,r,n=!1){q(this,"source"),q(this,"target"),q(this,"normal"),q(this,"distance"),q(this,"resolved",!1),this.source=e,this.target=t,this.normal=i,this.distance=r,this.resolved=n}get displacement(){return this.normal.scale(this.distance)}reverse(){return new e(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(ra.gravity||te(0,1))>0}isRight(){return this.displacement.cross(ra.gravity||te(0,1))<0}isTop(){return this.displacement.dot(ra.gravity||te(0,1))>0}isBottom(){return this.displacement.dot(ra.gravity||te(0,1))<0}preventResolution(){this.resolved=!0}};K(I,"Collision");let k=I;function P(){if(!Co())return;let t={},i=e.hashGridSize||64,r=new oe,n=[];function s(e){if(n.push(r.clone()),e.pos&&r.translate(e.pos),e.scale&&r.scale(e.scale),e.angle&&r.rotate(e.angle),e.transform=r.clone(),e.c("area")&&!e.paused){let r=e,n=r.worldArea().bbox(),s=Math.floor(n.pos.x/i),o=Math.floor(n.pos.y/i),a=Math.ceil((n.pos.x+n.width)/i),l=Math.ceil((n.pos.y+n.height)/i),h=new Set;for(let e=s;e<=a;e++)for(let i=o;i<=l;i++)if(t[e])if(t[e][i]){let n=t[e][i];e:for(let e of n){if(e.paused||!e.exists()||h.has(e.id))continue;for(let i of r.collisionIgnore)if(e.is(i))continue e;for(let i of e.collisionIgnore)if(r.is(i))continue e;let t=kt(r.worldArea(),e.worldArea());if(t){let i=new k(r,e,t.normal,t.distance);r.trigger("collideUpdate",e,i);let n=i.reverse();n.resolved=i.resolved,e.trigger("collideUpdate",r,n)}h.add(e.id)}n.push(r)}else t[e][i]=[r];else t[e]={},t[e][i]=[r]}e.children.forEach(s),r=n.pop()}K(s,"checkObj"),s(ra.root)}function B(e){console.error(e),ha.ctx.suspend();let t=e.message??String(e)??"Unknown error, check console for more info";na.run((()=>{}),(()=>{h(),Gn((()=>{let i=ar(),r=lr(),n={size:36,width:i-64,letterSpacing:4,lineSpacing:4,font:wr,fixed:!0};qn({width:i,height:r,color:z(0,0,255),fixed:!0});let s=Un({...n,text:"Error",pos:te(32),color:z(255,128,0),fixed:!0});Ln(s),_n({...n,text:t,pos:te(32,32+s.height+16),fixed:!0}),sr(),ra.events.trigger("error",e)})),d()}))}function D(e){n.push(e)}function T(){ra.events.onOnce("frameEnd",(()=>{na.quit(),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT);let e=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)o.activeTexture(o.TEXTURE0+t),o.bindTexture(o.TEXTURE_2D,null),o.bindTexture(o.TEXTURE_CUBE_MAP,null);o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),a.destroy(),n.forEach((e=>e()))}))}K(P,"checkFrame"),K(B,"handleErr"),K(D,"onCleanup"),K(T,"quit");let F=!0;na.run((()=>{try{sa.loaded&&(la.paused||S(),P())}catch(e){B(e)}}),((t,i)=>{try{t(),sa.loaded||1===Lr()&&!F&&(sa.loaded=!0,ra.events.trigger("load")),!sa.loaded&&!1!==e.loadingScreen||F?(h(),zn(),d()):(la.paused||R(),P(),h(),Yn(),!1!==e.debug&&Hn(),d()),F&&(F=!1),ra.events.trigger("frameEnd"),i()}catch(r){B(r)}})),es(),to(),ea={VERSION:"3001.0.0",loadRoot:Or,loadProgress:Lr,loadSprite:zr,loadSpriteAtlas:wn,loadSound:gn,loadMusic:mn,loadBitmapFont:nn,loadFont:en,loadShader:un,loadShaderURL:dn,loadAseprite:Jr,loadPedit:sn,loadBean:Xr,loadJSON:Ur,load:Gr,getSound:pn,getFont:$r,getBitmapFont:rn,getSprite:Yr,getShader:hn,getAsset:qr,Asset:Pr,SpriteData:Kr,SoundData:cn,width:ar,height:lr,center:fr,dt:Di,fixedDt:Ti,restDt:Fi,time:na.time,screenshot:na.screenshot,record:m,isFocused:w,setCursor:na.setCursor,getCursor:na.getCursor,setCursorLocked:na.setCursorLocked,isCursorLocked:na.isCursorLocked,setFullscreen:na.setFullscreen,isFullscreen:na.isFullscreen,isTouchscreen:na.isTouchscreen,onLoad:js,onLoading:Ls,onResize:qs,onGamepadConnect:na.onGamepadConnect,onGamepadDisconnect:na.onGamepadDisconnect,onError:Gs,onCleanup:D,camPos:ms,camScale:ws,camFlash:vs,camRot:ys,camTransform:As,shake:xs,toScreen:bs,toWorld:Vs,setGravity:Ys,getGravity:zs,setGravityDirection:Qs,getGravityDirection:Ws,setBackground:_i,getBackground:$i,getGamepads:na.getGamepads,getTreeRoot:so,add:y,make:Ks,destroy:no,destroyAll:A,get:x,query:E,readd:v,pos:Jo,scale:_o,rotate:Zo,color:ns,opacity:ls,anchor:Ho,area:Oo,sprite:uo,text:co,polygon:cs,rect:ps,circle:rs,uvquad:fo,outline:hs,particles:ds,body:Uo,surfaceEffector:Lo,areaEffector:qo,pointEffector:Go,buoyancyEffector:Ko,constantForce:jo,doubleJump:No,shader:gs,textInput:Do,timer:To,fixed:Yo,stay:Bo,health:Ro,lifespan:Io,named:ko,state:Po,z:$o,layer:Qo,move:Wo,offscreen:Xo,follow:zo,fadeIn:os,mask:as,drawon:ss,raycast:fs,tile:yo,animate:Eo,serializeAnimation:Mo,agent:po,sentry:wo,patrol:mo,navigation:go,on:Ms,onFixedUpdate:Ss,onUpdate:Rs,onDraw:Is,onAdd:ks,onDestroy:Ps,onClick:Cs,onCollide:Bs,onCollideUpdate:Ds,onCollideEnd:Ts,onHover:Os,onHoverUpdate:Us,onHoverEnd:Ns,onKeyDown:na.onKeyDown,onKeyPress:na.onKeyPress,onKeyPressRepeat:na.onKeyPressRepeat,onKeyRelease:na.onKeyRelease,onMouseDown:na.onMouseDown,onMousePress:na.onMousePress,onMouseRelease:na.onMouseRelease,onMouseMove:na.onMouseMove,onCharInput:na.onCharInput,onTouchStart:na.onTouchStart,onTouchMove:na.onTouchMove,onTouchEnd:na.onTouchEnd,onScroll:na.onScroll,onHide:na.onHide,onShow:na.onShow,onGamepadButtonDown:na.onGamepadButtonDown,onGamepadButtonPress:na.onGamepadButtonPress,onGamepadButtonRelease:na.onGamepadButtonRelease,onGamepadStick:na.onGamepadStick,onButtonPress:na.onButtonPress,onButtonDown:na.onButtonDown,onButtonRelease:na.onButtonRelease,mousePos:cr,mouseDeltaPos:na.mouseDeltaPos,isKeyDown:na.isKeyDown,isKeyPressed:na.isKeyPressed,isKeyPressedRepeat:na.isKeyPressedRepeat,isKeyReleased:na.isKeyReleased,isMouseDown:na.isMouseDown,isMousePressed:na.isMousePressed,isMouseReleased:na.isMouseReleased,isMouseMoved:na.isMouseMoved,isGamepadButtonPressed:na.isGamepadButtonPressed,isGamepadButtonDown:na.isGamepadButtonDown,isGamepadButtonReleased:na.isGamepadButtonReleased,getGamepadStick:na.getGamepadStick,isButtonPressed:na.isButtonPressed,isButtonDown:na.isButtonDown,isButtonReleased:na.isButtonReleased,setButton:na.setButton,getButton:na.getButton,getLastInputDeviceType:na.getLastInputDeviceType,charInputted:na.charInputted,loop:V,wait:b,play:_s,volume:eo,burp:$s,audioCtx:ha.ctx,Line:$e,Rect:et,Circle:tt,Ellipse:it,Point:_e,Polygon:nt,Vec2:ee,Color:Y,Mat4:oe,Quad:ie,RNG:he,rand:ce,randi:fe,randSeed:de,vec2:te,rgb:z,hsl2rgb:Q,quad:re,choose:we,chooseMultiple:me,shuffle:ge,chance:pe,lerp:Z,tween:M,easings:Ki,map:_,mapc:$,wave:ae,deg2rad:W,rad2deg:X,clamp:J,evaluateQuadratic:st,evaluateQuadraticFirstDerivative:ot,evaluateQuadraticSecondDerivative:at,evaluateBezier:lt,evaluateBezierFirstDerivative:ht,evaluateBezierSecondDerivative:ut,evaluateCatmullRom:dt,evaluateCatmullRomFirstDerivative:ct,curveLengthApproximation:pt,normalizedCurve:ft,hermite:gt,cardinal:mt,catmullRom:wt,bezier:yt,kochanekBartels:vt,easingSteps:It,easingLinear:St,easingCubicBezier:Rt,testLineLine:Ae,testRectRect:ye,testRectLine:xe,testRectPoint:be,testCirclePolygon:Pe,testLinePoint:Me,testLineCircle:Se,isConvex:Ut,triangulate:Ot,NavMesh:Wi,drawSprite:Jn,drawText:_n,formatText:Un,drawRect:qn,drawLine:bn,drawLines:Sn,drawTriangle:Kn,drawCircle:xn,drawEllipse:An,drawUVQuad:Nn,drawPolygon:vn,drawCurve:Rn,drawBezier:In,drawFormattedText:Ln,drawMasked:Wn,drawSubtracted:Zn,pushTransform:tr,popTransform:sr,pushTranslate:er,pushScale:rr,pushRotate:nr,pushMatrix:ir,usePostEffect:u,makeCanvas:l,debug:la,scene:oo,getSceneName:ho,go:ao,onSceneLeave:lo,layers:ro,addLevel:Es,getData:f,setData:p,download:Yt,downloadJSON:Qt,downloadText:zt,downloadBlob:Wt,plug:g,ASCII_CHARS:pr,canvas:na.canvas,addKaboom:io,LEFT:ee.LEFT,RIGHT:ee.RIGHT,UP:ee.UP,DOWN:ee.DOWN,RED:Y.RED,GREEN:Y.GREEN,BLUE:Y.BLUE,YELLOW:Y.YELLOW,MAGENTA:Y.MAGENTA,CYAN:Y.CYAN,WHITE:Y.WHITE,BLACK:Y.BLACK,quit:T,KEvent:ei,KEventHandler:ti,KEventController:$t};let C=e.plugins;if(C&&C.forEach(g),!1!==e.global)for(let O in ea)window[O]=ea[O];return!1!==e.focus&&na.canvas.focus(),ea}),"kaplay")({global:!1,touchToMouse:!0,canvas:document.getElementById("game")});function ma(e,t){const i=document.getElementById("textbox-container"),r=document.getElementById("dialogue");i.style.display="block";let n=0,s="";const o=setInterval((()=>{if(n<e.length)return s+=e[n],r.innerHTML=s,void n++;clearInterval(o)}),1),a=document.getElementById("close");a.addEventListener("click",(function e(){t(),i.style.display="none",r.innerHTML="",clearInterval(o),a.removeEventListener("click",e)})),addEventListener("keypress",(e=>{"Enter"===e.code&&a.click()}))}ga.loadSprite("spritesheet","./spritesheet.png",{sliceX:39,sliceY:31,anims:{"idle-down":940,"walk-down":{from:940,to:943,loop:!0,speed:8},"idle-side":979,"walk-side":{from:979,to:982,loop:!0,speed:8},"idle-up":1018,"walk-up":{from:1018,to:1021,loop:!0,speed:8}}}),ga.loadSprite("map","./map.png"),ga.loadSprite("player","./player.png",{sliceX:5,sliceY:4,anims:{"idle-down":0,"walk-down":{from:0,to:4,loop:!0,speed:8},"idle-side":10,"walk-side":{from:10,to:14,loop:!0,speed:8},"idle-up":5,"walk-up":{from:5,to:9,loop:!0,speed:8}}}),ga.setBackground(ga.Color.fromHex("#311514")),ga.scene("main",(async()=>{const e=(await(await fetch("./map.json")).json()).layers,t=ga.add([ga.sprite("map"),ga.pos(0),ga.scale(4)]),i=ga.make([ga.sprite("player",{anim:"idle-down"}),ga.area({shape:new ga.Rect(ga.vec2(0,3),10,10)}),ga.body(),ga.anchor("center"),ga.pos(),ga.scale(4),{speed:250,direction:"down",isInDialogue:!1},"player"]);ma(G.welcome,(()=>i.isInDialogue=!1));for(const n of e)if("boundaries"!==n.name){if("spawnpoints"===n.name)for(const e of n.objects)"player"!==e.name||(i.pos=ga.vec2(4*(t.pos.x+e.x),4*(t.pos.y+e.y)),ga.add(i))}else for(const e of n.objects)t.add([ga.area({shape:new ga.Rect(ga.vec2(0),e.width,e.height)}),ga.body({isStatic:!0}),ga.pos(e.x,e.y),e.name]),e.name&&i.onCollide(e.name,(()=>{i.isInDialogue=!0,ma(G[e.name],(()=>i.isInDialogue=!1))}));function r(){"down"!==i.direction?"up"!==i.direction?i.play("idle-side"):i.play("idle-up"):i.play("idle-down")}ga.onUpdate((()=>{ga.camPos(i.worldPos().x,i.worldPos().y-100)})),ga.onMouseDown((e=>{if("left"!==e||i.isInDialogue)return;const t=ga.toWorld(ga.mousePos());i.moveTo(t,i.speed);const r=i.pos.angle(t);return r>50&&r<125&&"walk-up"!==i.curAnim()?(i.play("walk-up"),void(i.direction="up")):r<-50&&r>-125&&"walk-down"!==i.curAnim()?(i.play("walk-down"),void(i.direction="down")):Math.abs(r)>125?(i.flipX=!1,"walk-side"!==i.curAnim()&&i.play("walk-side"),void(i.direction="right")):Math.abs(r)<50?(i.flipX=!0,"walk-side"!==i.curAnim()&&i.play("walk-side"),void(i.direction="left")):void 0})),ga.onMouseRelease(r),ga.onKeyRelease((()=>{r()})),ga.onKeyDown((e=>{const t=[ga.isKeyDown("right"),ga.isKeyDown("left"),ga.isKeyDown("up"),ga.isKeyDown("down")];let r=0;for(const i of t)i&&r++;if(!(r>1||i.isInDialogue))return t[0]?(i.flipX=!1,"walk-side"!==i.curAnim()&&i.play("walk-side"),i.direction="right",void i.move(i.speed,0)):t[1]?(i.flipX=!0,"walk-side"!==i.curAnim()&&i.play("walk-side"),i.direction="left",void i.move(-i.speed,0)):t[2]?("walk-up"!==i.curAnim()&&i.play("walk-up"),i.direction="up",void i.move(0,-i.speed)):void(t[3]&&("walk-down"!==i.curAnim()&&i.play("walk-down"),i.direction="down",i.move(0,i.speed)))}))})),ga.go("main");
